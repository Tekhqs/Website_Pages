(function(b,a){a("util/text-metrics",["kendo.core"],b);
}(function(){(function(a){window.kendo.util=window.kendo.util||{};
var e=kendo.Class.extend({init:function(j){this._size=j;
this._length=0;
this._map={};
},put:function(k,m){var l=this._map;
var j={key:k,value:m};
l[k]=j;
if(!this._head){this._head=this._tail=j;
}else{this._tail.newer=j;
j.older=this._tail;
this._tail=j;
}if(this._length>=this._size){l[this._head.key]=null;
this._head=this._head.newer;
this._head.older=null;
}else{this._length++;
}},get:function(k){var j=this._map[k];
if(j){if(j===this._head&&j!==this._tail){this._head=j.newer;
this._head.older=null;
}if(j!==this._tail){if(j.older){j.older.newer=j.newer;
j.newer.older=j.older;
}j.older=this._tail;
j.newer=null;
this._tail.newer=j;
this._tail=j;
}return j.value;
}}});
function g(k){var l=[];
for(var j in k){l.push(j+k[j]);
}return l.sort().join("");
}function d(l){var j=2166136261;
for(var k=0;
k<l.length;
++k){j+=(j<<1)+(j<<4)+(j<<7)+(j<<8)+(j<<24);
j^=l.charCodeAt(k);
}return j>>>0;
}function i(){return{width:0,height:0,baseline:0};
}var b={baselineMarkerSize:1};
var c;
if(typeof document!=="undefined"){c=document.createElement("div");
c.style.cssText="position: absolute !important; top: -4000px !important; width: auto !important; height: auto !important;padding: 0 !important; margin: 0 !important; border: 0 !important;line-height: normal !important; visibility: hidden !important; white-space: nowrap!important;";
}var h=kendo.Class.extend({init:function(j){this._cache=new e(1000);
this.options=a.extend({},b,j);
},measure:function(s,q,k){if(!s){return i();
}var r=g(q);
var m=d(s+r);
var l=this._cache.get(m);
if(l){return l;
}var p=i();
var o=k||c;
var j=this._baselineMarker().cloneNode(false);
for(var n in q){var t=q[n];
if(typeof t!=="undefined"){o.style[n]=t;
}}o.textContent=s;
o.appendChild(j);
document.body.appendChild(o);
if(String(s).length){p.width=o.offsetWidth-this.options.baselineMarkerSize;
p.height=o.offsetHeight;
p.baseline=j.offsetTop+this.options.baselineMarkerSize;
}if(p.width>0&&p.height>0){this._cache.put(m,p);
}o.parentNode.removeChild(o);
return p;
},_baselineMarker:function(){var j=document.createElement("div");
j.style.cssText="display: inline-block; vertical-align: baseline;width: "+this.options.baselineMarkerSize+"px; height: "+this.options.baselineMarkerSize+"px;overflow: hidden;";
return j;
}});
h.current=new h();
function f(l,k,j){return h.current.measure(l,k,j);
}kendo.deepExtend(kendo.util,{LRUCache:e,TextMetrics:h,measureText:f,objectKey:g,hashKey:d});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
(function(b,a){a("dataviz/diagram/utils",["kendo.core"],b);
}(function(){(function(a,l){var i=window.kendo,d=i.dataviz.diagram={},c=i.deepExtend,h=a.isArray,f=1e-06;
var m={};
c(m,{isNearZero:function(n){return Math.abs(n)<f;
},isDefined:function(n){return typeof n!=="undefined";
},isUndefined:function(n){return typeof n==="undefined"||n===null;
},isObject:function(n){return n===Object(n);
},has:function(o,n){return Object.hasOwnProperty.call(o,n);
},isString:function(n){return Object.prototype.toString.call(n)=="[object String]";
},isBoolean:function(n){return Object.prototype.toString.call(n)=="[object Boolean]";
},isType:function(n,o){return Object.prototype.toString.call(n)=="[object "+o+"]";
},isNumber:function(n){return !isNaN(parseFloat(n))&&isFinite(n);
},isEmpty:function(o){if(o===null){return true;
}if(h(o)||m.isString(o)){return o.length===0;
}for(var n in o){if(m.has(o,n)){return false;
}}return true;
},simpleExtend:function(n,p){if(!m.isObject(p)){return;
}for(var o in p){n[o]=p[o];
}},initArray:function b(p,q){var n=[];
for(var o=0;
o<p;
++o){n[o]=q;
}return n;
},serializePoints:function(q){var r=[];
for(var n=0;
n<q.length;
n++){var o=q[n];
r.push(o.x+";"+o.y);
}return r.join(";");
},deserializePoints:function(p){var q=p.split(";"),o=[];
if(q.length%2!==0){throw"Not an array of points.";
}for(var n=0;
n<q.length;
n+=2){o.push(new d.Point(parseInt(q[n],10),parseInt(q[n+1],10)));
}return o;
},randomInteger:function(n,o){return parseInt(Math.floor(Math.random()*o)+n,10);
},DFT:function(n,o){o(n);
if(n.childNodes){for(var p=0;
p<n.childNodes.length;
p++){var q=n.childNodes[p];
this.DFT(q,o);
}}},getMatrixAngle:function(n){if(n===null||n.d===0){return 0;
}return Math.atan2(n.b,n.d)*180/Math.PI;
},getMatrixScaling:function(n){var o=Math.sqrt(n.a*n.a+n.c*n.c);
var p=Math.sqrt(n.b*n.b+n.d*n.d);
return[o,p];
}});
function j(s,u,t){if(typeof s=="undefined"||typeof u=="undefined"){return[];
}if(t&&m.sign(u-s)!=m.sign(t)){throw"The sign of the increment should allow to reach the stop-value.";
}t=t||1;
s=s||0;
u=u||s;
if((u-s)/t===Infinity){throw"Infinite range defined.";
}var q=[],n=-1,o;
function r(w){var v=1;
while(w*v%1){v*=10;
}return v;
}var p=r(Math.abs(t));
s*=p;
u*=p;
t*=p;
if(s>u&&t>0){t=-t;
}if(t<0){while((o=s+t*++n)>=u){q.push(o/p);
}}else{while((o=s+t*++n)<=u){q.push(o/p);
}}return q;
}function g(r,o){if(r==o){return 0;
}var p=o.x-r.x,q=r.y-o.y,n=Math.atan(p/q);
if(q>=0){return p<0?n+2*Math.PI:n;
}return n+Math.PI;
}m.sign=function(n){return n?n<0?-1:1:0;
};
m.findAngle=function(n,o){return g(n,o)*180/Math.PI;
};
m.forEach=function(n,p,q){for(var o=0;
o<n.length;
o++){p.call(q,n[o],o,n);
}};
m.any=function(n,p){for(var o=0;
o<n.length;
++o){if(p(n[o])){return n[o];
}}return null;
};
m.remove=function(n,p){var o;
while((o=m.indexOf(n,p))!==-1){n.splice(o,1);
}return n;
};
m.contains=function(n,o){return m.indexOf(n,o)!==-1;
};
m.indexOf=function(n,o){return a.inArray(o,n);
};
m.fold=function(s,r,n,o){var q=arguments.length>2;
for(var p=0;
p<s.length;
p++){var t=s[p];
if(!q){n=t;
q=true;
}else{n=r.call(o,n,t,p,s);
}}if(!q){throw"Reduce of empty array with no initial value";
}return n;
};
m.find=function(n,p,o){var q;
m.any(n,function(t,r,s){if(p.call(o,t,r,s)){q=t;
return true;
}return false;
});
return q;
};
m.first=function(n,o,p){if(n.length===0){return null;
}if(m.isUndefined(o)){return n[0];
}return m.find(n,o,p);
};
m.insert=function(n,o,p){n.splice(p,0,o);
return n;
};
m.all=function(n,q,o){var r=true;
var s;
for(var p=0;
p<n.length;
p++){s=n[p];
r=r&&q.call(o,s,p,n);
if(!r){break;
}}return r;
};
m.clear=function(n){n.splice(0,n.length);
};
m.bisort=function(n,p,r){if(m.isUndefined(n)){throw"First array is not specified.";
}if(m.isUndefined(p)){throw"Second array is not specified.";
}if(n.length!=p.length){throw"The two arrays should have equal length";
}var o=[],q;
for(q=0;
q<n.length;
q++){o.push({x:n[q],y:p[q]});
}if(m.isUndefined(r)){o.sort(function(s,t){return s.x-t.x;
});
}else{o.sort(function(s,t){return r(s.x,t.x);
});
}m.clear(n);
m.clear(p);
for(q=0;
q<o.length;
q++){n.push(o[q].x);
p.push(o[q].y);
}};
m.addRange=function(n,o){n.push.apply(n,o);
};
var e={easeInOut:function(n){return -Math.cos(n*Math.PI)/2+0.5;
}};
var k=i.Class.extend({init:function(){this.adapters=[];
this.target=0;
this.tick=0;
this.interval=20;
this.duration=800;
this.lastTime=null;
this.handlers=[];
var n=this;
this.transition=e.easeInOut;
this.timerDelegate=function(){n.onTimerEvent();
};
},addAdapter:function(n){this.adapters.push(n);
},onComplete:function(n){this.handlers.push(n);
},removeHandler:function(n){this.handlers=a.grep(this.handlers,function(o){return o!==n;
});
},trigger:function(){var n=this;
if(this.handlers){m.forEach(this.handlers,function(o){return o.call(n.caller!==null?n.caller:n);
});
}},onStep:function(){},seekTo:function(n){this.seekFromTo(this.tick,n);
},seekFromTo:function(n,o){this.target=Math.max(0,Math.min(1,o));
this.tick=Math.max(0,Math.min(1,n));
this.lastTime=new Date().getTime();
if(!this.intervalId){this.intervalId=window.setInterval(this.timerDelegate,this.interval);
}},stop:function(){if(this.intervalId){window.clearInterval(this.intervalId);
this.intervalId=null;
this.trigger();
}},play:function(n){if(this.adapters.length===0){return;
}if(n!==null){this.caller=n;
}this.initState();
this.seekFromTo(0,1);
},reverse:function(){this.seekFromTo(1,0);
},initState:function(){if(this.adapters.length===0){return;
}for(var n=0;
n<this.adapters.length;
n++){this.adapters[n].initState();
}},propagate:function(){var o=this.transition(this.tick);
for(var n=0;
n<this.adapters.length;
n++){this.adapters[n].update(o);
}},onTimerEvent:function(){var o=new Date().getTime();
var p=o-this.lastTime;
this.lastTime=o;
var n=p/this.duration*(this.tick<this.target?1:-1);
if(Math.abs(n)>=Math.abs(this.tick-this.target)){this.tick=this.target;
}else{this.tick+=n;
}try{this.propagate();
}finally{this.onStep.call(this);
if(this.target==this.tick){this.stop();
}}}});
i.deepExtend(d,{init:function(n){i.init(n,d.ui);
},Utils:m,Range:j,Ticker:k});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
(function(b,a){a("dataviz/diagram/math",["dataviz/diagram/utils","kendo.dataviz.core"],b);
}(function(){(function(a,I){var r=window.kendo,f=r.dataviz.diagram,b=r.Class,e=r.deepExtend,d=r.dataviz,J=f.Utils,A=d.Point2D,p=r.isFunction,c=J.contains,t=a.map;
var m=3,h=1e-06;
e(A.fn,{plus:function(K){return new A(this.x+K.x,this.y+K.y);
},minus:function(K){return new A(this.x-K.x,this.y-K.y);
},offset:function(K){return new A(this.x-K,this.y-K);
},times:function(K){return new A(this.x*K,this.y*K);
},normalize:function(){if(this.length()===0){return new A();
}return this.times(1/this.length());
},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y);
},toString:function(){return"("+this.x+","+this.y+")";
},lengthSquared:function(){return this.x*this.x+this.y*this.y;
},middleOf:function w(K,L){return new A(L.x-K.x,L.y-K.y).times(0.5).plus(K);
},toPolar:function(O){var L=1;
if(O){L=180/Math.PI;
}var K=Math.atan2(Math.abs(this.y),Math.abs(this.x));
var M=Math.PI/2;
var N=this.length();
if(this.x===0){if(this.y===0){return new B(0,0);
}if(this.y>0){return new B(N,L*M);
}if(this.y<0){return new B(N,L*3*M);
}}else{if(this.x>0){if(this.y===0){return new B(N,0);
}if(this.y>0){return new B(N,L*K);
}if(this.y<0){return new B(N,L*(4*M-K));
}}else{if(this.y===0){return new B(N,2*M);
}if(this.y>0){return new B(N,L*(2*M-K));
}if(this.y<0){return new B(N,L*(2*M+K));
}}}},isOnLine:function(K,P){if(K.x>P.x){var O=P;
P=K;
K=O;
}var M=new E(K.x,K.y).inflate(m,m),N=new E(P.x,P.y).inflate(m,m),L,Q;
if(M.union(N).contains(this)){if(K.x===P.x||K.y===P.y){return true;
}else{if(K.y<P.y){L=M.x+(N.x-M.x)*(this.y-(M.y+M.height))/(N.y+N.height-(M.y+M.height));
Q=M.x+M.width+(N.x+N.width-(M.x+M.width))*(this.y-M.y)/(N.y-M.y);
}else{L=M.x+(N.x-M.x)*(this.y-M.y)/(N.y-M.y);
Q=M.x+M.width+(N.x+N.width-(M.x+M.width))*(this.y-(M.y+M.height))/(N.y+N.height-(M.y+M.height));
}}return this.x>L&&this.x<Q;
}return false;
}});
e(A,{parse:function(K){var L=K.slice(1,K.length-1),N=L.split(","),M=parseInt(N[0],10),O=parseInt(N[1],10);
if(!isNaN(M)&&!isNaN(O)){return new A(M,O);
}}});
var z=b.extend({init:function(L,K,M){this.point=L;
this.left=K;
this.right=M;
}});
var E=b.extend({init:function(M,N,L,K){this.x=M||0;
this.y=N||0;
this.width=L||0;
this.height=K||0;
},contains:function(K){return K.x>=this.x&&K.x<=this.x+this.width&&K.y>=this.y&&K.y<=this.y+this.height;
},inflate:function(K,L){if(L===I){L=K;
}this.x-=K;
this.y-=L;
this.width+=2*K+1;
this.height+=2*L+1;
return this;
},offset:function(K,L){var M=K,N=L;
if(K instanceof A){M=K.x;
N=K.y;
}this.x+=M;
this.y+=N;
return this;
},union:function(K){var L=Math.min(this.x,K.x);
var N=Math.min(this.y,K.y);
var M=Math.max(this.x+this.width,K.x+K.width);
var O=Math.max(this.y+this.height,K.y+K.height);
return new E(L,N,M-L,O-N);
},center:function(){return new A(this.x+this.width/2,this.y+this.height/2);
},top:function(){return new A(this.x+this.width/2,this.y);
},right:function(){return new A(this.x+this.width,this.y+this.height/2);
},bottom:function(){return new A(this.x+this.width/2,this.y+this.height);
},left:function(){return new A(this.x,this.y+this.height/2);
},topLeft:function(){return new A(this.x,this.y);
},topRight:function(){return new A(this.x+this.width,this.y);
},bottomLeft:function(){return new A(this.x,this.y+this.height);
},bottomRight:function(){return new A(this.x+this.width,this.y+this.height);
},clone:function(){return new E(this.x,this.y,this.width,this.height);
},isEmpty:function(){return !this.width&&!this.height;
},equals:function(K){return this.x===K.x&&this.y===K.y&&this.width===K.width&&this.height===K.height;
},rotatedBounds:function(K){var O=this.clone(),N=this.rotatedPoints(K),P=N[0],Q=N[1],M=N[2],L=N[3];
O.x=Math.min(M.x,P.x,Q.x,L.x);
O.y=Math.min(M.y,P.y,Q.y,L.y);
O.width=Math.max(M.x,P.x,Q.x,L.x)-O.x;
O.height=Math.max(M.y,P.y,Q.y,L.y)-O.y;
return O;
},rotatedPoints:function(K){var O=this,N=O.center(),M=O.bottomRight().rotate(N,360-K),P=O.topLeft().rotate(N,360-K),Q=O.topRight().rotate(N,360-K),L=O.bottomLeft().rotate(N,360-K);
return[P,Q,M,L];
},toString:function(K){K=K||" ";
return this.x+K+this.y+K+this.width+K+this.height;
},scale:function(P,Q,R,K,L){var T=this.topLeft();
var S=this.center();
T.rotate(S,360-L).rotate(K,L);
var M=R.minus(T);
var O=new A(M.x*P,M.y*Q);
var N=M.minus(O);
T=T.plus(N);
T.rotate(K,360-L).rotate(S,L);
this.x=T.x;
this.y=T.y;
this.width*=P;
this.height*=Q;
},zoom:function(K){this.x*=K;
this.y*=K;
this.width*=K;
this.height*=K;
return this;
},overlaps:function(M){var K=this.bottomRight();
var N=M.bottomRight();
var L=!(K.x<M.x||K.y<M.y||N.x<this.x||N.y<this.y);
return L;
}});
var H=b.extend({init:function(L,K){this.width=L;
this.height=K;
}});
H.prototype.Empty=new H(0,0);
E.toRect=function(K){if(!(K instanceof E)){K=new E(K.x,K.y,K.width,K.height);
}return K;
};
E.empty=function(){return new E(0,0,0,0);
};
E.fromPoints=function(K,L){if(isNaN(K.x)||isNaN(K.y)||isNaN(L.x)||isNaN(L.y)){throw"Some values are NaN.";
}return new E(Math.min(K.x,L.x),Math.min(K.y,L.y),Math.abs(K.x-L.x),Math.abs(K.y-L.y));
};
function q(K){return Math.abs(K)<h;
}function o(R,K,S,L,M){var T=(K.x-R.x)*(L.y-S.y)-(K.y-R.y)*(L.x-S.x);
if(q(T)){return;
}var N=(R.y-S.y)*(L.x-S.x)-(R.x-S.x)*(L.y-S.y);
var O=(R.y-S.y)*(K.x-R.x)-(R.x-S.x)*(K.y-R.y);
var P=N/T;
var Q=O/T;
if(M&&(P<0||P>1||Q<0||Q>1)){return;
}return new A(R.x+P*(K.x-R.x),R.y+P*(K.y-R.y));
}var n={lines:function(M,K,N,L){return o(M,K,N,L);
},segments:function(M,K,N,L){return o(M,K,N,L,true);
},rectWithLine:function(L,M,K){return n.segments(M,K,L.topLeft(),L.topRight())||n.segments(M,K,L.topRight(),L.bottomRight())||n.segments(M,K,L.bottomLeft(),L.bottomRight())||n.segments(M,K,L.topLeft(),L.bottomLeft());
},rects:function(P,Q,K){var S=Q.topLeft(),T=Q.topRight(),L=Q.bottomLeft(),M=Q.bottomRight();
var N=Q.center();
if(K){S=S.rotate(N,K);
T=T.rotate(N,K);
L=L.rotate(N,K);
M=M.rotate(N,K);
}var O=P.contains(S)||P.contains(T)||P.contains(L)||P.contains(M)||n.rectWithLine(P,S,T)||n.rectWithLine(P,S,L)||n.rectWithLine(P,T,M)||n.rectWithLine(P,L,M);
if(!O){S=P.topLeft();
T=P.topRight();
L=P.bottomLeft();
M=P.bottomRight();
if(K){var R=360-K;
S=S.rotate(N,R);
T=T.rotate(N,R);
L=L.rotate(N,R);
M=M.rotate(N,R);
}O=Q.contains(S)||Q.contains(T)||Q.contains(L)||Q.contains(M);
}return O;
}};
var F=b.extend({init:function(K){this.container=E.toRect(K);
},align:function(M,K){var L=K.toLowerCase().split(" ");
for(var N=0;
N<L.length;
N++){M=this._singleAlign(M,L[N]);
}return M;
},_singleAlign:function(L,K){if(p(this[K])){return this[K](L);
}else{return L;
}},left:function(K){return this._align(K,this._left);
},center:function(K){return this._align(K,this._center);
},right:function(K){return this._align(K,this._right);
},stretch:function(K){return this._align(K,this._stretch);
},top:function(K){return this._align(K,this._top);
},middle:function(K){return this._align(K,this._middle);
},bottom:function(K){return this._align(K,this._bottom);
},_left:function(K,L){L.x=K.x;
},_center:function(K,L){L.x=(K.width-L.width)/2||0;
},_right:function(K,L){L.x=K.width-L.width;
},_top:function(K,L){L.y=K.y;
},_middle:function(K,L){L.y=(K.height-L.height)/2||0;
},_bottom:function(K,L){L.y=K.height-L.height;
},_stretch:function(K,L){L.x=0;
L.y=0;
L.height=K.height;
L.width=K.width;
},_align:function(L,K){L=E.toRect(L);
K(this.container,L);
return L;
}});
var B=b.extend({init:function(L,K){this.r=L;
this.angle=K;
}});
var u=b.extend({init:function(K,L,M,N,O,P){this.a=K||0;
this.b=L||0;
this.c=M||0;
this.d=N||0;
this.e=O||0;
this.f=P||0;
},plus:function(K){this.a+=K.a;
this.b+=K.b;
this.c+=K.c;
this.d+=K.d;
this.e+=K.e;
this.f+=K.f;
},minus:function(K){this.a-=K.a;
this.b-=K.b;
this.c-=K.c;
this.d-=K.d;
this.e-=K.e;
this.f-=K.f;
},times:function(K){return new u(this.a*K.a+this.c*K.b,this.b*K.a+this.d*K.b,this.a*K.c+this.c*K.d,this.b*K.c+this.d*K.d,this.a*K.e+this.c*K.f+this.e,this.b*K.e+this.d*K.f+this.f);
},apply:function(K){return new A(this.a*K.x+this.c*K.y+this.e,this.b*K.x+this.d*K.y+this.f);
},applyRect:function(K){return E.fromPoints(this.apply(K.topLeft()),this.apply(K.bottomRight()));
},toString:function(){return"matrix("+this.a+" "+this.b+" "+this.c+" "+this.d+" "+this.e+" "+this.f+")";
}});
e(u,{fromSVGMatrix:function(L){var K=new u();
K.a=L.a;
K.b=L.b;
K.c=L.c;
K.d=L.d;
K.e=L.e;
K.f=L.f;
return K;
},fromMatrixVector:function(L){var K=new u();
K.a=L.a;
K.b=L.b;
K.c=L.c;
K.d=L.d;
K.e=L.e;
K.f=L.f;
return K;
},fromList:function(L){if(L.length!==6){throw"The given list should consist of six elements.";
}var K=new u();
K.a=L[0];
K.b=L[1];
K.c=L[2];
K.d=L[3];
K.e=L[4];
K.f=L[5];
return K;
},translation:function(L,M){var K=new u();
K.a=1;
K.b=0;
K.c=0;
K.d=1;
K.e=L;
K.f=M;
return K;
},unit:function(){return new u(1,0,0,1,0,0);
},rotation:function(K,M,N){var L=new u();
L.a=Math.cos(K*Math.PI/180);
L.b=Math.sin(K*Math.PI/180);
L.c=-L.b;
L.d=L.a;
L.e=M-M*L.a+N*L.b||0;
L.f=N-N*L.a-M*L.b||0;
return L;
},scaling:function(L,M){var K=new u();
K.a=L;
K.b=0;
K.c=0;
K.d=M;
K.e=0;
K.f=0;
return K;
},parse:function(M){var L,K;
if(M){M=M.trim();
if(M.slice(0,6).toLowerCase()==="matrix"){K=M.slice(7,M.length-1).trim();
L=K.split(",");
if(L.length===6){return u.fromList(t(L,function(N){return parseFloat(N);
}));
}L=K.split(" ");
if(L.length===6){return u.fromList(t(L,function(N){return parseFloat(N);
}));
}}if(M.slice(0,1)==="("&&M.slice(M.length-1)===")"){M=M.substr(1,M.length-1);
}if(M.indexOf(",")>0){L=M.split(",");
if(L.length===6){return u.fromList(t(L,function(N){return parseFloat(N);
}));
}}if(M.indexOf(" ")>0){L=M.split(" ");
if(L.length===6){return u.fromList(t(L,function(N){return parseFloat(N);
}));
}}}return L;
}});
var v=b.extend({init:function(K,L,M,N,O,P){this.a=K||0;
this.b=L||0;
this.c=M||0;
this.d=N||0;
this.e=O||0;
this.f=P||0;
},fromMatrix:function i(K){var L=new v();
L.a=K.a;
L.b=K.b;
L.c=K.c;
L.d=K.d;
L.e=K.e;
L.f=K.f;
return L;
}});
function y(L,K){var N,O,M;
do{N=Math.random()*2-1;
O=Math.random()*2-1;
M=N*N+O*O;
}while(!M||M>1);
return L+K*N*Math.sqrt(-2*Math.log(M)/M);
}function D(M){if(J.isUndefined(M)){M=10;
}var N="";
var K="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
for(var L=M;
L>0;
--L){N+=K.charAt(Math.round(Math.random()*(K.length-1)));
}return N;
}var j={_distanceToLineSquared:function(O,K,L){function M(R,S){return(R.x-S.x)*(R.x-S.x)+(R.y-S.y)*(R.y-S.y);
}if(K===L){return M(O,K);
}var P=L.x-K.x,Q=L.y-K.y,N=(O.x-K.x)*P+(O.y-K.y)*Q;
if(N<0){return M(K,O);
}N=(L.x-O.x)*P+(L.y-O.y)*Q;
if(N<0){return M(L,O);
}N=(L.x-O.x)*Q-(L.y-O.y)*P;
return N*N/(P*P+Q*Q);
},distanceToLine:function(M,K,L){return Math.sqrt(this._distanceToLineSquared(M,K,L));
},distanceToPolyline:function(M,P){var L=Number.MAX_VALUE;
if(J.isUndefined(P)||P.length===0){return Number.MAX_VALUE;
}for(var Q=0;
Q<P.length-1;
Q++){var N=P[Q];
var O=P[Q+1];
var K=this._distanceToLineSquared(M,N,O);
if(K<L){L=K;
}}return Math.sqrt(L);
}};
var l=r.Class.extend({init:function(){this._buckets=[];
this.length=0;
},add:function(K,M){var L=this._createGetBucket(K);
if(J.isDefined(M)){L.value=M;
}return L;
},get:function(K){if(this._bucketExists(K)){return this._createGetBucket(K);
}return null;
},set:function(K,L){this.add(K,L);
},containsKey:function(K){return this._bucketExists(K);
},remove:function(L){if(this._bucketExists(L)){var K=this._hash(L);
delete this._buckets[K];
this.length--;
return L;
}},forEach:function(L){var N=this._hashes();
for(var O=0,P=N.length;
O<P;
O++){var M=N[O];
var K=this._buckets[M];
if(J.isUndefined(K)){continue;
}L(K);
}},clone:function(){var N=new l();
var M=this._hashes();
for(var O=0,P=M.length;
O<P;
O++){var L=M[O];
var K=this._buckets[L];
if(J.isUndefined(K)){continue;
}N.add(K.key,K.value);
}return N;
},_hashes:function(){var L=[];
for(var K in this._buckets){if(this._buckets.hasOwnProperty(K)){L.push(K);
}}return L;
},_bucketExists:function(L){var K=this._hash(L);
return J.isDefined(this._buckets[K]);
},_createGetBucket:function(M){var L=this._hash(M);
var K=this._buckets[L];
if(J.isUndefined(K)){K={key:M};
this._buckets[L]=K;
this.length++;
}return K;
},_hash:function(K){if(J.isNumber(K)){return K;
}if(J.isString(K)){return this._hashString(K);
}if(J.isObject(K)){return this._objectHashId(K);
}throw"Unsupported key type.";
},_hashString:function(N){var M=0;
if(N.length===0){return M;
}for(var L=0;
L<N.length;
L++){var K=N.charCodeAt(L);
M=M*32-M+K;
}return M;
},_objectHashId:function(L){var K=L._hashId;
if(J.isUndefined(K)){K=D();
L._hashId=K;
}return K;
}});
var g=r.Observable.extend({init:function(K){var M=this;
r.Observable.fn.init.call(M);
this._hashTable=new l();
this.length=0;
if(J.isDefined(K)){if(a.isArray(K)){for(var L=0;
L<K.length;
L++){this.add(K[L]);
}}else{K.forEach(function(N,O){this.add(N,O);
},this);
}}},add:function(L,M){var K=this._hashTable.get(L);
if(!K){K=this._hashTable.add(L);
this.length++;
this.trigger("changed");
}K.value=M;
},set:function(K,L){this.add(K,L);
},get:function(L){var K=this._hashTable.get(L);
if(K){return K.value;
}throw new Error("Cannot find key "+L);
},containsKey:function(K){return this._hashTable.containsKey(K);
},remove:function(K){if(this.containsKey(K)){this.trigger("changed");
this.length--;
return this._hashTable.remove(K);
}},forEach:function(K,L){this._hashTable.forEach(function(M){K.call(L,M.key,M.value);
});
},forEachValue:function(K,L){this._hashTable.forEach(function(M){K.call(L,M.value);
});
},forEachKey:function(K,L){this._hashTable.forEach(function(M){K.call(L,M.key);
});
},keys:function(){var K=[];
this.forEachKey(function(L){K.push(L);
});
return K;
}});
var C=r.Class.extend({init:function(){this._tail=null;
this._head=null;
this.length=0;
},enqueue:function(L){var K={value:L,next:null};
if(!this._head){this._head=K;
this._tail=this._head;
}else{this._tail.next=K;
this._tail=this._tail.next;
}this.length++;
},dequeue:function(){if(this.length<1){throw new Error("The queue is empty.");
}var K=this._head.value;
this._head=this._head.next;
this.length--;
return K;
},contains:function(L){var K=this._head;
while(K){if(K.value===L){return true;
}K=K.next;
}return false;
}});
var G=r.Observable.extend({init:function(K){var L=this;
r.Observable.fn.init.call(L);
this._hashTable=new l();
this.length=0;
if(J.isDefined(K)){if(K instanceof l){K.forEach(function(M){this.add(M);
});
}else{if(K instanceof g){K.forEach(function(M,N){this.add({key:M,value:N});
},this);
}}}},contains:function(K){return this._hashTable.containsKey(K);
},add:function(L){var K=this._hashTable.get(L);
if(!K){this._hashTable.add(L,L);
this.length++;
this.trigger("changed");
}},get:function(K){if(this.contains(K)){return this._hashTable.get(K).value;
}else{return null;
}},hash:function(K){return this._hashTable._hash(K);
},remove:function(K){if(this.contains(K)){this._hashTable.remove(K);
this.length--;
this.trigger("changed");
}},forEach:function(L,K){this._hashTable.forEach(function(M){L(M.value);
},K);
},toArray:function(){var K=[];
this.forEach(function(L){K.push(L);
});
return K;
}});
var x=r.Class.extend({init:function(L,M){this.links=[];
this.outgoing=[];
this.incoming=[];
this.weight=1;
if(J.isDefined(L)){this.id=L;
}else{this.id=D();
}if(J.isDefined(M)){this.associatedShape=M;
var K=M.bounds();
this.width=K.width;
this.height=K.height;
this.x=K.x;
this.y=K.y;
}else{this.associatedShape=null;
}this.data=null;
this.type="Node";
this.shortForm="Node '"+this.id+"'";
this.isVirtual=false;
},isIsolated:function(){return J.isEmpty(this.links);
},bounds:function(K){if(!J.isDefined(K)){return new f.Rect(this.x,this.y,this.width,this.height);
}this.x=K.x;
this.y=K.y;
this.width=K.width;
this.height=K.height;
},isLinkedTo:function(K){var L=this;
return J.any(L.links,function(M){return M.getComplement(L)===K;
});
},getChildren:function(){if(this.outgoing.length===0){return[];
}var K=[];
for(var L=0,M=this.outgoing.length;
L<M;
L++){var N=this.outgoing[L];
K.push(N.getComplement(this));
}return K;
},getParents:function(){if(this.incoming.length===0){return[];
}var N=[];
for(var K=0,L=this.incoming.length;
K<L;
K++){var M=this.incoming[K];
N.push(M.getComplement(this));
}return N;
},clone:function(){var K=new x();
if(J.isDefined(this.weight)){K.weight=this.weight;
}if(J.isDefined(this.balance)){K.balance=this.balance;
}if(J.isDefined(this.owner)){K.owner=this.owner;
}K.associatedShape=this.associatedShape;
K.x=this.x;
K.y=this.y;
K.width=this.width;
K.height=this.height;
return K;
},adjacentTo:function(K){return this.isLinkedTo(K)!==null;
},removeLink:function(K){if(K.source===this){J.remove(this.links,K);
J.remove(this.outgoing,K);
K.source=null;
}if(K.target===this){J.remove(this.links,K);
J.remove(this.incoming,K);
K.target=null;
}},hasLinkTo:function(K){return J.any(this.outgoing,function(L){return L.target===K;
});
},degree:function(){return this.links.length;
},incidentWith:function(K){return c(this.links,K);
},getLinksWith:function(K){return J.all(this.links,function(L){return L.getComplement(this)===K;
},this);
},getNeighbors:function(){var K=[];
J.forEach(this.incoming,function(L){K.push(L.getComplement(this));
},this);
J.forEach(this.outgoing,function(L){K.push(L.getComplement(this));
},this);
return K;
}});
var s=r.Class.extend({init:function(M,O,L,K){if(J.isUndefined(M)){throw"The source of the new link is not set.";
}if(J.isUndefined(O)){throw"The target of the new link is not set.";
}var N,P;
if(J.isString(M)){N=new x(M);
}else{N=M;
}if(J.isString(O)){P=new x(O);
}else{P=O;
}this.source=N;
this.target=P;
this.source.links.push(this);
this.target.links.push(this);
this.source.outgoing.push(this);
this.target.incoming.push(this);
if(J.isDefined(L)){this.id=L;
}else{this.id=D();
}if(J.isDefined(K)){this.associatedConnection=K;
}else{this.associatedConnection=null;
}this.type="Link";
this.shortForm="Link '"+this.source.id+"->"+this.target.id+"'";
},getComplement:function(K){if(this.source!==K&&this.target!==K){throw"The given node is not incident with this link.";
}return this.source===K?this.target:this.source;
},getCommonNode:function(K){if(this.source===K.source||this.source===K.target){return this.source;
}if(this.target===K.source||this.target===K.target){return this.target;
}return null;
},isBridging:function(K,L){return this.source===K&&this.target===L||this.source===L&&this.target===K;
},getNodes:function(){return[this.source,this.target];
},incidentWith:function(K){return this.source===K||this.target===K;
},adjacentTo:function(K){return c(this.source.links,K)||c(this.target.links,K);
},changeSource:function(K){J.remove(this.source.links,this);
J.remove(this.source.outgoing,this);
K.links.push(this);
K.outgoing.push(this);
this.source=K;
},changeTarget:function(K){J.remove(this.target.links,this);
J.remove(this.target.incoming,this);
K.links.push(this);
K.incoming.push(this);
this.target=K;
},changesNodes:function(K,L){if(this.source===K){this.changeSource(L);
}else{if(this.target===K){this.changeTarget(L);
}}},reverse:function(){var K=this.source;
var L=this.target;
this.source=L;
J.remove(K.outgoing,this);
this.source.outgoing.push(this);
this.target=K;
J.remove(L.incoming,this);
this.target.incoming.push(this);
return this;
},directTo:function(K){if(this.source!==K&&this.target!==K){throw"The given node is not incident with this link.";
}if(this.target!==K){this.reverse();
}},createReverseEdge:function(){var K=this.clone();
K.reverse();
K.reversed=true;
return K;
},clone:function(){var K=new s(this.source,this.target);
return K;
}});
var k=r.Class.extend({init:function(K){this.links=[];
this.nodes=[];
this._nodeMap=new g();
this.diagram=null;
this._root=null;
if(J.isDefined(K)){if(J.isString(K)){this.id=K;
}else{this.diagram=K;
this.id=K.id;
}}else{this.id=D();
}this.bounds=new E();
this._hasCachedRelationships=false;
this.type="Graph";
},cacheRelationships:function(K){if(J.isUndefined(K)){K=false;
}if(this._hasCachedRelationships&&!K){return;
}for(var L=0,M=this.nodes.length;
L<M;
L++){var N=this.nodes[L];
N.children=this.getChildren(N);
N.parents=this.getParents(N);
}this._hasCachedRelationships=true;
},assignLevels:function(P,O,Q){if(!P){throw"Start node not specified.";
}if(J.isUndefined(O)){O=0;
}this.cacheRelationships();
if(J.isUndefined(Q)){Q=new g();
J.forEach(this.nodes,function(R){Q.add(R,false);
});
}Q.set(P,true);
P.level=O;
var L=P.children;
for(var M=0,N=L.length;
M<N;
M++){var K=L[M];
if(!K||Q.get(K)){continue;
}this.assignLevels(K,O+1,Q);
}},root:function(L){if(J.isUndefined(L)){if(!this._root){var K=J.first(this.nodes,function(M){return M.incoming.length===0;
});
if(K){return K;
}return J.first(this.nodes);
}else{return this._root;
}}else{this._root=L;
}},getConnectedComponents:function(){this.componentIndex=0;
this.setItemIndices();
var K=J.initArray(this.nodes.length,-1);
for(var O=0;
O<this.nodes.length;
O++){if(K[O]===-1){this._collectConnectedNodes(K,O);
this.componentIndex++;
}}var L=[],N;
for(N=0;
N<this.componentIndex;
++N){L[N]=new k();
}for(N=0;
N<K.length;
++N){var M=L[K[N]];
M.addNodeAndOutgoings(this.nodes[N]);
}L.sort(function(P,Q){return Q.nodes.length-P.nodes.length;
});
return L;
},_collectConnectedNodes:function(M,L){M[L]=this.componentIndex;
var K=this.nodes[L];
J.forEach(K.links,function(N){var O=N.getComplement(K);
var P=O.index;
if(M[P]===-1){this._collectConnectedNodes(M,P);
}},this);
},calcBounds:function(){if(this.isEmpty()){this.bounds=new E();
return this.bounds;
}var K=null;
for(var L=0,M=this.nodes.length;
L<M;
L++){var N=this.nodes[L];
if(!K){K=N.bounds();
}else{K=K.union(N.bounds());
}}this.bounds=K;
return this.bounds;
},getSpanningTree:function(T){var W=new k();
var O=new g(),U,V;
W.root=T.clone();
W.root.level=0;
W.root.id=T.id;
O.add(T,W.root);
T.level=0;
var Y=[];
var S=[];
W._addNode(W.root);
Y.push(T);
S.push(T);
var M=1;
while(S.length>0){var Q=S.pop();
for(var R=0;
R<Q.links.length;
R++){var N=Q.links[R];
var K=N.getComplement(Q);
if(c(Y,K)){continue;
}K.level=Q.level+1;
if(M<K.level+1){M=K.level+1;
}if(!c(S,K)){S.push(K);
}if(!c(Y,K)){Y.push(K);
}if(O.containsKey(Q)){U=O.get(Q);
}else{U=Q.clone();
U.level=Q.level;
U.id=Q.id;
O.add(Q,U);
}if(O.containsKey(K)){V=O.get(K);
}else{V=K.clone();
V.level=K.level;
V.id=K.id;
O.add(K,V);
}var P=new s(U,V);
W.addLink(P);
}}var X=[];
for(var L=0;
L<M;
L++){X.push([]);
}J.forEach(W.nodes,function(Z){X[Z.level].push(Z);
});
W.treeLevels=X;
W.cacheRelationships();
return W;
},takeRandomNode:function(K,L){if(J.isUndefined(K)){K=[];
}if(J.isUndefined(L)){L=4;
}if(this.nodes.length===0){return null;
}if(this.nodes.length===1){return c(K,this.nodes[0])?null:this.nodes[0];
}var M=a.grep(this.nodes,function(N){return !c(K,N)&&N.degree()<=L;
});
if(J.isEmpty(M)){return null;
}return M[J.randomInteger(0,M.length)];
},isEmpty:function(){return J.isEmpty(this.nodes);
},isHealthy:function(){return J.all(this.links,function(K){return c(this.nodes,K.source)&&c(this.nodes,K.target);
},this);
},getParents:function(K){if(!this.hasNode(K)){throw"The given node is not part of this graph.";
}return K.getParents();
},getChildren:function(K){if(!this.hasNode(K)){throw"The given node is not part of this graph.";
}return K.getChildren();
},addLink:function(O,P,N){if(J.isUndefined(O)){throw"The source of the link is not defined.";
}if(J.isUndefined(P)){if(J.isDefined(O.type)&&O.type==="Link"){this.addExistingLink(O);
return;
}else{throw"The target of the link is not defined.";
}}var K=this.getNode(O);
if(J.isUndefined(K)){K=this.addNode(O);
}var L=this.getNode(P);
if(J.isUndefined(L)){L=this.addNode(P);
}var M=new s(K,L);
if(J.isDefined(N)){M.owner=N;
}this.links.push(M);
return M;
},removeAllLinks:function(){while(this.links.length>0){var K=this.links[0];
this.removeLink(K);
}},addExistingLink:function(K){if(this.hasLink(K)){return;
}this.links.push(K);
if(this.hasNode(K.source.id)){var L=this.getNode(K.source.id);
K.changeSource(L);
}else{this.addNode(K.source);
}if(this.hasNode(K.target.id)){var M=this.getNode(K.target.id);
K.changeTarget(M);
}else{this.addNode(K.target);
}},hasLink:function(K){if(J.isString(K)){return J.any(this.links,function(L){return L.id===K;
});
}if(K.type==="Link"){return c(this.links,K);
}throw"The given object is neither an identifier nor a Link.";
},getNode:function(L){var K=L.id||L;
if(this._nodeMap.containsKey(K)){return this._nodeMap.get(K);
}},hasNode:function(L){var K=L.id||L;
return this._nodeMap.containsKey(K);
},_addNode:function(K){this.nodes.push(K);
this._nodeMap.add(K.id,K);
},_removeNode:function(K){J.remove(this.nodes,K);
this._nodeMap.remove(K.id);
},removeNode:function(P){var O=P;
if(J.isString(P)){O=this.getNode(P);
}if(J.isDefined(O)){var N=O.links;
O.links=[];
for(var K=0,L=N.length;
K<L;
K++){var M=N[K];
this.removeLink(M);
}this._removeNode(O);
}else{throw"The identifier should be a Node or the Id (string) of a node.";
}},areConnected:function(K,L){return J.any(this.links,function(M){return M.source==K&&M.target==L||M.source==L&&M.target==K;
});
},removeLink:function(K){J.remove(this.links,K);
J.remove(K.source.outgoing,K);
J.remove(K.source.links,K);
J.remove(K.target.incoming,K);
J.remove(K.target.links,K);
},addNode:function(M,K,N){var L=null;
if(!J.isDefined(M)){throw"No Node or identifier for a new Node is given.";
}if(J.isString(M)){if(this.hasNode(M)){return this.getNode(M);
}L=new x(M);
}else{if(this.hasNode(M)){return this.getNode(M);
}L=M;
}if(J.isDefined(K)){L.bounds(K);
}if(J.isDefined(N)){L.owner=N;
}this._addNode(L);
return L;
},addNodeAndOutgoings:function(L){if(!this.hasNode(L)){this._addNode(L);
}var K=L.outgoing;
L.outgoing=[];
J.forEach(K,function(M){this.addExistingLink(M);
},this);
},setItemIndices:function(){var K;
for(K=0;
K<this.nodes.length;
++K){this.nodes[K].index=K;
}for(K=0;
K<this.links.length;
++K){this.links[K].index=K;
}},clone:function(N){var K=new k();
var M=J.isDefined(N)&&N===true;
if(M){K.nodeMap=new g();
K.linkMap=new g();
}var L=new g();
J.forEach(this.nodes,function(P){var O=P.clone();
L.set(P,O);
K._addNode(O);
if(M){K.nodeMap.set(O,P);
}});
J.forEach(this.links,function(P){if(L.containsKey(P.source)&&L.containsKey(P.target)){var O=K.addLink(L.get(P.source),L.get(P.target));
if(M){K.linkMap.set(O,P);
}}});
return K;
},linearize:function(K){return k.Utils.linearize(this,K);
},depthFirstTraversal:function(M,K){if(J.isUndefined(M)){throw"You need to supply a starting node.";
}if(J.isUndefined(K)){throw"You need to supply an action.";
}if(!this.hasNode(M)){throw"The given start-node is not part of this graph";
}var L=this.getNode(M);
var N=[];
this._dftIterator(L,K,N);
},_dftIterator:function(P,K,Q){K(P);
Q.push(P);
var M=P.getChildren();
for(var N=0,O=M.length;
N<O;
N++){var L=M[N];
if(c(Q,L)){continue;
}this._dftIterator(L,K,Q);
}},breadthFirstTraversal:function(S,K){if(J.isUndefined(S)){throw"You need to supply a starting node.";
}if(J.isUndefined(K)){throw"You need to supply an action.";
}if(!this.hasNode(S)){throw"The given start-node is not part of this graph";
}var N=this.getNode(S);
var R=new C();
var T=[];
R.enqueue(N);
while(R.length>0){var Q=R.dequeue();
K(Q);
T.push(Q);
var M=Q.getChildren();
for(var O=0,P=M.length;
O<P;
O++){var L=M[O];
if(c(T,L)||c(R,L)){continue;
}R.enqueue(L);
}}},_stronglyConnectedComponents:function(N,U,Q,S,M,V,P){Q.add(U,P);
S.add(U,P);
P++;
V.push(U);
var K=U.getChildren(),T;
for(var O=0,R=K.length;
O<R;
O++){T=K[O];
if(!Q.containsKey(T)){this._stronglyConnectedComponents(N,T,Q,S,M,V,P);
S.add(U,Math.min(S.get(U),S.get(T)));
}else{if(c(V,T)){S.add(U,Math.min(S.get(U),Q.get(T)));
}}}if(S.get(U)===Q.get(U)){var L=[];
do{T=V.pop();
L.push(T);
}while(T!==U);
if(!N||L.length>1){M.push(L);
}}},findCycles:function(L){if(J.isUndefined(L)){L=true;
}var N=new g();
var P=new g();
var K=[];
var R=[];
for(var M=0,O=this.nodes.length;
M<O;
M++){var Q=this.nodes[M];
if(N.containsKey(Q)){continue;
}this._stronglyConnectedComponents(L,Q,N,P,K,R,0);
}return K;
},isAcyclic:function(){return J.isEmpty(this.findCycles());
},isSubGraph:function(K){var L=K.linearize();
var M=this.linearize();
return J.all(L,function(N){return c(M,N);
});
},makeAcyclic:function(){if(this.isEmpty()||this.nodes.length<=1||this.links.length<=1){return[];
}if(this.nodes.length==2){var aa=[];
if(this.links.length>1){var Y=this.links[0];
var Z=Y.source;
for(var O=0,T=this.links.length;
O<T;
O++){var V=this.links[O];
if(V.source==Z){continue;
}var ab=V.reverse();
aa.push(ab);
}}return aa;
}var L=this.clone(true);
var X=this.nodes.length;
var Q=new g();
var M=function(N){if(N.outgoing.length===0){return 2-X;
}else{if(N.incoming.length===0){return X-2;
}else{return N.outgoing.length-N.incoming.length;
}}};
var K=function(at,ar){var N=M(at,X);
if(!ar.containsKey(N)){ar.set(N,[]);
}ar.get(N).push(at);
};
J.forEach(L.nodes,function(N){K(N,Q);
});
var aj=[];
var an=[];
while(L.nodes.length>0){var ag,ak,P;
if(Q.containsKey(2-X)){var am=Q.get(2-X);
while(am.length>0){ak=am.pop();
for(var U=0;
U<ak.links.length;
U++){var al=ak.links[U];
ag=al.getComplement(ak);
P=M(ag,X);
J.remove(Q.get(P),ag);
ag.removeLink(al);
K(ag,Q);
}L._removeNode(ak);
an.unshift(ak);
}}if(Q.containsKey(X-2)){var ai=Q.get(X-2);
while(ai.length>0){ag=ai.pop();
for(var af=0;
af<ag.links.length;
af++){var ah=ag.links[af];
ak=ah.getComplement(ag);
P=M(ak,X);
J.remove(Q.get(P),ak);
ak.removeLink(ah);
K(ak,Q);
}aj.push(ag);
L._removeNode(ag);
}}if(L.nodes.length>0){for(var R=X-3;
R>2-X;
R--){if(Q.containsKey(R)&&Q.get(R).length>0){var W=Q.get(R);
var ap=W.pop();
for(var ad=0;
ad<ap.links.length;
ad++){var ae=ap.links[ad];
var ao=ae.getComplement(ap);
P=M(ao,X);
J.remove(Q.get(P),ao);
ao.removeLink(ae);
K(ao,Q);
}aj.push(ap);
L._removeNode(ap);
break;
}}}}aj=aj.concat(an);
var aq=new g();
for(var S=0;
S<this.nodes.length;
S++){aq.set(L.nodeMap.get(aj[S]),S);
}var ac=[];
J.forEach(this.links,function(N){if(aq.get(N.source)>aq.get(N.target)){N.reverse();
ac.push(N);
}});
return ac;
}});
k.Predefined={EightGraph:function(){return k.Utils.parse(["1->2","2->3","3->4","4->1","3->5","5->6","6->7","7->3"]);
},Mindmap:function(){return k.Utils.parse(["0->1","0->2","0->3","0->4","0->5","1->6","1->7","7->8","2->9","9->10","9->11","3->12","12->13","13->14","4->15","4->16","15->17","15->18","18->19","18->20","14->21","14->22","5->23","23->24","23->25","6->26"]);
},ThreeGraph:function(){return k.Utils.parse(["1->2","2->3","3->1"]);
},BinaryTree:function(K){if(J.isUndefined(K)){K=5;
}return k.Utils.createBalancedTree(K,2);
},Linear:function(K){if(J.isUndefined(K)){K=10;
}return k.Utils.createBalancedTree(K,1);
},Tree:function(K,L){return k.Utils.createBalancedTree(K,L);
},Forest:function(K,L,M){return k.Utils.createBalancedForest(K,L,M);
},Workflow:function(){return k.Utils.parse(["0->1","1->2","2->3","1->4","4->3","3->5","5->6","6->3","6->7","5->4"]);
},Grid:function(P,O){var K=new f.Graph();
if(P<=0&&O<=0){return K;
}for(var L=0;
L<P+1;
L++){var R=null;
for(var M=0;
M<O+1;
M++){var Q=new x(L.toString()+"."+M.toString());
K.addNode(Q);
if(R){K.addLink(R,Q);
}if(L>0){var N=K.getNode((L-1).toString()+"."+M.toString());
K.addLink(N,Q);
}R=Q;
}}return K;
}};
k.Utils={parse:function(L){var R,K=new f.Graph(),Q=L.slice();
for(var M=0,N=Q.length;
M<N;
M++){var P=Q[M];
if(J.isString(P)){if(P.indexOf("->")<0){throw"The link should be specified as 'a->b'.";
}var O=P.split("->");
if(O.length!=2){throw"The link should be specified as 'a->b'.";
}R=new s(O[0],O[1]);
K.addLink(R);
}if(J.isObject(P)){if(!R){throw"Specification found before Link definition.";
}r.deepExtend(R,P);
}}return K;
},linearize:function(L,K){if(J.isUndefined(L)){throw"Expected an instance of a Graph object in slot one.";
}if(J.isUndefined(K)){K=false;
}var O=[];
for(var M=0,N=L.links.length;
M<N;
M++){var P=L.links[M];
O.push(P.source.id+"->"+P.target.id);
if(K){O.push({id:P.id});
}}return O;
},_addShape:function(L,M,K,N){if(J.isUndefined(M)){M=new f.Point(0,0);
}if(J.isUndefined(K)){K=D();
}N=r.deepExtend({width:20,height:20,id:K,radius:10,fill:"#778899",data:"circle",undoable:false,x:M.x,y:M.y},N);
return L.addShape(N);
},_addConnection:function(K,L,N,M){return K.connect(L,N,M);
},createDiagramFromGraph:function(L,O,M,Y){if(J.isUndefined(L)){throw"The diagram surface is undefined.";
}if(J.isUndefined(O)){throw"No graph specification defined.";
}if(J.isUndefined(M)){M=true;
}if(J.isUndefined(Y)){Y=false;
}var ad=L.element.clientWidth||200;
var P=L.element.clientHeight||200;
var U=[],V,Z;
for(var Q=0,S=O.nodes.length;
Q<S;
Q++){V=O.nodes[Q];
var X=V.position;
if(J.isUndefined(X)){if(J.isDefined(V.x)&&J.isDefined(V.y)){X=new A(V.x,V.y);
}else{X=new A(J.randomInteger(10,ad-20),J.randomInteger(10,P-20));
}}var W={};
if(V.id==="0"){}else{if(Y){r.deepExtend(W,{width:Math.random()*150+20,height:Math.random()*80+50,data:"rectangle",fill:{color:"#778899"}});
}}Z=this._addShape(L,X,V.id,W);
var K=Z.bounds();
if(J.isDefined(K)){V.x=K.x;
V.y=K.y;
V.width=K.width;
V.height=K.height;
}U[V.id]=Z;
}for(var N=0;
N<O.links.length;
N++){var T=O.links[N];
var ab=U[T.source.id];
if(J.isUndefined(ab)){continue;
}var ac=U[T.target.id];
if(J.isUndefined(ac)){continue;
}this._addConnection(L,ab,ac,{id:T.id});
}if(M){var R=new L.SpringLayout(L);
R.layoutGraph(O,{limitToView:false});
for(var aa=0;
aa<O.nodes.length;
aa++){V=O.nodes[aa];
Z=U[V.id];
Z.bounds(new E(V.x,V.y,V.width,V.height));
}}},createBalancedTree:function(R,V){if(J.isUndefined(R)){R=3;
}if(J.isUndefined(V)){V=3;
}var L=new f.Graph(),K=-1,Q=[],S;
if(R<=0||V<=0){return L;
}var U=new x((++K).toString());
L.addNode(U);
L.root=U;
Q.push(U);
for(var M=0;
M<R;
M++){S=[];
for(var O=0;
O<Q.length;
O++){var T=Q[O];
for(var P=0;
P<V;
P++){var N=new x((++K).toString());
L.addLink(T,N);
S.push(N);
}}Q=S;
}return L;
},createBalancedForest:function(R,V,X){if(J.isUndefined(R)){R=3;
}if(J.isUndefined(V)){V=3;
}if(J.isUndefined(X)){X=5;
}var L=new f.Graph(),K=-1,Q=[],S;
if(R<=0||V<=0||X<=0){return L;
}for(var W=0;
W<X;
W++){var U=new x((++K).toString());
L.addNode(U);
Q=[U];
for(var M=0;
M<R;
M++){S=[];
for(var O=0;
O<Q.length;
O++){var T=Q[O];
for(var P=0;
P<V;
P++){var N=new x((++K).toString());
L.addLink(T,N);
S.push(N);
}}Q=S;
}}return L;
},createRandomConnectedGraph:function(S,O,N){if(J.isUndefined(S)){S=40;
}if(J.isUndefined(O)){O=4;
}if(J.isUndefined(N)){N=false;
}var L=new f.Graph(),K=-1;
if(S<=0){return L;
}var W=new x((++K).toString());
L.addNode(W);
if(S===1){return L;
}if(S>1){for(var M=1;
M<S;
M++){var T=L.takeRandomNode([],O);
if(!T){break;
}var R=L.addNode(M.toString());
L.addLink(T,R);
}if(!N&&S>1){var U=J.randomInteger(1,S);
for(var V=0;
V<U;
V++){var P=L.takeRandomNode([],O);
var Q=L.takeRandomNode([],O);
if(P&&Q&&!L.areConnected(P,Q)){L.addLink(P,Q);
}}}return L;
}},randomDiagram:function(K,P,N,M,O){var L=r.dataviz.diagram.Graph.Utils.createRandomConnectedGraph(P,N,M);
k.Utils.createDiagramFromGraph(K,L,false,O);
}};
r.deepExtend(f,{init:function(K){r.init(K,f.ui);
},Point:A,Intersect:n,Geometry:j,Rect:E,Size:H,RectAlign:F,Matrix:u,MatrixVector:v,normalVariable:y,randomId:D,Dictionary:g,HashTable:l,Queue:C,Set:G,Node:x,Link:s,Graph:k,PathDefiner:z});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
(function(b,a){a("dataviz/diagram/svg",["kendo.drawing","dataviz/diagram/math"],b);
}(function(){(function(a,aa){var B=window.kendo,o=B.dataviz.diagram,i=B.Class,m=B.deepExtend,M=o.Point,O=o.Rect,I=o.Matrix,ab=o.Utils,z=ab.isNumber,A=ab.isString,J=o.MatrixVector,t=B.geometry,l=B.drawing,n=l.util.defined,y=a.inArray;
var Z="transparent",H={none:"none",arrowStart:"ArrowStart",filledCircle:"FilledCircle",arrowEnd:"ArrowEnd"},s=360,T="start",r="end",ad="width",w="height",ae="x",af="y";
o.Markers=H;
function p(ah,X){var d=this.options;
var Y=false;
var ai,g;
for(var ag=0;
ag<X.length;
ag++){g=X[ag];
ai=ah[g];
if(z(ai)&&d[g]!==ai){d[g]=ai;
Y=true;
}}return Y;
}var R=i.extend({init:function(d,g){this.x=d;
this.y=g;
},toMatrix:function(){return I.scaling(this.x,this.y);
},toString:function(){return B.format("scale({0},{1})",this.x,this.y);
},invert:function(){return new R(1/this.x,1/this.y);
}});
var W=i.extend({init:function(d,g){this.x=d;
this.y=g;
},toMatrixVector:function(){return new J(0,0,0,0,this.x,this.y);
},toMatrix:function(){return I.translation(this.x,this.y);
},toString:function(){return B.format("translate({0},{1})",this.x,this.y);
},plus:function(d){this.x+=d.x;
this.y+=d.y;
},times:function(d){this.x*=d;
this.y*=d;
},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y);
},normalize:function(){if(this.Length===0){return;
}this.times(1/this.length());
},invert:function(){return new W(-this.x,-this.y);
}});
var Q=i.extend({init:function(d,g,X){this.x=g||0;
this.y=X||0;
this.angle=d;
},toString:function(){if(this.x&&this.y){return B.format("rotate({0},{1},{2})",this.angle,this.x,this.y);
}else{return B.format("rotate({0})",this.angle);
}},toMatrix:function(){return I.rotation(this.angle,this.x,this.y);
},center:function(){return new M(this.x,this.y);
},invert:function(){return new Q(s-this.angle,this.x,this.y);
}});
Q.ZERO=new Q(0);
Q.create=function(d){return new Q(d.angle,d.x,d.y);
};
Q.parse=function(X){var Y=X.slice(1,X.length-1).split(","),d=Y[0],ag=Y[1],ah=Y[2];
var g=new Q(d,ag,ah);
return g;
};
var j=i.extend({init:function(ag,ah,X,Y,d,g){this.translate=new W(ag,ah);
if(X!==aa&&Y!==aa){this.scale=new R(X,Y);
}if(d!==aa){this.rotate=g?new Q(d,g.x,g.y):new Q(d);
}},toString:function(){var d=function(g){return g?g.toString():"";
};
return d(this.translate)+d(this.rotate)+d(this.scale);
},render:function(d){d._transform=this;
d._renderTransform();
},toMatrix:function(){var d=I.unit();
if(this.translate){d=d.times(this.translate.toMatrix());
}if(this.rotate){d=d.times(this.rotate.toMatrix());
}if(this.scale){d=d.times(this.scale.toMatrix());
}return d;
},invert:function(){var d=this.rotate?this.rotate.invert():aa,g=d?d.toMatrix():I.unit(),X=this.scale?this.scale.invert():aa,Y=X?X.toMatrix():I.unit();
var ai=new M(-this.translate.x,-this.translate.y);
ai=g.times(Y).apply(ai);
var ah=new W(ai.x,ai.y);
var ag=new j();
ag.translate=ah;
ag.rotate=d;
ag.scale=X;
return ag;
}});
var c={_setScale:function(){var d=this.options;
var X=this._originWidth;
var g=this._originHeight;
var Y=d.width/X;
var ag=d.height/g;
if(!z(Y)){Y=1;
}if(!z(ag)){ag=1;
}this._transform.scale=new R(Y,ag);
},_setTranslate:function(){var d=this.options;
var g=d.x||0;
var X=d.y||0;
this._transform.translate=new W(g,X);
},_initSize:function(){var d=this.options;
var g=false;
if(d.autoSize!==false&&(n(d.width)||n(d.height))){this._measure(true);
this._setScale();
g=true;
}if(n(d.x)||n(d.y)){this._setTranslate();
g=true;
}if(g){this._renderTransform();
}},_updateSize:function(d){var g=false;
if(this.options.autoSize!==false&&this._diffNumericOptions(d,[ad,w])){g=true;
this._measure(true);
this._setScale();
}if(this._diffNumericOptions(d,[ae,af])){g=true;
this._setTranslate();
}if(g){this._renderTransform();
}return g;
}};
var q=i.extend({init:function(g){var d=this;
d.options=m({},d.options,g);
d.id=d.options.id;
d._originSize=O.empty();
d._transform=new j();
},visible:function(d){return this.drawingContainer().visible(d);
},redraw:function(d){if(d&&d.id){this.id=d.id;
}},position:function(g,X){var d=this.options;
if(!n(g)){return new M(d.x,d.y);
}if(n(X)){d.x=g;
d.y=X;
}else{if(g instanceof M){d.x=g.x;
d.y=g.y;
}}this._transform.translate=new W(d.x,d.y);
this._renderTransform();
},rotate:function(d,g){if(n(d)){this._transform.rotate=new Q(d,g.x,g.y);
this._renderTransform();
}return this._transform.rotate||Q.ZERO;
},drawingContainer:function(){return this.drawingElement;
},_renderTransform:function(){var d=this._transform.toMatrix();
this.drawingContainer().transform(new t.Matrix(d.a,d.b,d.c,d.d,d.e,d.f));
},_hover:function(){},_diffNumericOptions:p,_measure:function(g){var X;
if(!this._measured||g){var d=this._boundingBox()||new t.Rect();
var Y=d.topLeft();
X=new O(Y.x,Y.y,d.width(),d.height());
this._originSize=X;
this._originWidth=X.width;
this._originHeight=X.height;
this._measured=true;
}else{X=this._originSize;
}return X;
},_boundingBox:function(){return this.drawingElement.rawBBox();
}});
var ac=q.extend({init:function(d){q.fn.init.call(this,d);
d=this.options;
d.fill=K(d.fill);
d.stroke=K(d.stroke);
},options:{stroke:{color:"gray",width:1},fill:{color:Z}},fill:function(d,g){this._fill({color:u(d),opacity:g});
},stroke:function(d,X,g){this._stroke({color:u(d),width:X,opacity:g});
},redraw:function(g){if(g){var X=g.stroke;
var d=g.fill;
if(X){this._stroke(K(X));
}if(d){this._fill(K(d));
}q.fn.redraw.call(this,g);
}},_hover:function(ag){var d=this.drawingElement;
var Y=this.options;
var X=Y.hover;
if(X&&X.fill){var g=ag?K(X.fill):Y.fill;
d.fill(g.color,g.opacity);
}},_stroke:function(X){var d=this.options;
m(d,{stroke:X});
X=d.stroke;
var g=null;
if(X.width>0){g={color:X.color,width:X.width,opacity:X.opacity,dashType:X.dashType};
}this.drawingElement.options.set("stroke",g);
},_fill:function(g){var ag=this.options;
m(ag,{fill:g||{}});
var d=ag.fill;
if(d.gradient){var X=d.gradient;
var Y=X.type==="radial"?l.RadialGradient:l.LinearGradient;
this.drawingElement.fill(new Y(X));
}else{this.drawingElement.fill(d.color,d.opacity);
}}});
var U=ac.extend({init:function(d){d=this._textColor(d);
ac.fn.init.call(this,d);
this._font();
this._initText();
this._initSize();
},options:{fontSize:15,fontFamily:"sans-serif",stroke:{width:0},fill:{color:"black"},autoSize:true},_initText:function(){var d=this.options;
this.drawingElement=new l.Text(n(d.text)?d.text:"",new t.Point(),{font:d.font});
this._fill();
this._stroke();
},_textColor:function(d){if(d&&d.color){d=m({},d,{fill:{color:d.color}});
}return d;
},_font:function(){var g=this.options;
if(g.fontFamily&&n(g.fontSize)){var d=[];
if(g.fontStyle){d.push(g.fontStyle);
}if(g.fontWeight){d.push(g.fontWeight);
}d.push(g.fontSize+(z(g.fontSize)?"px":""));
d.push(g.fontFamily);
g.font=d.join(" ");
}else{delete g.font;
}},content:function(d){return this.drawingElement.content(d);
},redraw:function(d){if(d){var g=false;
var X=this.options;
d=this._textColor(d);
ac.fn.redraw.call(this,d);
if(d.fontFamily||n(d.fontSize)||d.fontStyle||d.fontWeight){m(X,{fontFamily:d.fontFamily,fontSize:d.fontSize,fontStyle:d.fontStyle,fontWeight:d.fontWeight});
this._font();
this.drawingElement.options.set("font",X.font);
g=true;
}if(d.text){this.content(d.text);
g=true;
}if(!this._updateSize(d)&&g){this._initSize();
}}}});
m(U.fn,c);
var P=ac.extend({init:function(d){ac.fn.init.call(this,d);
this._initPath();
this._setPosition();
},_setPosition:function(){var d=this.options;
var g=d.x;
var X=d.y;
if(n(g)||n(X)){this.position(g||0,X||0);
}},redraw:function(d){if(d){ac.fn.redraw.call(this,d);
if(this._diffNumericOptions(d,[ad,w])){this._drawPath();
}if(this._diffNumericOptions(d,[ae,af])){this._setPosition();
}}},_initPath:function(){var d=this.options;
this.drawingElement=new l.Path({stroke:d.stroke,closed:true});
this._fill();
this._drawPath();
},_drawPath:function(){var d=this.drawingElement;
var X=S(this.options);
var Y=X.width;
var g=X.height;
d.segments.elements([k(0,0),k(Y,0),k(Y,g),k(0,g)]);
}});
var F=ac.extend({init:function(g){ac.fn.init.call(this,g);
var d=this.options.anchor;
this.anchor=new t.Point(d.x,d.y);
this.createElement();
},options:{stroke:{color:Z,width:0},fill:{color:"black"}},_transformToPath:function(g,d){var X=d.transform();
if(g&&X){g=g.transformCopy(X);
}return g;
},redraw:function(d){if(d){if(d.position){this.options.position=d.position;
}ac.fn.redraw.call(this,d);
}}});
var h=F.extend({options:{radius:4,anchor:{x:0,y:0}},createElement:function(){var d=this.options;
this.drawingElement=new l.Circle(new t.Circle(this.anchor,d.radius),{fill:d.fill,stroke:d.stroke});
},positionMarker:function(g){var d=this.options;
var Y=d.position;
var ag=g.segments;
var ah;
var X;
if(Y==T){ah=ag[0];
}else{ah=ag[ag.length-1];
}if(ah){X=this._transformToPath(ah.anchor(),g);
this.drawingElement.transform(t.transform().translate(X.x,X.y));
}}});
var b=F.extend({options:{path:"M 0 0 L 10 5 L 0 10 L 3 5 z",anchor:{x:10,y:5}},createElement:function(){var d=this.options;
this.drawingElement=l.Path.parse(d.path,{fill:d.fill,stroke:d.stroke});
},positionMarker:function(X){var Y=this._linePoints(X);
var ag=Y.start;
var g=Y.end;
var ah=t.transform();
if(ag){ah.rotate(E(ag,g),g);
}if(g){var d=this.anchor;
var ai=g.clone().translate(-d.x,-d.y);
ah.translate(ai.x,ai.y);
}this.drawingElement.transform(ah);
},_linePoints:function(Y){var X=this.options;
var ah=Y.segments;
var ai,d,aj;
if(X.position==T){aj=ah[0];
if(aj){d=aj.anchor();
ai=aj.controlOut();
var g=ah[1];
if(!ai&&g){ai=g.anchor();
}}}else{aj=ah[ah.length-1];
if(aj){d=aj.anchor();
ai=aj.controlIn();
var ag=ah[ah.length-2];
if(!ai&&ag){ai=ag.anchor();
}}}if(d){return{start:this._transformToPath(ai,Y),end:this._transformToPath(d,Y)};
}}});
var G={_getPath:function(g){var d=this.drawingElement;
if(d instanceof l.MultiPath){if(g==T){d=d.paths[0];
}else{d=d.paths[d.paths.length-1];
}}if(d&&d.segments.length){return d;
}},_normalizeMarkerOptions:function(g){var X=g.startCap;
var d=g.endCap;
if(A(X)){g.startCap={type:X};
}if(A(d)){g.endCap={type:d};
}},_removeMarker:function(g){var d=this._markers[g];
if(d){this.drawingContainer().remove(d.drawingElement);
delete this._markers[g];
}},_createMarkers:function(){var d=this.options;
this._normalizeMarkerOptions(d);
this._markers={};
this._markers[T]=this._createMarker(d.startCap,T);
this._markers[r]=this._createMarker(d.endCap,r);
},_createMarker:function(X,ag){var ah=(X||{}).type;
var Y=this._getPath(ag);
var g,d;
if(!Y){this._removeMarker(ag);
return;
}if(ah==H.filledCircle){g=h;
}else{if(ah==H.arrowStart||ah==H.arrowEnd){g=b;
}else{this._removeMarker(ag);
}}if(g){d=new g(m({},X,{position:ag}));
d.positionMarker(Y);
this.drawingContainer().append(d.drawingElement);
return d;
}},_positionMarker:function(X){var d=this._markers[X];
if(d){var g=this._getPath(X);
if(g){d.positionMarker(g);
}else{this._removeMarker(X);
}}},_capMap:{start:"startCap",end:"endCap"},_redrawMarker:function(ah,aj,X){this._normalizeMarkerOptions(X);
var ai=this.options;
var d=this._capMap[aj];
var ag=(ai[d]||{}).type;
var Y=X[d];
var g=false;
if(Y){ai[d]=m({},ai[d],Y);
if(Y.type&&ag!=Y.type){this._removeMarker(aj);
this._markers[aj]=this._createMarker(ai[d],aj);
g=true;
}else{if(this._markers[aj]){this._markers[aj].redraw(Y);
}}}else{if(ah&&!this._markers[aj]&&ai[d]){this._markers[aj]=this._createMarker(ai[d],aj);
g=true;
}}return g;
},_redrawMarkers:function(g,d){if(!this._redrawMarker(g,T,d)&&g){this._positionMarker(T);
}if(!this._redrawMarker(g,r,d)&&g){this._positionMarker(r);
}}};
var L=ac.extend({init:function(d){ac.fn.init.call(this,d);
this.container=new l.Group();
this._createElements();
this._initSize();
},options:{autoSize:true},drawingContainer:function(){return this.container;
},data:function(g){var d=this.options;
if(g){if(d.data!=g){d.data=g;
this._setData(g);
this._initSize();
this._redrawMarkers(true,{});
}}else{return d.data;
}},redraw:function(g){if(g){ac.fn.redraw.call(this,g);
var X=this.options;
var d=g.data;
if(n(d)&&X.data!=d){X.data=d;
this._setData(d);
if(!this._updateSize(g)){this._initSize();
}this._redrawMarkers(true,g);
}else{this._updateSize(g);
this._redrawMarkers(false,g);
}}},_createElements:function(){var d=this.options;
this.drawingElement=l.Path.parse(d.data||"",{stroke:d.stroke});
this._fill();
this.container.append(this.drawingElement);
this._createMarkers();
},_setData:function(d){var g=this.drawingElement;
var X=l.Path.parse(d||"");
var Y=X.paths.slice(0);
X.paths.elements([]);
g.paths.elements(Y);
}});
m(L.fn,c);
m(L.fn,G);
var D=ac.extend({init:function(d){ac.fn.init.call(this,d);
this.container=new l.Group();
this._initPath();
this._createMarkers();
},drawingContainer:function(){return this.container;
},redraw:function(g){if(g){g=g||{};
var d=g.from;
var X=g.to;
if(d){this.options.from=d;
}if(X){this.options.to=X;
}if(d||X){this._drawPath();
this._redrawMarkers(true,g);
}else{this._redrawMarkers(false,g);
}ac.fn.redraw.call(this,g);
}},_initPath:function(){var g=this.options;
var d=this.drawingElement=new l.Path({stroke:g.stroke});
this._fill();
this._drawPath();
this.container.append(d);
},_drawPath:function(){var X=this.options;
var d=this.drawingElement;
var g=X.from||new M();
var Y=X.to||new M();
d.segments.elements([k(g.x,g.y),k(Y.x,Y.y)]);
}});
m(D.fn,G);
var N=ac.extend({init:function(d){ac.fn.init.call(this,d);
this.container=new l.Group();
this._initPath();
this._createMarkers();
},drawingContainer:function(){return this.container;
},points:function(g){var d=this.options;
if(g){d.points=g;
this._updatePath();
}else{return d.points;
}},redraw:function(d){if(d){var g=d.points;
ac.fn.redraw.call(this,d);
if(g&&this._pointsDiffer(g)){this.points(g);
this._redrawMarkers(true,d);
}else{this._redrawMarkers(false,d);
}}},_initPath:function(){var d=this.options;
this.drawingElement=new l.Path({stroke:d.stroke});
this._fill();
this.container.append(this.drawingElement);
if(d.points){this._updatePath();
}},_pointsDiffer:function(Y){var d=this.options.points;
var g=d.length!==Y.length;
if(!g){for(var X=0;
X<Y.length;
X++){if(d[X].x!==Y[X].x||d[X].y!==Y[X].y){g=true;
break;
}}}return g;
},_updatePath:function(){var d=this.drawingElement;
var X=this.options;
var ag=X.points;
var ah=[];
var Y;
for(var g=0;
g<ag.length;
g++){Y=ag[g];
ah.push(k(Y.x,Y.y));
}d.segments.elements(ah);
},options:{points:[]}});
m(N.fn,G);
var x=q.extend({init:function(d){q.fn.init.call(this,d);
this._initImage();
},redraw:function(d){if(d){if(d.source){this.drawingElement.src(d.source);
}if(this._diffNumericOptions(d,[ad,w,ae,af])){this.drawingElement.rect(this._rect());
}q.fn.redraw.call(this,d);
}},_initImage:function(){var d=this.options;
var g=this._rect();
this.drawingElement=new l.Image(d.source,g,{});
},_rect:function(){var X=S(this.options);
var d=new t.Point(X.x,X.y);
var g=new t.Size(X.width,X.height);
return new t.Rect(d,g);
}});
var v=q.extend({init:function(d){this.children=[];
q.fn.init.call(this,d);
this.drawingElement=new l.Group();
this._initSize();
},options:{autoSize:false},append:function(d){this.drawingElement.append(d.drawingContainer());
this.children.push(d);
this._childrenChange=true;
},remove:function(d){if(this._remove(d)){this._childrenChange=true;
}},_remove:function(g){var d=y(g,this.children);
if(d>=0){this.drawingElement.removeAt(d);
this.children.splice(d,1);
return true;
}},clear:function(){this.drawingElement.clear();
this.children=[];
this._childrenChange=true;
},toFront:function(X){var g;
for(var d=0;
d<X.length;
d++){g=X[d];
if(this._remove(g)){this.append(g);
}}},toBack:function(d){this._reorderChildren(d,0);
},toIndex:function(g,d){this._reorderChildren(g,d);
},_reorderChildren:function(am,aj){var ag=this.drawingElement;
var g=ag.children.slice(0);
var d=this.children;
var Y=z(aj);
var ah,ai,ak,X,al;
for(ah=0;
ah<am.length;
ah++){al=am[ah];
X=al.drawingContainer();
ai=y(al,d);
if(ai>=0){g.splice(ai,1);
d.splice(ai,1);
ak=Y?aj:aj[ah];
g.splice(ak,0,X);
d.splice(ak,0,al);
}}ag.clear();
ag.append.apply(ag,g);
},redraw:function(d){if(d){if(this._childrenChange){this._childrenChange=false;
if(!this._updateSize(d)){this._initSize();
}}else{this._updateSize(d);
}q.fn.redraw.call(this,d);
}},_boundingBox:function(){var X=this.children;
var d;
var ag,g;
for(var Y=0;
Y<X.length;
Y++){ag=X[Y];
if(ag.visible()&&ag._includeInBBox!==false){g=ag.drawingContainer().clippedBBox(null);
if(g){if(d){d=t.Rect.union(d,g);
}else{d=g;
}}}}return d;
}});
m(v.fn,c);
var C=v.extend({init:function(g,d){this.children=[];
q.fn.init.call(this,d);
this.drawingElement=new l.Layout(V(g),d);
this._initSize();
},rect:function(g){if(g){this.drawingElement.rect(V(g));
}else{var d=this.drawingElement.rect();
if(d){return new O(d.origin.x,d.origin.y,d.size.width,d.size.height);
}}},reflow:function(){this.drawingElement.reflow();
},redraw:function(d){B.deepExtend(this.drawingElement.options,d);
v.fn.redraw.call(this,d);
}});
var f=ac.extend({init:function(d){ac.fn.init.call(this,d);
this._initCircle();
this._initSize();
},redraw:function(g){if(g){var d=this.options;
if(g.center){m(d,{center:g.center});
this._center.move(d.center.x,d.center.y);
}if(this._diffNumericOptions(g,["radius"])){this._circle.setRadius(d.radius);
}this._updateSize(g);
ac.fn.redraw.call(this,g);
}},_initCircle:function(){var X=this.options;
var ag=X.width;
var g=X.height;
var Y=X.radius;
if(!n(Y)){if(!n(ag)){ag=g;
}if(!n(g)){g=ag;
}X.radius=Y=Math.min(ag,g)/2;
}var d=X.center||{x:Y,y:Y};
this._center=new t.Point(d.x,d.y);
this._circle=new t.Circle(this._center,Y);
this.drawingElement=new l.Circle(this._circle,{stroke:X.stroke});
this._fill();
}});
m(f.fn,c);
var e=i.extend({init:function(d,g){g=g||{};
this.element=d;
this.surface=l.Surface.create(d,g);
if(B.isFunction(this.surface.translate)){this.translate=this._translate;
}this.drawingElement=new l.Group();
this._viewBox=new O(0,0,g.width,g.height);
this.size(this._viewBox);
},bounds:function(){var d=this.drawingElement.clippedBBox();
return new O(0,0,d.width(),d.height());
},size:function(d){var g=this._viewBox;
if(n(d)){g.width=d.width;
g.height=d.height;
this.surface.setSize(d);
}return{width:g.width,height:g.height};
},_translate:function(g,X){var d=this._viewBox;
if(n(g)&&n(X)){d.x=g;
d.y=X;
this.surface.translate({x:g,y:X});
}return{x:d.x,y:d.y};
},draw:function(){this.surface.draw(this.drawingElement);
},append:function(d){this.drawingElement.append(d.drawingContainer());
return this;
},remove:function(d){this.drawingElement.remove(d.drawingContainer());
},insertBefore:function(){},clear:function(){this.drawingElement.clear();
},destroy:function(d){this.surface.destroy();
if(d){a(this.element).remove();
}}});
function S(d){return{x:d.x||0,y:d.y||0,width:d.width||0,height:d.height||0};
}function K(g){if(g){var d=g;
if(A(d)){d={color:d};
}if(d.color){d.color=u(d.color);
}return d;
}}function u(g){var d;
if(g!=Z){d=new l.Color(g).toHex();
}else{d=g;
}return d;
}function E(g,X){var Y=X.x-g.x;
var ag=X.y-g.y;
var d=l.util.deg(Math.atan2(ag,Y));
return d;
}function k(d,g){return new l.Segment(new t.Point(d,g));
}function V(d){if(d){return new t.Rect([d.x,d.y],[d.width,d.height]);
}}B.deepExtend(o,{init:function(d){B.init(d,o.ui);
},diffNumericOptions:p,Element:q,Scale:R,Translation:W,Rotation:Q,Circle:f,Group:v,Rectangle:P,Canvas:e,Path:L,Layout:C,Line:D,MarkerBase:F,ArrowMarker:b,CircleMarker:h,Polyline:N,CompositeTransform:j,TextBlock:U,Image:x,VisualBase:ac});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
(function(b,a){a("dataviz/diagram/services",["kendo.drawing","dataviz/diagram/svg"],b);
}(function(){(function(a,aF){var S=window.kendo,v=S.dataviz,C=v.diagram,k=S.Class,J=C.Group,aj=C.Rect,ak=C.Rectangle,aI=C.Utils,P=aI.isUndefined,ae=C.Point,j=C.Circle,ay=C.Ticker,w=S.deepExtend,aa=S.ui.Movable,g=S.support.browser,aH=S.drawing.util,z=aH.defined,O=a.inArray,ai=a.proxy;
var u={arrow:"default",grip:"pointer",cross:"pointer",add:"pointer",move:"move",select:"pointer",south:"s-resize",east:"e-resize",west:"w-resize",north:"n-resize",rowresize:"row-resize",colresize:"col-resize"},L=10,e="Auto",aC="Top",am="Right",U="Left",f="Bottom",y=10,x=10,F="dragStart",D="drag",E="dragEnd",R="itemRotate",Q="itemBoundsChange",X=5,W=5,Y="mouseEnter",Z="mouseLeave",aL="zoomStart",aK="zoomEnd",aq=-20000,ap=20000,H=0.9,I=0.9300000000000001,aJ=5,aE="transparent",ac="pan",an="rotated",av="source",aw="target",K={"-1":av,"1":aw};
C.Cursors=u;
var ah=S.Class.extend({init:function(aM){this.layoutState=aM;
this.diagram=aM.diagram;
},initState:function(){this.froms=[];
this.tos=[];
this.subjects=[];
function aM(aO,aN){var aP=this.diagram.getShapeById(aO);
if(aP){this.subjects.push(aP);
this.froms.push(aP.bounds().topLeft());
this.tos.push(aN.topLeft());
}}this.layoutState.nodeMap.forEach(aM,this);
},update:function(aN){if(this.subjects.length<=0){return;
}for(var aM=0;
aM<this.subjects.length;
aM++){this.subjects[aM].position(new ae(this.froms[aM].x+(this.tos[aM].x-this.froms[aM].x)*aN,this.froms[aM].y+(this.tos[aM].y-this.froms[aM].y)*aN));
}}});
var T=k.extend({init:function(aO,aN,aM){if(P(aM)){this.animate=false;
}else{this.animate=aM;
}this._initialState=aO;
this._finalState=aN;
this.title="Diagram layout";
},undo:function(){this.setState(this._initialState);
},redo:function(){this.setState(this._finalState);
},setState:function(aN){var aM=aN.diagram;
if(this.animate){aN.linkMap.forEach(function(aQ,aR){var aP=aM.getShapeById(aQ);
aP.visible(false);
if(aP){aP.points(aR);
}});
var aO=new ay();
aO.addAdapter(new ah(aN));
aO.onComplete(function(){aN.linkMap.forEach(function(aQ){var aP=aM.getShapeById(aQ);
aP.visible(true);
});
});
aO.play();
}else{aN.nodeMap.forEach(function(aQ,aP){var aR=aM.getShapeById(aQ);
if(aR){aR.position(aP.topLeft());
}});
aN.linkMap.forEach(function(aQ,aR){var aP=aM.getShapeById(aQ);
if(aP){aP.points(aR);
}});
}}});
var l=k.extend({init:function(aM){this.units=[];
this.title="Composite unit";
if(aM!==aF){this.units.push(aM);
}},add:function(aM){this.units.push(aM);
},undo:function(){for(var aM=0;
aM<this.units.length;
aM++){this.units[aM].undo();
}},redo:function(){for(var aM=0;
aM<this.units.length;
aM++){this.units[aM].redo();
}}});
var p=k.extend({init:function(aM,aN,aO){this.item=aM;
this._redoSource=aN;
this._redoTarget=aO;
if(z(aN)){this._undoSource=aM.source();
}if(z(aO)){this._undoTarget=aM.target();
}this.title="Connection Editing";
},undo:function(){if(this._undoSource!==aF){this.item._updateConnector(this._undoSource,"source");
}if(this._undoTarget!==aF){this.item._updateConnector(this._undoTarget,"target");
}this.item.updateModel();
},redo:function(){if(this._redoSource!==aF){this.item._updateConnector(this._redoSource,"source");
}if(this._redoTarget!==aF){this.item._updateConnector(this._redoTarget,"target");
}this.item.updateModel();
}});
var o=k.extend({init:function(aM,aN,aO){this.item=aM;
this._undoSource=aN;
this._undoTarget=aO;
this._redoSource=aM.source();
this._redoTarget=aM.target();
this.title="Connection Editing";
},undo:function(){this.item._updateConnector(this._undoSource,"source");
this.item._updateConnector(this._undoTarget,"target");
this.item.updateModel();
},redo:function(){this.item._updateConnector(this._redoSource,"source");
this.item._updateConnector(this._redoTarget,"target");
this.item.updateModel();
}});
var A=k.extend({init:function(aM){this.connection=aM;
this.diagram=aM.diagram;
this.targetConnector=aM.targetConnector;
this.title="Delete connection";
},undo:function(){this.diagram._addConnection(this.connection,false);
},redo:function(){this.diagram.remove(this.connection,false);
}});
var B=k.extend({init:function(aM){this.shape=aM;
this.diagram=aM.diagram;
this.title="Deletion";
},undo:function(){this.diagram._addShape(this.shape,false);
this.shape.select(false);
},redo:function(){this.shape.select(false);
this.diagram.remove(this.shape,false);
}});
var aD=k.extend({init:function(aP,aQ,aM){this.shapes=aP;
this.undoStates=aQ;
this.title="Transformation";
this.redoStates=[];
this.adorner=aM;
for(var aN=0;
aN<this.shapes.length;
aN++){var aO=this.shapes[aN];
this.redoStates.push(aO.bounds());
}},undo:function(){for(var aM=0;
aM<this.shapes.length;
aM++){var aN=this.shapes[aM];
aN.bounds(this.undoStates[aM]);
if(aN.hasOwnProperty("layout")){aN.layout(aN,this.redoStates[aM],this.undoStates[aM]);
}aN.updateModel();
}if(this.adorner){this.adorner.refreshBounds();
this.adorner.refresh();
}},redo:function(){for(var aM=0;
aM<this.shapes.length;
aM++){var aN=this.shapes[aM];
aN.bounds(this.redoStates[aM]);
if(aN.hasOwnProperty("layout")){aN.layout(aN,this.undoStates[aM],this.redoStates[aM]);
}aN.updateModel();
}if(this.adorner){this.adorner.refreshBounds();
this.adorner.refresh();
}}});
var b=k.extend({init:function(aM,aN){this.connection=aM;
this.diagram=aN;
this.title="New connection";
},undo:function(){this.diagram.remove(this.connection,false);
},redo:function(){this.diagram._addConnection(this.connection,false);
}});
var c=k.extend({init:function(aN,aM){this.shape=aN;
this.diagram=aM;
this.title="New shape";
},undo:function(){this.diagram.deselect();
this.diagram.remove(this.shape,false);
},redo:function(){this.diagram._addShape(this.shape,false);
}});
var ad=k.extend({init:function(aO,aN,aM){this.initial=aO;
this.finalPos=aN;
this.diagram=aM;
this.title="Pan Unit";
},undo:function(){this.diagram.pan(this.initial);
},redo:function(){this.diagram.pan(this.finalPos);
}});
var ao=k.extend({init:function(aM,aP,aQ){this.shapes=aP;
this.undoRotates=aQ;
this.title="Rotation";
this.redoRotates=[];
this.redoAngle=aM._angle;
this.adorner=aM;
this.center=aM._innerBounds.center();
for(var aN=0;
aN<this.shapes.length;
aN++){var aO=this.shapes[aN];
this.redoRotates.push(aO.rotate().angle);
}},undo:function(){var aM,aN;
for(aM=0;
aM<this.shapes.length;
aM++){aN=this.shapes[aM];
aN.rotate(this.undoRotates[aM],this.center,false);
if(aN.hasOwnProperty("layout")){aN.layout(aN);
}aN.updateModel();
}if(this.adorner){this.adorner._initialize();
this.adorner.refresh();
}},redo:function(){var aM,aN;
for(aM=0;
aM<this.shapes.length;
aM++){aN=this.shapes[aM];
aN.rotate(this.redoRotates[aM],this.center,false);
if(aN.hasOwnProperty("layout")){aN.layout(aN);
}aN.updateModel();
}if(this.adorner){this.adorner._initialize();
this.adorner.refresh();
}}});
var aA=k.extend({init:function(aM,aO,aN){this.diagram=aM;
this.indices=aN;
this.items=aO;
this.title="Rotate Unit";
},undo:function(){this.diagram._toIndex(this.items,this.indices);
},redo:function(){this.diagram.toFront(this.items,false);
}});
var az=k.extend({init:function(aM,aO,aN){this.diagram=aM;
this.indices=aN;
this.items=aO;
this.title="Rotate Unit";
},undo:function(){this.diagram._toIndex(this.items,this.indices);
},redo:function(){this.diagram.toBack(this.items,false);
}});
var aG=S.Observable.extend({init:function(aM){S.Observable.fn.init.call(this,aM);
this.bind(this.events,aM);
this.stack=[];
this.index=0;
this.capacity=100;
},events:["undone","redone"],begin:function(){this.composite=new l();
},cancel:function(){this.composite=aF;
},commit:function(aM){if(this.composite.units.length>0){this._restart(this.composite,aM);
}this.composite=aF;
},addCompositeItem:function(aM){if(this.composite){this.composite.add(aM);
}else{this.add(aM);
}},add:function(aN,aM){this._restart(aN,aM);
},pop:function(){if(this.index>0){this.stack.pop();
this.index--;
}},count:function(){return this.stack.length;
},undo:function(){if(this.index>0){this.index--;
this.stack[this.index].undo();
this.trigger("undone");
}},redo:function(){if(this.stack.length>0&&this.index<this.stack.length){this.stack[this.index].redo();
this.index++;
this.trigger("redone");
}},_restart:function(aM,aN){this.stack.splice(this.index,this.stack.length-this.index);
this.stack.push(aM);
if(aN!==false){this.redo();
}else{this.index++;
}if(this.stack.length>this.capacity){this.stack.splice(0,this.stack.length-this.capacity);
this.index=this.capacity;
}},clear:function(){this.stack=[];
this.index=0;
}});
var G=k.extend({init:function(aM){this.toolService=aM;
},start:function(){},move:function(){},end:function(){},tryActivate:function(){return false;
},getCursor:function(){return u.arrow;
}});
var ar=G.extend({init:function(aR){var aQ=this;
var aO=S.support.mobileOS?I:H;
G.fn.init.call(aQ,aR);
var aN=aQ.toolService.diagram,aM=aN.canvas;
var aP=aN.scroller=aQ.scroller=a(aN.scrollable).kendoMobileScroller({friction:aO,velocityMultiplier:aJ,mousewheelScrolling:false,zoom:false,scroll:ai(aQ._move,aQ)}).data("kendoMobileScroller");
if(aM.translate){aQ.movableCanvas=new aa(aM.element);
}var aS=function(aT,aV,aU){aT.makeVirtual();
aT.virtualSize(aV||aq,aU||ap);
};
aS(aP.dimensions.x);
aS(aP.dimensions.y);
aP.disable();
},tryActivate:function(aP,aN){var aQ=this.toolService;
var aO=aQ.diagram.options.pannable;
var aM=aN.ctrlKey;
if(z(aO.key)){if(!aO.key||aO.key=="none"){aM=ab(aN)&&!z(aQ.hoveredItem);
}else{aM=aN[aO.key+"Key"];
}}return aO!==false&&aM&&!z(aQ.hoveredAdorner)&&!z(aQ._hoveredConnector);
},start:function(){this.scroller.enable();
},move:function(){},_move:function(aM){var aQ=this,aO=aQ.toolService.diagram,aN=aO.canvas,aP=new ae(aM.scrollLeft,aM.scrollTop);
if(aN.translate){aO._storePan(aP.times(-1));
aQ.movableCanvas.moveTo(aP);
aN.translate(aP.x,aP.y);
}else{aP=aP.plus(aO._pan.times(-1));
}aO.trigger(ac,{pan:aP});
},end:function(){this.scroller.disable();
},getCursor:function(){return u.move;
}});
var af=k.extend({init:function(aM){this.toolService=aM;
},tryActivate:function(){return true;
},start:function(aP,aO){var aQ=this.toolService,aM=aQ.diagram,aN=aQ.hoveredItem;
if(aN){aQ.selectSingle(aN,aO);
if(aN.adorner){this.adorner=aN.adorner;
this.handle=this.adorner._hitTest(aP);
}}if(!this.handle){this.handle=aM._resizingAdorner._hitTest(aP);
if(this.handle){this.adorner=aM._resizingAdorner;
}}if(this.adorner){if(!this.adorner.isDragHandle(this.handle)||!aM.trigger(F,{shapes:this.adorner.shapes,connections:[]})){this.adorner.start(aP);
}else{aQ.startPoint=aP;
aQ.end(aP);
}}},move:function(aM){if(this.adorner){this.adorner.move(this.handle,aM);
if(this.adorner.isDragHandle(this.handle)){this.toolService.diagram.trigger(D,{shapes:this.adorner.shapes,connections:[]});
}}},end:function(){var aN=this.toolService.diagram,aM=this.adorner,aO;
if(aM){if(!aM.isDragHandle(this.handle)||!aN.trigger(E,{shapes:aM.shapes,connections:[]})){aO=aM.stop();
if(aO){aN.undoRedoService.add(aO,false);
}}else{aM.cancel();
}}this.adorner=aF;
this.handle=aF;
},getCursor:function(aM){return this.toolService.hoveredItem?this.toolService.hoveredItem._getCursor(aM):u.arrow;
}});
var at=k.extend({init:function(aM){this.toolService=aM;
},tryActivate:function(aO,aN){var aQ=this.toolService;
var aP=aQ.diagram.options.selectable;
var aM=aP&&aP.multiple!==false;
if(aM){if(aP.key&&aP.key!="none"){aM=aN[aP.key+"Key"];
}else{aM=ab(aN);
}}return aM&&!z(aQ.hoveredItem)&&!z(aQ.hoveredAdorner);
},start:function(aN){var aM=this.toolService.diagram;
aM.deselect();
aM.selector.start(aN);
},move:function(aN){var aM=this.toolService.diagram;
aM.selector.move(aN);
},end:function(aP,aO){var aM=this.toolService.diagram,aN=this.toolService.hoveredItem;
var aQ=aM.selector.bounds();
if((!aN||!aN.isSelected)&&!aO.ctrlKey){aM.deselect();
}if(!aQ.isEmpty()){aM.selectArea(aQ);
}aM.selector.end();
},getCursor:function(){return u.arrow;
}});
var r=k.extend({init:function(aM){this.toolService=aM;
this.type="ConnectionTool";
},tryActivate:function(){return this.toolService._hoveredConnector;
},start:function(aQ,aP){var aR=this.toolService,aO=aR.diagram,aN=aR._hoveredConnector,aM=aO._createConnection({},aN._c,aQ);
if(h(aM)&&!aO.trigger(F,{shapes:[],connections:[aM],connectionHandle:aw})&&aO._addConnection(aM)){aR._connectionManipulation(aM,aN._c.shape,true);
aR._removeHover();
aR.selectSingle(aR.activeConnection,aP);
if(aP.type=="touchmove"){aO._cachedTouchTarget=aN.visual;
}}else{aM.source(null);
aR.end(aQ);
}},move:function(aN){var aO=this.toolService;
var aM=aO.activeConnection;
aM.target(aN);
aO.diagram.trigger(D,{shapes:[],connections:[aM],connectionHandle:aw});
return true;
},end:function(aR){var aT=this.toolService,aP=aT.diagram,aN=aT.activeConnection,aQ=aT.hoveredItem,aO=aT._hoveredConnector,aS,aM=aP._cachedTouchTarget;
if(!aN){return;
}if(aO&&aO._c!=aN.sourceConnector){aS=aO._c;
}else{if(aQ&&aQ instanceof C.Shape){aS=aQ.getConnector(e)||aQ.getConnector(aR);
}else{aS=aR;
}}aN.target(aS);
if(!aP.trigger(E,{shapes:[],connections:[aN],connectionHandle:aw})){aN.updateModel();
aP._syncConnectionChanges();
}else{aP.remove(aN,false);
aP.undoRedoService.pop();
}aT._connectionManipulation();
if(aM){aP._connectorsAdorner.visual.remove(aM);
aP._cachedTouchTarget=null;
}},getCursor:function(){return u.arrow;
}});
var n=k.extend({init:function(aM){this.toolService=aM;
this.type="ConnectionTool";
},tryActivate:function(aQ,aP){var aS=this.toolService,aM=aS.diagram,aR=aM.options.selectable,aO=aS.hoveredItem,aN=aR!==false&&aO&&aO.path&&!(aO.isSelected&&aP.ctrlKey);
if(aN){this._c=aO;
}return aN;
},start:function(aR,aP){var aS=this.toolService;
var aN=this._c;
aS.selectSingle(aN,aP);
var aM=aN.adorner;
var aO,aQ;
if(aM){aO=aM._hitTest(aR);
aQ=K[aO];
}if(h(aN)&&aM&&!aS.diagram.trigger(F,{shapes:[],connections:[aN],connectionHandle:aQ})){this.handle=aO;
this.handleName=aQ;
aM.start(aR);
}else{aS.startPoint=aR;
aS.end(aR);
}},move:function(aN){var aM=this._c.adorner;
if(h(this._c)&&aM){aM.move(this.handle,aN);
this.toolService.diagram.trigger(D,{shapes:[],connections:[this._c],connectionHandle:this.handleName});
return true;
}},end:function(aP){var aN=this._c;
var aM=aN.adorner;
var aQ=this.toolService;
var aO=aQ.diagram;
if(aM){if(h(aN)){var aR=aM.stop(aP);
if(!aO.trigger(E,{shapes:[],connections:[aN],connectionHandle:this.handleName})){aO.undoRedoService.add(aR,false);
aN.updateModel();
aO._syncConnectionChanges();
}else{aR.undo();
}}}},getCursor:function(){return u.move;
}});
function ax(aM,aN){return aN.charCodeAt(0)==aM||aN.toUpperCase().charCodeAt(0)==aM;
}var aB=k.extend({init:function(aM){this.diagram=aM;
this.tools=[new ar(this),new n(this),new r(this),new at(this),new af(this)];
this.activeTool=aF;
},start:function(aN,aM){aM=w({},aM);
if(this.activeTool){this.activeTool.end(aN,aM);
}this._updateHoveredItem(aN);
this._activateTool(aN,aM);
this.activeTool.start(aN,aM);
this._updateCursor(aN);
this.diagram.focus();
this.diagram.canvas.surface.suspendTracking();
this.startPoint=aN;
return true;
},move:function(aN,aM){aM=w({},aM);
var aO=true;
if(this.activeTool){aO=this.activeTool.move(aN,aM);
}if(aO){this._updateHoveredItem(aN);
}this._updateCursor(aN);
return true;
},end:function(aN,aM){aM=w({},aM);
if(this.activeTool){this.activeTool.end(aN,aM);
}this.diagram.canvas.surface.resumeTracking();
this.activeTool=aF;
this._updateCursor(aN);
return true;
},keyDown:function(aN,aO){var aM=this.diagram;
aO=w({ctrlKey:false,metaKey:false,altKey:false},aO);
if((aO.ctrlKey||aO.metaKey)&&!aO.altKey){if(ax(aN,"a")){aM.selectAll();
aM._destroyToolBar();
return true;
}else{if(ax(aN,"z")){aM.undo();
aM._destroyToolBar();
return true;
}else{if(ax(aN,"y")){aM.redo();
aM._destroyToolBar();
return true;
}else{if(ax(aN,"c")){aM.copy();
aM._destroyToolBar();
}else{if(ax(aN,"x")){aM.cut();
aM._destroyToolBar();
}else{if(ax(aN,"v")){aM.paste();
aM._destroyToolBar();
}else{if(ax(aN,"l")){aM.layout();
aM._destroyToolBar();
}else{if(ax(aN,"d")){aM._destroyToolBar();
aM.copy();
aM.paste();
}}}}}}}}}else{if(aN===46||aN===8){var aP=this.diagram._triggerRemove(aM.select());
if(aP.length){this.diagram.remove(aP,true);
this.diagram._syncChanges();
this.diagram._destroyToolBar();
}return true;
}else{if(aN===27){this._discardNewConnection();
aM.deselect();
aM._destroyToolBar();
return true;
}}}},wheel:function(aQ,aO){var aN=this.diagram,aM=aO.delta,aR=aN.zoom(),aP=aN.options,aT=aP.zoomRate,aS={point:aQ,meta:aO,zoom:aR};
if(aN.trigger(aL,aS)){return;
}if(aM<0){aR+=aT;
}else{aR-=aT;
}aR=S.dataviz.round(Math.max(aP.zoomMin,Math.min(aP.zoomMax,aR)),2);
aS.zoom=aR;
aN.zoom(aR,aS);
aN.trigger(aK,aS);
return true;
},setTool:function(aN,aM){aN.toolService=this;
this.tools[aM]=aN;
},selectSingle:function(aO,aP){var aN=this.diagram;
var aQ=aN.options.selectable;
if(aQ&&!aO.isSelected&&aO.options.selectable!==false){var aM=aP.ctrlKey&&aQ.multiple!==false;
aN.select(aO,{addToSelection:aM});
}},_discardNewConnection:function(){if(this.newConnection){this.diagram.remove(this.newConnection);
this.newConnection=aF;
}},_activateTool:function(aO,aN){for(var aM=0;
aM<this.tools.length;
aM++){var aP=this.tools[aM];
if(aP.tryActivate(aO,aN)){this.activeTool=aP;
break;
}}},_updateCursor:function(aO){var aN=this.diagram.element;
var aM=this.activeTool?this.activeTool.getCursor(aO):this.hoveredAdorner?this.hoveredAdorner._getCursor(aO):this.hoveredItem?this.hoveredItem._getCursor(aO):u.arrow;
aN.css({cursor:aM});
if(g.msie&&g.version==7){aN[0].style.cssText=aN[0].style.cssText;
}},_connectionManipulation:function(aM,aN,aO){this.activeConnection=aM;
this.disabledShape=aN;
if(aO){this.newConnection=this.activeConnection;
}else{this.newConnection=aF;
}},_updateHoveredItem:function(aO){var aN=this._hitTest(aO);
var aM=this.diagram;
if(aN!=this.hoveredItem&&(!this.disabledShape||aN!=this.disabledShape)){if(this.hoveredItem){aM.trigger(Z,{item:this.hoveredItem});
this.hoveredItem._hover(false);
}if(aN&&aN.options.enable){aM.trigger(Y,{item:aN});
this.hoveredItem=aN;
this.hoveredItem._hover(true);
}else{this.hoveredItem=aF;
}}},_removeHover:function(){if(this.hoveredItem){this.hoveredItem._hover(false);
this.hoveredItem=aF;
}},_hitTest:function(aQ){var aN,aM=this.diagram,aP,aO;
if(this._hoveredConnector){this._hoveredConnector._hover(false);
this._hoveredConnector=aF;
}if(aM._connectorsAdorner._visible){aN=aM._connectorsAdorner._hitTest(aQ);
if(aN){return aN;
}}aN=this.diagram._resizingAdorner._hitTest(aQ);
if(aN){this.hoveredAdorner=aM._resizingAdorner;
if(aN.x!==0||aN.y!==0){return;
}aN=aF;
}else{this.hoveredAdorner=aF;
}if(!this.activeTool||this.activeTool.type!=="ConnectionTool"){var aR=[];
for(aO=0;
aO<aM._selectedItems.length;
aO++){aP=aM._selectedItems[aO];
if(aP instanceof C.Connection){aR.push(aP);
}}aN=this._hitTestItems(aR,aQ);
}return aN||this._hitTestElements(aQ);
},_hitTestElements:function(aR){var aO=this.diagram;
var aS=this._hitTestItems(aO.shapes,aR);
var aM=this._hitTestItems(aO.connections,aR);
var aP;
if((!this.activeTool||this.activeTool.type!="ConnectionTool")&&aS&&aM&&!M(aS,aR)){var aQ=aO.mainLayer;
var aT=O(aS.visual,aQ.children);
var aN=O(aM.visual,aQ.children);
aP=aT>aN?aS:aM;
}return aP||aS||aM;
},_hitTestItems:function(aM,aQ){var aO,aP,aN;
for(aO=aM.length-1;
aO>=0;
aO--){aP=aM[aO];
aN=aP._hitTest(aQ);
if(aN){return aN;
}}}});
var q=S.Class.extend({init:function(){}});
var V=q.extend({init:function(aM){var aN=this;
q.fn.init.call(aN);
this.connection=aM;
},hitTest:function(aM){var aN=this.getBounds().inflate(L);
if(!aN.contains(aM)){return false;
}return C.Geometry.distanceToPolyline(aM,this.connection.allPoints())<L;
},getBounds:function(){var aQ=this.connection.allPoints(),aS=aQ[0],aN=aQ[aQ.length-1],aR=Math.max(aS.x,aN.x),aP=Math.min(aS.x,aN.x),aT=Math.min(aS.y,aN.y),aM=Math.max(aS.y,aN.y);
for(var aO=1;
aO<aQ.length-1;
++aO){aR=Math.max(aR,aQ[aO].x);
aP=Math.min(aP,aQ[aO].x);
aT=Math.min(aT,aQ[aO].y);
aM=Math.max(aM,aQ[aO].y);
}return new aj(aP,aT,aR-aP,aM-aT);
}});
var ag=V.extend({init:function(aM){var aN=this;
V.fn.init.call(aN);
this.connection=aM;
},route:function(){}});
var i=V.extend({SAME_SIDE_DISTANCE_RATIO:5,init:function(aM){var aN=this;
V.fn.init.call(aN);
this.connection=aM;
},routePoints:function(aP,aM,aO,aQ){var aN;
if(aO&&aQ){aN=this._connectorPoints(aP,aM,aO,aQ);
}else{aN=this._floatingPoints(aP,aM,aO);
}return aN;
},route:function(){var aO=this.connection._resolvedSourceConnector;
var aQ=this.connection._resolvedTargetConnector;
var aP=this.connection.sourcePoint();
var aM=this.connection.targetPoint();
var aN=this.routePoints(aP,aM,aO,aQ);
this.connection.points(aN);
},_connectorSides:[{name:"Top",axis:"y",boundsPoint:"topLeft",secondarySign:1},{name:"Left",axis:"x",boundsPoint:"topLeft",secondarySign:1},{name:"Bottom",axis:"y",boundsPoint:"bottomRight",secondarySign:-1},{name:"Right",axis:"x",boundsPoint:"bottomRight",secondarySign:-1}],_connectorSide:function(aO,aX){var aS=aO.position();
var aT=aO.shape.bounds(an);
var aN={topLeft:aT.topLeft(),bottomRight:aT.bottomRight()};
var aW=this._connectorSides;
var aQ=aH.MAX_NUM;
var aV;
var aR;
var aM;
var aU;
for(var aP=0;
aP<aW.length;
aP++){aU=aW[aP];
aM=aU.axis;
aV=Math.round(Math.abs(aS[aM]-aN[aU.boundsPoint][aM]));
if(aV<aQ){aQ=aV;
aR=aU;
}else{if(aV===aQ&&(aS[aM]-aX[aM])*aU.secondarySign>(aS[aR.axis]-aX[aR.axis])*aR.secondarySign){aR=aU;
}}}return aR.name;
},_sameSideDistance:function(aN){var aM=aN.shape.bounds(an);
return Math.min(aM.width,aM.height)/this.SAME_SIDE_DISTANCE_RATIO;
},_connectorPoints:function(aV,aO,aT,aW){var aU=this._connectorSide(aT,aO);
var aX=this._connectorSide(aW,aV);
var aM=aO.x-aV.x;
var aN=aO.y-aV.y;
var aS=this._sameSideDistance(aT);
var aR=[];
var aP,aQ;
if(aU===aC||aU==f){if(aX==aC||aX==f){if(aU==aX){if(aU==aC){aQ=Math.min(aV.y,aO.y)-aS;
}else{aQ=Math.max(aV.y,aO.y)+aS;
}aR=[new ae(aV.x,aQ),new ae(aO.x,aQ)];
}else{aR=[new ae(aV.x,aV.y+aN/2),new ae(aO.x,aV.y+aN/2)];
}}else{aR=[new ae(aV.x,aO.y)];
}}else{if(aX==U||aX==am){if(aU==aX){if(aU==U){aP=Math.min(aV.x,aO.x)-aS;
}else{aP=Math.max(aV.x,aO.x)+aS;
}aR=[new ae(aP,aV.y),new ae(aP,aO.y)];
}else{aR=[new ae(aV.x+aM/2,aV.y),new ae(aV.x+aM/2,aV.y+aN)];
}}else{aR=[new ae(aO.x,aV.y)];
}}return aR;
},_floatingPoints:function(aX,aP,aV){var aW=aV?this._connectorSide(aV,aP):null;
var aM=this._startHorizontal(aX,aP,aW);
var aS=[aX,aX,aP,aP];
var aN=aP.x-aX.x;
var aO=aP.y-aX.y;
var aR=aS.length;
var aT;
var aU;
for(var aQ=1;
aQ<aR-1;
++aQ){if(aM){if(aQ%2!==0){aT=aN/(aR/2);
aU=0;
}else{aT=0;
aU=aO/((aR-1)/2);
}}else{if(aQ%2!==0){aT=0;
aU=aO/(aR/2);
}else{aT=aN/((aR-1)/2);
aU=0;
}}aS[aQ]=new ae(aS[aQ-1].x+aT,aS[aQ-1].y+aU);
}aQ--;
if(aM&&aQ%2!==0||!aM&&aQ%2===0){aS[aR-2]=new ae(aS[aR-1].x,aS[aR-2].y);
}else{aS[aR-2]=new ae(aS[aR-2].x,aS[aR-1].y);
}return[aS[1],aS[2]];
},_startHorizontal:function(aP,aM,aO){var aN;
if(aO!==null&&(aO===am||aO===U)){aN=true;
}else{aN=Math.abs(aP.x-aM.x)>Math.abs(aP.y-aM.y);
}return aN;
}});
var d=k.extend({init:function(aM,aN){var aO=this;
aO.diagram=aM;
aO.options=w({},aO.options,aN);
aO.visual=new J();
aO.diagram._adorners.push(aO);
},refresh:function(){}});
var m=d.extend({init:function(aM,aO){var aQ=this,aN;
aQ.connection=aM;
aN=aQ.connection.diagram;
aQ._ts=aN.toolService;
d.fn.init.call(aQ,aN,aO);
var aP=aQ.connection.sourcePoint();
var aR=aQ.connection.targetPoint();
aQ.spVisual=new j(w(aQ.options.handles,{center:aP}));
aQ.epVisual=new j(w(aQ.options.handles,{center:aR}));
aQ.visual.append(aQ.spVisual);
aQ.visual.append(aQ.epVisual);
},options:{handles:{}},_getCursor:function(){return u.move;
},start:function(aM){this.handle=this._hitTest(aM);
this.startPoint=aM;
this._initialSource=this.connection.source();
this._initialTarget=this.connection.target();
switch(this.handle){case -1:if(this.connection.targetConnector){this._ts._connectionManipulation(this.connection,this.connection.targetConnector.shape);
}break;
case 1:if(this.connection.sourceConnector){this._ts._connectionManipulation(this.connection,this.connection.sourceConnector.shape);
}break;
}},move:function(aN,aO){switch(aN){case -1:this.connection.source(aO);
break;
case 1:this.connection.target(aO);
break;
default:var aM=aO.minus(this.startPoint);
this.startPoint=aO;
if(!this.connection.sourceConnector){this.connection.source(this.connection.sourcePoint().plus(aM));
}if(!this.connection.targetConnector){this.connection.target(this.connection.targetPoint().plus(aM));
}break;
}this.refresh();
return true;
},stop:function(aN){var aP=this.diagram.toolService,aM=aP.hoveredItem,aO;
if(aP._hoveredConnector){aO=aP._hoveredConnector._c;
}else{if(aM&&aM instanceof C.Shape){aO=aM.getConnector(e)||aM.getConnector(aN);
}else{aO=aN;
}}if(this.handle===-1){this.connection.source(aO);
}else{if(this.handle===1){this.connection.target(aO);
}}this.handle=aF;
this._ts._connectionManipulation();
return new o(this.connection,this._initialSource,this._initialTarget);
},_hitTest:function(aN){var aR=this.connection.sourcePoint();
var aU=this.connection.targetPoint();
var aO=this.options.handles.width/2+L;
var aP=this.options.handles.height/2+L;
var aS=aR.distanceTo(aN);
var aV=aU.distanceTo(aN);
var aQ=new aj(aR.x,aR.y).inflate(aO,aP).contains(aN);
var aT=new aj(aU.x,aU.y).inflate(aO,aP).contains(aN);
var aM=0;
if(aQ&&(!aT||aS<aV)){aM=-1;
}else{if(aT&&(!aQ||aV<aS)){aM=1;
}}return aM;
},refresh:function(){this.spVisual.redraw({center:this.diagram.modelToLayer(this.connection.sourcePoint())});
this.epVisual.redraw({center:this.diagram.modelToLayer(this.connection.targetPoint())});
}});
var s=d.extend({init:function(aM,aN){var aO=this;
d.fn.init.call(aO,aM,aN);
aO._refreshHandler=function(aP){if(aP.item==aO.shape){aO.refresh();
}};
},show:function(aP){var aQ=this,aO,aN,aM;
aQ._visible=true;
aQ.shape=aP;
aQ.diagram.bind(Q,aQ._refreshHandler);
aO=aP.connectors.length;
aQ.connectors=[];
aQ._clearVisual();
for(aN=0;
aN<aO;
aN++){aM=new t(aP.connectors[aN]);
aQ.connectors.push(aM);
aQ.visual.append(aM.visual);
}aQ.visual.visible(true);
aQ.refresh();
},_clearVisual:function(){var aM=this;
if(aM.diagram._cachedTouchTarget){aM._keepCachedTouchTarget();
}else{aM.visual.clear();
}},_keepCachedTouchTarget:function(){var aP=this,aQ=aP.visual.children;
var aM=aQ.length;
var aO=O(aP.diagram._cachedTouchTarget,aQ);
for(var aN=aM-1;
aN>=0;
aN--){if(aN==aO){continue;
}aP.visual.remove(aQ[aN]);
}},destroy:function(){var aM=this;
aM.diagram.unbind(Q,aM._refreshHandler);
aM.shape=aF;
aM._visible=aF;
aM.visual.visible(false);
},_hitTest:function(aO){var aM,aN;
for(aN=0;
aN<this.connectors.length;
aN++){aM=this.connectors[aN];
if(aM._hitTest(aO)){aM._hover(true);
this.diagram.toolService._hoveredConnector=aM;
break;
}}},refresh:function(){if(this.shape){var aM=this.shape.bounds();
aM=this.diagram.modelToLayer(aM);
this.visual.position(aM.topLeft());
a.each(this.connectors,function(){this.refresh();
});
}}});
function N(aN,aM){var aO;
if(aN.x==-1&&aN.y==-1){aO=aM.bottomRight();
}else{if(aN.x==1&&aN.y==1){aO=aM.topLeft();
}else{if(aN.x==-1&&aN.y==1){aO=aM.topRight();
}else{if(aN.x==1&&aN.y==-1){aO=aM.bottomLeft();
}else{if(aN.x===0&&aN.y==-1){aO=aM.bottom();
}else{if(aN.x===0&&aN.y==1){aO=aM.top();
}else{if(aN.x==1&&aN.y===0){aO=aM.left();
}else{if(aN.x==-1&&aN.y===0){aO=aM.right();
}}}}}}}}return aO;
}var al=d.extend({init:function(aM,aN){var aO=this;
d.fn.init.call(aO,aM,aN);
aO._manipulating=false;
aO.map=[];
aO.shapes=[];
aO._initSelection();
aO._createHandles();
aO.redraw();
aO.diagram.bind("select",function(aP){aO._initialize(aP.selected);
});
aO._refreshHandler=function(){if(!aO._internalChange){aO.refreshBounds();
aO.refresh();
}};
aO._rotatedHandler=function(){if(aO.shapes.length==1){aO._angle=aO.shapes[0].rotate().angle;
}aO._refreshHandler();
};
aO.diagram.bind(Q,aO._refreshHandler).bind(R,aO._rotatedHandler);
aO.refreshBounds();
aO.refresh();
},options:{handles:{fill:{color:"#fff"},stroke:{color:"#282828"},height:7,width:7,hover:{fill:{color:"#282828"},stroke:{color:"#282828"}}},selectable:{stroke:{color:"#778899",width:1,dashType:"dash"},fill:{color:aE}},offset:10},_initSelection:function(){var aP=this;
var aM=aP.diagram;
var aO=aM.options.selectable;
var aN=w({},aP.options.selectable,aO);
aP.rect=new ak(aN);
aP.visual.append(aP.rect);
},_resizable:function(){return this.options.editable&&this.options.editable.resize!==false;
},_handleOptions:function(){return(this.options.editable.resize||{}).handles||this.options.handles;
},_createHandles:function(){var aM,aN,aP,aO;
if(this._resizable()){aM=this._handleOptions();
for(aO=-1;
aO<=1;
aO++){for(aP=-1;
aP<=1;
aP++){if(aO!==0||aP!==0){aN=new ak(aM);
aN.drawingElement._hover=ai(this._hover,this);
this.map.push({x:aO,y:aP,visual:aN});
this.visual.append(aN);
}}}}},bounds:function(aM){if(aM){this._innerBounds=aM.clone();
this._bounds=this.diagram.modelToLayer(aM).inflate(this.options.offset,this.options.offset);
}else{return this._bounds;
}},_hitTest:function(aR){var aS=this.diagram.modelToLayer(aR),aQ,aP,aN,aO=this.map.length,aM;
if(this._angle){aS=aS.clone().rotate(this._bounds.center(),this._angle);
}if(this._resizable()){for(aQ=0;
aQ<aO;
aQ++){aM=this.map[aQ];
aP=new ae(aM.x,aM.y);
aN=this._getHandleBounds(aP);
aN.offset(this._bounds.x,this._bounds.y);
if(aN.contains(aS)){return aP;
}}}if(this._bounds.contains(aS)){return new ae(0,0);
}},_getHandleBounds:function(aO){if(this._resizable()){var aN=this._handleOptions(),aQ=aN.width,aM=aN.height,aP=new aj(0,0,aQ,aM);
if(aO.x<0){aP.x=-aQ/2;
}else{if(aO.x===0){aP.x=Math.floor(this._bounds.width/2)-aQ/2;
}else{if(aO.x>0){aP.x=this._bounds.width+1-aQ/2;
}}}if(aO.y<0){aP.y=-aM/2;
}else{if(aO.y===0){aP.y=Math.floor(this._bounds.height/2)-aM/2;
}else{if(aO.y>0){aP.y=this._bounds.height+1-aM/2;
}}}return aP;
}},_getCursor:function(aO){var aN=this._hitTest(aO);
if(aN&&aN.x>=-1&&aN.x<=1&&aN.y>=-1&&aN.y<=1&&this._resizable()){var aM=this._angle;
if(aM){aM=360-aM;
aN.rotate(new ae(0,0),aM);
aN=new ae(Math.round(aN.x),Math.round(aN.y));
}if(aN.x==-1&&aN.y==-1){return"nw-resize";
}if(aN.x==1&&aN.y==1){return"se-resize";
}if(aN.x==-1&&aN.y==1){return"sw-resize";
}if(aN.x==1&&aN.y==-1){return"ne-resize";
}if(aN.x===0&&aN.y==-1){return"n-resize";
}if(aN.x===0&&aN.y==1){return"s-resize";
}if(aN.x==1&&aN.y===0){return"e-resize";
}if(aN.x==-1&&aN.y===0){return"w-resize";
}}return this._manipulating?u.move:u.select;
},_initialize:function(){var aP=this,aM,aN,aO=aP.diagram.select();
aP.shapes=[];
for(aM=0;
aM<aO.length;
aM++){aN=aO[aM];
if(aN instanceof C.Shape){aP.shapes.push(aN);
aN._rotationOffset=new ae();
}}aP._angle=aP.shapes.length==1?aP.shapes[0].rotate().angle:0;
aP._startAngle=aP._angle;
aP._rotates();
aP._positions();
aP.refreshBounds();
aP.refresh();
aP.redraw();
},_rotates:function(){var aO=this,aM,aN;
aO.initialRotates=[];
for(aM=0;
aM<aO.shapes.length;
aM++){aN=aO.shapes[aM];
aO.initialRotates.push(aN.rotate().angle);
}},_positions:function(){var aO=this,aM,aN;
aO.initialStates=[];
for(aM=0;
aM<aO.shapes.length;
aM++){aN=aO.shapes[aM];
aO.initialStates.push(aN.bounds());
}},_hover:function(aR,aM){if(this._resizable()){var aO=this._handleOptions(),aP=aO.hover,aQ=aO.stroke,aN=aO.fill;
if(aR&&aI.isDefined(aP.stroke)){aQ=w({},aQ,aP.stroke);
}if(aR&&aI.isDefined(aP.fill)){aN=aP.fill;
}aM.stroke(aQ.color,aQ.width,aQ.opacity);
aM.fill(aN.color,aN.opacity);
}},start:function(aN){this._sp=aN;
this._cp=aN;
this._lp=aN;
this._manipulating=true;
this._internalChange=true;
this.shapeStates=[];
for(var aM=0;
aM<this.shapes.length;
aM++){var aO=this.shapes[aM];
this.shapeStates.push(aO.bounds());
}},redraw:function(){var aN,aM,aO=this._resizable();
for(aN=0;
aN<this.map.length;
aN++){aM=this.map[aN];
aM.visual.visible(aO);
}},angle:function(aM){if(z(aM)){this._angle=aM;
}return this._angle;
},rotate:function(){var aM=this._innerBounds.center();
var aN=this.angle();
this._internalChange=true;
for(var aO=0;
aO<this.shapes.length;
aO++){var aP=this.shapes[aO];
aN=(aN+this.initialRotates[aO]-this._startAngle)%360;
aP.rotate(aN,aM);
}this.refresh();
},move:function(aU,aZ){var aR,aS,aT=new ae(),aQ=new ae(),aN,aO,a2,aV,aM,aW,aP=0,a3,a0,a1;
if(aU.y===-2&&aU.x===-1){aO=this._innerBounds.center();
this._angle=this._truncateAngle(aI.findAngle(aO,aZ));
for(aV=0;
aV<this.shapes.length;
aV++){a2=this.shapes[aV];
aM=(this._angle+this.initialRotates[aV]-this._startAngle)%360;
a2.rotate(aM,aO);
if(a2.hasOwnProperty("layout")){a2.layout(a2);
}this._rotating=true;
}this.refresh();
}else{if(this.shouldSnap()){var a4=this._truncateDistance(aZ.minus(this._lp));
if(a4.x===0&&a4.y===0){this._cp=aZ;
return;
}aR=a4;
this._lp=new ae(this._lp.x+a4.x,this._lp.y+a4.y);
}else{aR=aZ.minus(this._cp);
}if(this.isDragHandle(aU)){aQ=aT=aR;
aS=true;
}else{if(this._angle){aR.rotate(new ae(0,0),this._angle);
}if(aU.x==-1){aT.x=aR.x;
}else{if(aU.x==1){aQ.x=aR.x;
}}if(aU.y==-1){aT.y=aR.y;
}else{if(aU.y==1){aQ.y=aR.y;
}}}if(!aS){a3=N(aU,this._innerBounds);
a0=(this._innerBounds.width+aR.x*aU.x)/this._innerBounds.width;
a1=(this._innerBounds.height+aR.y*aU.y)/this._innerBounds.height;
}for(aV=0;
aV<this.shapes.length;
aV++){a2=this.shapes[aV];
aN=a2.bounds();
if(aS){if(!h(a2)){continue;
}aW=this._displaceBounds(aN,aT,aQ,aS);
}else{aW=aN.clone();
aW.scale(a0,a1,a3,this._innerBounds.center(),a2.rotate().angle);
var aX=aW.center();
aX.rotate(aN.center(),-this._angle);
aW=new aj(aX.x-aW.width/2,aX.y-aW.height/2,aW.width,aW.height);
}if(aW.width>=a2.options.minWidth&&aW.height>=a2.options.minHeight){var aY=aN;
a2.bounds(aW);
if(a2.hasOwnProperty("layout")){a2.layout(a2,aY,aW);
}if(aY.width!==aW.width||aY.height!==aW.height){a2.rotate(a2.rotate().angle);
}aP+=1;
}}if(aP){if(aP==aV){aW=this._displaceBounds(this._innerBounds,aT,aQ,aS);
this.bounds(aW);
}else{this.refreshBounds();
}this.refresh();
}this._positions();
}this._cp=aZ;
},isDragHandle:function(aM){return aM.x===0&&aM.y===0;
},cancel:function(){var aN=this.shapes;
var aO=this.shapeStates;
for(var aM=0;
aM<aN.length;
aM++){aN[aM].bounds(aO[aM]);
}this.refreshBounds();
this.refresh();
this._manipulating=aF;
this._internalChange=aF;
this._rotating=aF;
},_truncatePositionToGuides:function(aM){if(this.diagram.ruler){return this.diagram.ruler.truncatePositionToGuides(aM);
}return aM;
},_truncateSizeToGuides:function(aM){if(this.diagram.ruler){return this.diagram.ruler.truncateSizeToGuides(aM);
}return aM;
},_truncateAngle:function(aM){var aN=this.snapOptions();
var aO=Math.max(aN.angle||x,W);
return aN?Math.floor(aM%360/aO)*aO:aM%360;
},_truncateDistance:function(aM){if(aM instanceof C.Point){return new C.Point(this._truncateDistance(aM.x),this._truncateDistance(aM.y));
}else{var aN=this.snapOptions()||{};
var aO=Math.max(aN.size||y,X);
return aN?Math.floor(aM/aO)*aO:aM;
}},snapOptions:function(){var aM=this.diagram.options.editable;
var aN=((aM||{}).drag||{}).snap||{};
return aN;
},shouldSnap:function(){var aN=this.diagram.options.editable;
var aM=(aN||{}).drag;
var aO=(aM||{}).snap;
return aN!==false&&aM!==false&&aO!==false;
},_displaceBounds:function(aM,aQ,aO,aP){var aT=aM.topLeft().plus(aQ),aN=aM.bottomRight().plus(aO),aR=aj.fromPoints(aT,aN),aS;
if(!aP){aS=aR.center();
aS.rotate(aM.center(),-this._angle);
aR=new aj(aS.x-aR.width/2,aS.y-aR.height/2,aR.width,aR.height);
}return aR;
},stop:function(){var aP,aN,aO;
if(this._cp!=this._sp){if(this._rotating){aP=new ao(this,this.shapes,this.initialRotates);
this._rotating=false;
}else{if(this._diffStates()){if(this.diagram.ruler){for(aN=0;
aN<this.shapes.length;
aN++){aO=this.shapes[aN];
var aM=aO.bounds();
aM=this._truncateSizeToGuides(this._truncatePositionToGuides(aM));
aO.bounds(aM);
this.refreshBounds();
this.refresh();
}}for(aN=0;
aN<this.shapes.length;
aN++){aO=this.shapes[aN];
aO.updateModel();
}aP=new aD(this.shapes,this.shapeStates,this);
this.diagram._syncShapeChanges();
}}}this._manipulating=aF;
this._internalChange=aF;
this._rotating=aF;
return aP;
},_diffStates:function(){var aN=this.shapes;
var aO=this.shapeStates;
for(var aM=0;
aM<aN.length;
aM++){if(!aN[aM].bounds().equals(aO[aM])){return true;
}}return false;
},refreshBounds:function(){var aM=this.shapes.length==1?this.shapes[0].bounds().clone():this.diagram.boundingBox(this.shapes,true);
this.bounds(aM);
},refresh:function(){var aP=this,aM,aN;
if(this.shapes.length>0){aN=this.bounds();
this.visual.visible(true);
this.visual.position(aN.topLeft());
a.each(this.map,function(){aM=aP._getHandleBounds(new ae(this.x,this.y));
this.visual.position(aM.topLeft());
});
this.visual.position(aN.topLeft());
var aO=new ae(aN.width/2,aN.height/2);
this.visual.rotate(this._angle,aO);
this.rect.redraw({width:aN.width,height:aN.height});
if(this.rotationThumb){var aQ=this.options.editable.rotate.thumb;
this._rotationThumbBounds=new aj(aN.center().x,aN.y+aQ.y,0,0).inflate(aQ.width);
this.rotationThumb.redraw({x:aN.width/2-aQ.width/2});
}}else{this.visual.visible(false);
}}});
var au=k.extend({init:function(aM){var aN=aM.options.selectable;
this.options=w({},this.options,aN);
this.visual=new ak(this.options);
this.diagram=aM;
},options:{stroke:{color:"#778899",width:1,dashType:"dash"},fill:{color:aE}},start:function(aM){this._sp=this._ep=aM;
this.refresh();
this.diagram._adorn(this,true);
},end:function(){this._sp=this._ep=aF;
this.diagram._adorn(this,false);
},bounds:function(aM){if(aM){this._bounds=aM;
}return this._bounds;
},move:function(aM){this._ep=aM;
this.refresh();
},refresh:function(){if(this._sp){var aM=aj.fromPoints(this.diagram.modelToLayer(this._sp),this.diagram.modelToLayer(this._ep));
this.bounds(aj.fromPoints(this._sp,this._ep));
this.visual.position(aM.topLeft());
this.visual.redraw({height:aM.height+1,width:aM.width+1});
}}});
var t=k.extend({init:function(aM){this.options=w({},aM.options);
this._c=aM;
this.visual=new j(this.options);
this.refresh();
},_hover:function(aQ){var aO=this.options,aN=aO.hover,aP=aO.stroke,aM=aO.fill;
if(aQ&&aI.isDefined(aN.stroke)){aP=w({},aP,aN.stroke);
}if(aQ&&aI.isDefined(aN.fill)){aM=aN.fill;
}this.visual.redraw({stroke:aP,fill:aM});
},refresh:function(){var aM=this._c.shape.diagram.modelToView(this._c.position()),aN=aM.minus(this._c.shape.bounds("transformed").topLeft()),aO=new aj(aM.x,aM.y,0,0);
aO.inflate(this.options.width/2,this.options.height/2);
this._visualBounds=aO;
this.visual.redraw({center:new ae(aN.x,aN.y)});
},_hitTest:function(aM){var aN=this._c.shape.diagram.modelToView(aM);
return this._visualBounds.contains(aN);
}});
function h(aN){var aM=aN.options.editable;
return aM&&aM.drag!==false;
}function M(aR,aO){var aM,aP,aQ;
for(var aN=0;
aN<aR.connectors.length;
aN++){aM=aR.connectors[aN];
aP=aM.position();
aQ=new aj(aP.x,aP.y);
aQ.inflate(L,L);
if(aQ.contains(aO)){return aM;
}}}function ab(aM){return aM.ctrlKey===false&&aM.altKey===false&&aM.shiftKey===false;
}w(C,{CompositeUnit:l,TransformUnit:aD,PanUndoUnit:ad,AddShapeUnit:c,AddConnectionUnit:b,DeleteShapeUnit:B,DeleteConnectionUnit:A,ConnectionEditAdorner:m,ConnectionTool:r,ConnectorVisual:t,UndoRedoService:aG,ResizingAdorner:al,Selector:au,ToolService:aB,ConnectorsAdorner:s,LayoutUndoUnit:T,ConnectionEditUnit:p,ToFrontUnit:aA,ToBackUnit:az,ConnectionRouterBase:q,PolylineRouter:ag,CascadingRouter:i,SelectionTool:at,ScrollerTool:ar,PointerTool:af,ConnectionEditTool:n,RotateUnit:ao});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
(function(b,a){a("dataviz/diagram/layout",["dataviz/diagram/math"],b);
}(function(){(function(a,y){var l=window.kendo,e=l.dataviz.diagram,i=e.Graph,q=e.Node,p=e.Link,c=l.deepExtend,u=e.Size,s=e.Rect,g=e.Dictionary,t=e.Set,k=e.Graph,z=e.Utils,r=e.Point,h=1e-06,d=Math.PI/180,b=z.contains,j=a.grep;
var n=l.Class.extend({defaultOptions:{type:"Tree",subtype:"Down",roots:null,animate:false,limitToView:false,friction:0.9,nodeDistance:50,iterations:300,horizontalSeparation:90,verticalSeparation:50,underneathVerticalTopOffset:15,underneathHorizontalOffset:15,underneathVerticalSeparation:15,grid:{width:1500,offsetX:50,offsetY:50,componentSpacingX:20,componentSpacingY:20},layerSeparation:50,layeredIterations:2,startRadialAngle:0,endRadialAngle:360,radialSeparation:150,radialFirstLevelSeparation:200,keepComponentsInOneRadialLayout:false,ignoreContainers:true,layoutContainerChildren:false,ignoreInvisible:true,animateTransitions:false},init:function(){},gridLayoutComponents:function(C){if(!C){throw"No components supplied.";
}z.forEach(C,function(Q){Q.calcBounds();
});
C.sort(function(Q,R){return R.bounds.width-Q.bounds.width;
});
var H=this.options.grid.width,I=this.options.grid.componentSpacingX,J=this.options.grid.componentSpacingY,F=0,M=this.options.grid.offsetX,N=this.options.grid.offsetY,O=M,P=N,G,K=[],L=[];
while(C.length>0){if(O>=H){O=M;
P+=F+J;
F=0;
}var B=C.pop();
this.moveToOffset(B,new r(O,P));
for(G=0;
G<B.nodes.length;
G++){L.push(B.nodes[G]);
}for(G=0;
G<B.links.length;
G++){K.push(B.links[G]);
}var A=B.bounds;
var D=A.height;
if(D<=0||isNaN(D)){D=0;
}var E=A.width;
if(E<=0||isNaN(E)){E=0;
}if(D>=F){F=D;
}O+=E+I;
}return{nodes:L,links:K};
},moveToOffset:function(B,K){var E,F,A=B.bounds,C=K.x-A.x,D=K.y-A.y;
for(E=0;
E<B.nodes.length;
E++){var I=B.nodes[E];
var J=I.bounds();
if(J.width===0&&J.height===0&&J.x===0&&J.y===0){J=new s(0,0,0,0);
}J.x+=C;
J.y+=D;
I.bounds(J);
}for(E=0;
E<B.links.length;
E++){var G=B.links[E];
if(G.points){var H=[];
var L=G.points;
for(F=0;
F<L.length;
F++){var M=L[F];
M.x+=C;
M.y+=D;
H.push(M);
}G.points=H;
}}this.currentHorizontalOffset+=A.width+this.options.grid.offsetX;
return new r(C,D);
},transferOptions:function(A){this.options=l.deepExtend({},this.defaultOptions);
if(z.isUndefined(A)){return;
}this.options=l.deepExtend(this.options,A||{});
}});
var f=l.Class.extend({init:function(A){this.nodeMap=new g();
this.shapeMap=new g();
this.nodes=[];
this.edges=[];
this.edgeMap=new g();
this.finalNodes=[];
this.finalLinks=[];
this.ignoredConnections=[];
this.ignoredShapes=[];
this.hyperMap=new g();
this.hyperTree=new i();
this.finalGraph=null;
this.diagram=A;
},convert:function(A){if(z.isUndefined(this.diagram)){throw"No diagram to convert.";
}this.options=l.deepExtend({ignoreInvisible:true,ignoreContainers:true,layoutContainerChildren:false},A||{});
this.clear();
this._renormalizeShapes();
this._renormalizeConnections();
this.finalNodes=new g(this.nodes);
this.finalLinks=new g(this.edges);
this.finalGraph=new i();
this.finalNodes.forEach(function(B){this.finalGraph.addNode(B);
},this);
this.finalLinks.forEach(function(B){this.finalGraph.addExistingLink(B);
},this);
return this.finalGraph;
},mapConnection:function(A){return this.edgeMap.get(A.id);
},mapShape:function(A){return this.nodeMap.get(A.id);
},getEdge:function(A,B){return z.first(A.links,function(C){return C.getComplement(A)===B;
});
},clear:function(){this.finalGraph=null;
this.hyperTree=!this.options.ignoreContainers&&this.options.layoutContainerChildren?new k():null;
this.hyperMap=!this.options.ignoreContainers&&this.options.layoutContainerChildren?new g():null;
this.nodeMap=new g();
this.shapeMap=new g();
this.nodes=[];
this.edges=[];
this.edgeMap=new g();
this.ignoredConnections=[];
this.ignoredShapes=[];
this.finalNodes=[];
this.finalLinks=[];
},listToRoot:function(A){var B=[];
var C=A.container;
if(!C){return B;
}B.push(C);
while(C.parentContainer){C=C.parentContainer;
B.push(C);
}B.reverse();
return B;
},firstNonIgnorableContainer:function(A){if(A.isContainer&&!this._isIgnorableItem(A)){return A;
}return !A.parentContainer?null:this.firstNonIgnorableContainer(A.parentContainer);
},isContainerConnection:function(A,B){if(A.isContainer&&this.isDescendantOf(A,B)){return true;
}return B.isContainer&&this.isDescendantOf(B,A);
},isDescendantOf:function(F,A){if(!F.isContainer){throw"Expecting a container.";
}if(F===A){return false;
}if(b(F.children,A)){return true;
}var C=[];
for(var D=0,E=F.children.length;
D<E;
D++){var B=F.children[D];
if(B.isContainer&&this.isDescendantOf(B,A)){C.push(B);
}}return C.length>0;
},isIgnorableItem:function(A){if(this.options.ignoreInvisible){if(A.isCollapsed&&this._isVisible(A)){return false;
}if(!A.isCollapsed&&this._isVisible(A)){return false;
}return true;
}else{return A.isCollapsed&&!this._isTop(A);
}},isShapeMapped:function(A){return A.isCollapsed&&!this._isVisible(A)&&!this._isTop(A);
},leastCommonAncestor:function(A,C){if(!A){throw"Parameter should not be null.";
}if(!C){throw"Parameter should not be null.";
}if(!this.hyperTree){throw"No hypertree available.";
}var B=this.listToRoot(A);
var D=this.listToRoot(C);
var E=null;
if(z.isEmpty(B)||z.isEmpty(D)){return this.hyperTree.root.data;
}var G=B[0];
var H=D[0];
var F=0;
while(G===H){E=B[F];
F++;
if(F>=B.length||F>=D.length){break;
}G=B[F];
H=D[F];
}if(!E){return this.hyperTree.root.data;
}else{return j(this.hyperTree.nodes,function(I){return I.data.container===E;
});
}},_isTop:function(A){return !A.parentContainer;
},_isVisible:function(A){if(!A.visible()){return false;
}return !A.parentContainer?A.visible():this._isVisible(A.parentContainer);
},_isCollapsed:function(A){if(A.isContainer&&A.isCollapsed){return true;
}return A.parentContainer&&this._isCollapsed(A.parentContainer);
},_renormalizeShapes:function(){if(this.options.ignoreContainers){for(var A=0,B=this.diagram.shapes.length;
A<B;
A++){var D=this.diagram.shapes[A];
if(this.options.ignoreInvisible&&!this._isVisible(D)||D.isContainer){this.ignoredShapes.push(D);
continue;
}var C=new q(D.id,D);
C.isVirtual=false;
this.nodeMap.add(D.id,C);
this.nodes.push(C);
}}else{throw"Containers are not supported yet, but stay tuned.";
}},_renormalizeConnections:function(){if(this.diagram.connections.length===0){return;
}for(var B=0,C=this.diagram.connections.length;
B<C;
B++){var A=this.diagram.connections[B];
if(this.isIgnorableItem(A)){this.ignoredConnections.push(A);
continue;
}var G=!A.sourceConnector?null:A.sourceConnector.shape;
var E=!A.targetConnector?null:A.targetConnector.shape;
if(!G||!E){this.ignoredConnections.push(A);
continue;
}if(b(this.ignoredShapes,G)&&!this.shapeMap.containsKey(G)){this.ignoredConnections.push(A);
continue;
}if(b(this.ignoredShapes,E)&&!this.shapeMap.containsKey(E)){this.ignoredConnections.push(A);
continue;
}if(this.shapeMap.containsKey(G)){G=this.shapeMap[G];
}if(this.shapeMap.containsKey(E)){E=this.shapeMap[E];
}var H=this.mapShape(G);
var F=this.mapShape(E);
if(H===F||this.areConnectedAlready(H,F)){this.ignoredConnections.push(A);
continue;
}if(H===null||F===null){throw"A shape was not mapped to a node.";
}if(this.options.ignoreContainers){if(H.isVirtual||F.isVirtual){this.ignoredConnections.push(A);
continue;
}var D=new p(H,F,A.id,A);
this.edgeMap.add(A.id,D);
this.edges.push(D);
}else{throw"Containers are not supported yet, but stay tuned.";
}}},areConnectedAlready:function(B,A){return z.any(this.edges,function(C){return C.source===B&&C.target===A||C.source===A&&C.target===B;
});
}});
var v=n.extend({init:function(A){var B=this;
n.fn.init.call(B);
if(z.isUndefined(A)){throw"Diagram is not specified.";
}this.diagram=A;
},layout:function(G){this.transferOptions(G);
var A=new f(this.diagram);
var E=A.convert(G);
if(E.isEmpty()){return;
}var C=E.getConnectedComponents();
if(z.isEmpty(C)){return;
}for(var F=0;
F<C.length;
F++){var B=C[F];
this.layoutGraph(B,G);
}var D=this.gridLayoutComponents(C);
return new e.LayoutState(this.diagram,D);
},layoutGraph:function(A,D){if(z.isDefined(D)){this.transferOptions(D);
}this.graph=A;
var C=this.options.nodeDistance*9;
this.temperature=C;
var B=this._expectedBounds();
this.width=B.width;
this.height=B.height;
for(var E=0;
E<this.options.iterations;
E++){this.refineStage=E>=this.options.iterations*5/6;
this.tick();
this.temperature=this.refineStage?C/30:C*(1-E/(2*this.options.iterations));
}},tick:function(){var A;
for(A=0;
A<this.graph.nodes.length;
A++){this._repulsion(this.graph.nodes[A]);
}for(A=0;
A<this.graph.links.length;
A++){this._attraction(this.graph.links[A]);
}for(A=0;
A<this.graph.nodes.length;
A++){var B=this.graph.nodes[A];
var C=Math.sqrt(B.dx*B.dx+B.dy*B.dy);
if(C===0){return;
}B.x+=Math.min(C,this.temperature)*B.dx/C;
B.y+=Math.min(C,this.temperature)*B.dy/C;
if(this.options.limitToView){B.x=Math.min(this.width,Math.max(B.width/2,B.x));
B.y=Math.min(this.height,Math.max(B.height/2,B.y));
}}},_shake:function(B){var C=Math.random()*this.options.nodeDistance/4;
var A=Math.random()*2*Math.PI;
B.x+=C*Math.cos(A);
B.y-=C*Math.sin(A);
},_InverseSquareForce:function(A,H,G){var D;
if(!this.refineStage){D=Math.pow(A,2)/Math.pow(this.options.nodeDistance,2);
}else{var B=H.x-G.x;
var C=H.y-G.y;
var J=H.width/2;
var F=H.height/2;
var I=G.width/2;
var E=G.height/2;
D=Math.pow(B,2)/Math.pow(J+I+this.options.nodeDistance,2)+Math.pow(C,2)/Math.pow(F+E+this.options.nodeDistance,2);
}return D*4/3;
},_SquareForce:function(A,C,B){return 1/this._InverseSquareForce(A,C,B);
},_repulsion:function(A){A.dx=0;
A.dy=0;
z.forEach(this.graph.nodes,function(C){if(C===A){return;
}while(A.x===C.x&&A.y===C.y){this._shake(C);
}var E=A.x-C.x;
var F=A.y-C.y;
var B=Math.sqrt(E*E+F*F);
var D=this._SquareForce(B,A,C)*2;
A.dx+=E/B*D;
A.dy+=F/B*D;
},this);
},_attraction:function(E){var G=E.target;
var F=E.source;
if(F===G){return;
}while(F.x===G.x&&F.y===G.y){this._shake(G);
}var H=F.x-G.x;
var I=F.y-G.y;
var B=Math.sqrt(H*H+I*I);
var A=this._InverseSquareForce(B,F,G)*5;
var C=H/B*A;
var D=I/B*A;
G.dx+=C;
G.dy+=D;
F.dx-=C;
F.dy-=D;
},_expectedBounds:function(){var F,D=this.graph.nodes.length,E=1.5,C=4;
if(D===0){return F;
}F=z.fold(this.graph.nodes,function(K,J){var I=J.width*J.height;
if(I>0){K+=Math.sqrt(I);
return K;
}return 0;
},0,this);
var A=F/D;
var G=A*Math.ceil(Math.sqrt(D));
var H=G*Math.sqrt(E);
var B=G/Math.sqrt(E);
return{width:H*C,height:B*C};
}});
var x=l.Class.extend({init:function(A){this.center=null;
this.options=A;
},layout:function(B,A){this.graph=B;
if(!this.graph.nodes||this.graph.nodes.length===0){return;
}if(!b(this.graph.nodes,A)){throw"The given root is not in the graph.";
}this.center=A;
this.graph.cacheRelationships();
this.layoutSwitch();
},layoutLeft:function(C){this.setChildrenDirection(this.center,"Left",false);
this.setChildrenLayout(this.center,"Default",false);
var A=0,G=0,I,B,D;
for(B=0;
B<C.length;
B++){D=C[B];
D.TreeDirection="Left";
var F=this.measure(D,u.Empty);
G=Math.max(G,F.Width);
A+=F.height+this.options.verticalSeparation;
}A-=this.options.verticalSeparation;
var H=this.center.x-this.options.horizontalSeparation;
I=this.center.y+(this.center.height-A)/2;
for(B=0;
B<C.length;
B++){D=C[B];
var E=new r(H-D.Size.width,I);
this.arrange(D,E);
I+=D.Size.height+this.options.verticalSeparation;
}},layoutRight:function(E){this.setChildrenDirection(this.center,"Right",false);
this.setChildrenLayout(this.center,"Default",false);
var A=0,G=0,I,B,C;
for(B=0;
B<E.length;
B++){C=E[B];
C.TreeDirection="Right";
var F=this.measure(C,u.Empty);
G=Math.max(G,F.Width);
A+=F.height+this.options.verticalSeparation;
}A-=this.options.verticalSeparation;
var H=this.center.x+this.options.horizontalSeparation+this.center.width;
I=this.center.y+(this.center.height-A)/2;
for(B=0;
B<E.length;
B++){C=E[B];
var D=new r(H,I);
this.arrange(C,D);
I+=C.Size.height+this.options.verticalSeparation;
}},layoutUp:function(E){this.setChildrenDirection(this.center,"Up",false);
this.setChildrenLayout(this.center,"Default",false);
var F=0,H,B,A;
for(A=0;
A<E.length;
A++){B=E[A];
B.TreeDirection="Up";
var D=this.measure(B,u.Empty);
F+=D.width+this.options.horizontalSeparation;
}F-=this.options.horizontalSeparation;
var G=this.center.x+this.center.width/2-F/2;
for(A=0;
A<E.length;
A++){B=E[A];
H=this.center.y-this.options.verticalSeparation-B.Size.height;
var C=new r(G,H);
this.arrange(B,C);
G+=B.Size.width+this.options.horizontalSeparation;
}},layoutDown:function(A){var C,B;
this.setChildrenDirection(this.center,"Down",false);
this.setChildrenLayout(this.center,"Default",false);
var F=0,H;
for(B=0;
B<A.length;
B++){C=A[B];
C.treeDirection="Down";
var E=this.measure(C,u.Empty);
F+=E.width+this.options.horizontalSeparation;
}F-=this.options.horizontalSeparation;
var G=this.center.x+this.center.width/2-F/2;
H=this.center.y+this.options.verticalSeparation+this.center.height;
for(B=0;
B<A.length;
B++){C=A[B];
var D=new r(G,H);
this.arrange(C,D);
G+=C.Size.width+this.options.horizontalSeparation;
}},layoutRadialTree:function(){this.setChildrenDirection(this.center,"Radial",false);
this.setChildrenLayout(this.center,"Default",false);
this.previousRoot=null;
var B=this.options.startRadialAngle*d;
var A=this.options.endRadialAngle*d;
if(A<=B){throw"Final angle should not be less than the start angle.";
}this.maxDepth=0;
this.origin=new r(this.center.x,this.center.y);
this.calculateAngularWidth(this.center,0);
if(this.maxDepth>0){this.radialLayout(this.center,this.options.radialFirstLevelSeparation,B,A);
}this.center.Angle=A-B;
},tipOverTree:function(A,F){if(z.isUndefined(F)){F=0;
}this.setChildrenDirection(this.center,"Down",false);
this.setChildrenLayout(this.center,"Default",false);
this.setChildrenLayout(this.center,"Underneath",false,F);
var G=0,I,C,B;
for(B=0;
B<A.length;
B++){C=A[B];
C.TreeDirection="Down";
var E=this.measure(C,u.Empty);
G+=E.width+this.options.horizontalSeparation;
}G-=this.options.horizontalSeparation;
G-=A[A.length-1].width;
G+=A[A.length-1].associatedShape.bounds().width;
var H=this.center.x+this.center.width/2-G/2;
I=this.center.y+this.options.verticalSeparation+this.center.height;
for(B=0;
B<A.length;
B++){C=A[B];
var D=new r(H,I);
this.arrange(C,D);
H+=C.Size.width+this.options.horizontalSeparation;
}},calculateAngularWidth:function(H,C){if(C>this.maxDepth){this.maxDepth=C;
}var A=0,I=1000,E=1000,D=C===0?0:Math.sqrt(I*I+E*E)/C;
if(H.children.length>0){for(var F=0,G=H.children.length;
F<G;
F++){var B=H.children[F];
A+=this.calculateAngularWidth(B,C+1);
}A=Math.max(D,A);
}else{A=D;
}H.sectorAngle=A;
return A;
},sortChildren:function(J){var B=0,G;
if(J.parents.length>1){throw"Node is not part of a tree.";
}var L=J.parents[0];
if(L){var M=new r(L.x,L.y);
var K=new r(J.x,J.y);
B=this.normalizeAngle(Math.atan2(M.y-K.y,M.x-K.x));
}var F=J.children.length;
if(F===0){return null;
}var A=[];
var H=[];
for(G=0;
G<F;
++G){var C=J.children[G];
var I=new r(C.x,C.y);
H[G]=G;
A[G]=this.normalizeAngle(-B+Math.atan2(I.y-I.y,I.x-I.x));
}z.bisort(A,H);
var E=[];
var D=J.children;
for(G=0;
G<F;
++G){E.push(D[H[G]]);
}return E;
},normalizeAngle:function(A){while(A>Math.PI*2){A-=2*Math.PI;
}while(A<0){A+=Math.PI*2;
}return A;
},radialLayout:function(J,L,N,F){var D=F-N;
var E=D/2;
var K=J.sectorAngle;
var G=0;
var M=this.sortChildren(J);
for(var H=0,I=M.length;
H<I;
H++){var B=M[H];
var C=B;
var A=C.sectorAngle/K;
if(B.children.length>0){this.radialLayout(B,L+this.options.radialSeparation,N+G*D,N+(G+A)*D);
}this.setPolarLocation(B,L,N+G*D+A*E);
C.angle=A*D;
G+=A;
}},setPolarLocation:function(B,C,A){B.x=this.origin.x+C*Math.cos(A);
B.y=this.origin.y+C*Math.sin(A);
B.BoundingRectangle=new s(B.x,B.y,B.width,B.height);
},setChildrenDirection:function(C,A,B){var D=C.treeDirection;
this.graph.depthFirstTraversal(C,function(E){E.treeDirection=A;
});
if(!B){C.treeDirection=D;
}},setChildrenLayout:function(C,B,A,E){if(z.isUndefined(E)){E=0;
}var D=C.childrenLayout;
if(E>0){this.graph.assignLevels(C);
this.graph.depthFirstTraversal(C,function(F){if(F.level>=E+1){F.childrenLayout=B;
}});
}else{this.graph.depthFirstTraversal(C,function(F){F.childrenLayout=B;
});
if(!A){C.childrenLayout=D;
}}},measure:function(F,C){var L=0,D=0,I;
var H=new u(0,0);
if(!F){throw"";
}var A=F.associatedShape.bounds();
var K=A.width;
var J=A.height;
if(F.parents.length!==1){throw"Node not in a spanning tree.";
}var G=F.parents[0];
if(F.treeDirection==="Undefined"){F.treeDirection=G.treeDirection;
}if(z.isEmpty(F.children)){H=new u(Math.abs(K)<h?50:K,Math.abs(J)<h?25:J);
}else{if(F.children.length===1){switch(F.treeDirection){case"Radial":I=this.measure(F.children[0],C);
L=K+this.options.radialSeparation*Math.cos(F.AngleToParent)+I.width;
D=J+Math.abs(this.options.radialSeparation*Math.sin(F.AngleToParent))+I.height;
break;
case"Left":case"Right":switch(F.childrenLayout){case"TopAlignedWithParent":break;
case"BottomAlignedWithParent":break;
case"Underneath":I=this.measure(F.children[0],C);
L=K+I.width+this.options.underneathHorizontalOffset;
D=J+this.options.underneathVerticalTopOffset+I.height;
break;
case"Default":I=this.measure(F.children[0],C);
L=K+this.options.horizontalSeparation+I.width;
D=Math.max(J,I.height);
break;
default:throw"Unhandled TreeDirection in the Radial layout measuring.";
}break;
case"Up":case"Down":switch(F.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":I=this.measure(F.children[0],C);
L=Math.max(K,I.width+this.options.underneathHorizontalOffset);
D=J+this.options.underneathVerticalTopOffset+I.height;
break;
case"Default":I=this.measure(F.children[0],C);
D=J+this.options.verticalSeparation+I.height;
L=Math.max(K,I.width);
break;
default:throw"Unhandled TreeDirection in the Down layout measuring.";
}break;
default:throw"Unhandled TreeDirection in the layout measuring.";
}H=new u(L,D);
}else{var E,B;
switch(F.treeDirection){case"Left":case"Right":switch(F.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":L=K;
D=J+this.options.underneathVerticalTopOffset;
for(E=0;
E<F.children.length;
E++){B=F.children[E];
I=this.measure(B,C);
L=Math.max(L,I.width+this.options.underneathHorizontalOffset);
D+=I.height+this.options.underneathVerticalSeparation;
}D-=this.options.underneathVerticalSeparation;
break;
case"Default":L=K;
D=0;
for(E=0;
E<F.children.length;
E++){B=F.children[E];
I=this.measure(B,C);
L=Math.max(L,K+this.options.horizontalSeparation+I.width);
D+=I.height+this.options.verticalSeparation;
}D-=this.options.verticalSeparation;
break;
default:throw"Unhandled TreeDirection in the Right layout measuring.";
}break;
case"Up":case"Down":switch(F.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":L=K;
D=J+this.options.underneathVerticalTopOffset;
for(E=0;
E<F.children.length;
E++){B=F.children[E];
I=this.measure(B,C);
L=Math.max(L,I.width+this.options.underneathHorizontalOffset);
D+=I.height+this.options.underneathVerticalSeparation;
}D-=this.options.underneathVerticalSeparation;
break;
case"Default":L=0;
D=0;
for(E=0;
E<F.children.length;
E++){B=F.children[E];
I=this.measure(B,C);
L+=I.width+this.options.horizontalSeparation;
D=Math.max(D,I.height+this.options.verticalSeparation+J);
}L-=this.options.horizontalSeparation;
break;
default:throw"Unhandled TreeDirection in the Down layout measuring.";
}break;
default:throw"Unhandled TreeDirection in the layout measuring.";
}H=new u(L,D);
}}F.SectorAngle=Math.sqrt(L*L/4+D*D/4);
F.Size=H;
return H;
},arrange:function(E,G){var D,H,B,F,C,A=E.associatedShape.bounds();
var K=A.width;
var J=A.height;
if(z.isEmpty(E.children)){E.x=G.x;
E.y=G.y;
E.BoundingRectangle=new s(G.x,G.y,K,J);
}else{var L,M;
var I;
switch(E.treeDirection){case"Left":switch(E.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":I=G;
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
M=G.y+J+this.options.underneathVerticalTopOffset;
for(D=0;
D<F.children.length;
D++){F=F.children[D];
L=I.x-F.associatedShape.width-this.options.underneathHorizontalOffset;
H=new r(L,M);
this.arrange(F,H);
M+=F.Size.height+this.options.underneathVerticalSeparation;
}break;
case"Default":I=new r(G.x+E.Size.width-K,G.y+(E.Size.height-J)/2);
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
L=I.x-this.options.horizontalSeparation;
M=G.y;
for(D=0;
D<E.children.length;
D++){F=E.children[D];
H=new r(L-F.Size.width,M);
this.arrange(F,H);
M+=F.Size.height+this.options.verticalSeparation;
}break;
default:throw"Unsupported TreeDirection";
}break;
case"Right":switch(E.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":I=G;
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
L=G.x+K+this.options.underneathHorizontalOffset;
M=G.y+J+this.options.underneathVerticalTopOffset;
for(D=0;
D<E.children.length;
D++){F=E.children[D];
H=new r(L,M);
this.arrange(F,H);
M+=F.Size.height+this.options.underneathVerticalSeparation;
}break;
case"Default":I=new r(G.x,G.y+(E.Size.height-J)/2);
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
L=G.x+K+this.options.horizontalSeparation;
M=G.y;
for(D=0;
D<E.children.length;
D++){F=E.children[D];
H=new r(L,M);
this.arrange(F,H);
M+=F.Size.height+this.options.verticalSeparation;
}break;
default:throw"Unsupported TreeDirection";
}break;
case"Up":I=new r(G.x+(E.Size.width-K)/2,G.y+E.Size.height-J);
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
if(Math.abs(I.x-G.x)<h){C=0;
for(D=0;
D<E.children.length;
D++){B=E.children[D];
C+=B.Size.width+this.options.horizontalSeparation;
}C-=this.options.horizontalSeparation;
L=G.x+(K-C)/2;
}else{L=G.x;
}for(D=0;
D<E.children.length;
D++){F=E.children[D];
M=I.y-this.options.verticalSeparation-F.Size.height;
H=new r(L,M);
this.arrange(F,H);
L+=F.Size.width+this.options.horizontalSeparation;
}break;
case"Down":switch(E.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;
case"Underneath":I=G;
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
L=G.x+this.options.underneathHorizontalOffset;
M=G.y+J+this.options.underneathVerticalTopOffset;
for(D=0;
D<E.children.length;
D++){F=E.children[D];
H=new r(L,M);
this.arrange(F,H);
M+=F.Size.height+this.options.underneathVerticalSeparation;
}break;
case"Default":I=new r(G.x+(E.Size.width-K)/2,G.y);
E.x=I.x;
E.y=I.y;
E.BoundingRectangle=new s(E.x,E.y,E.width,E.height);
if(Math.abs(I.x-G.x)<h){C=0;
for(D=0;
D<E.children.length;
D++){B=E.children[D];
C+=B.Size.width+this.options.horizontalSeparation;
}C-=this.options.horizontalSeparation;
L=G.x+(K-C)/2;
}else{L=G.x;
}for(D=0;
D<E.children.length;
D++){F=E.children[D];
M=I.y+this.options.verticalSeparation+J;
H=new r(L,M);
this.arrange(F,H);
L+=F.Size.width+this.options.horizontalSeparation;
}break;
default:throw"Unsupported TreeDirection";
}break;
case"None":break;
default:throw"Unsupported TreeDirection";
}}},layoutSwitch:function(){if(!this.center){return;
}if(z.isEmpty(this.center.children)){return;
}var F=this.options.subtype;
if(z.isUndefined(F)){F="Down";
}var E,D,B,C;
var A=this.center.children;
switch(F.toLowerCase()){case"radial":case"radialtree":this.layoutRadialTree();
break;
case"mindmaphorizontal":case"mindmap":E=this.center.children;
if(this.center.children.length===1){this.layoutRight(E);
}else{C=A.length/2;
D=j(this.center.children,function(G){return z.indexOf(A,G)<C;
});
B=j(this.center.children,function(G){return z.indexOf(A,G)>=C;
});
this.layoutLeft(D);
this.layoutRight(B);
}break;
case"mindmapvertical":E=this.center.children;
if(this.center.children.length===1){this.layoutDown(E);
}else{C=A.length/2;
D=j(this.center.children,function(G){return z.indexOf(A,G)<C;
});
B=j(this.center.children,function(G){return z.indexOf(A,G)>=C;
});
this.layoutUp(D);
this.layoutDown(B);
}break;
case"right":this.layoutRight(this.center.children);
break;
case"left":this.layoutLeft(this.center.children);
break;
case"up":case"bottom":this.layoutUp(this.center.children);
break;
case"down":case"top":this.layoutDown(this.center.children);
break;
case"tipover":case"tipovertree":if(this.options.tipOverTreeStartLevel<0){throw"The tip-over level should be a positive integer.";
}this.tipOverTree(this.center.children,this.options.tipOverTreeStartLevel);
break;
case"undefined":case"none":break;
}}});
var w=n.extend({init:function(A){var B=this;
n.fn.init.call(B);
if(z.isUndefined(A)){throw"No diagram specified.";
}this.diagram=A;
},layout:function(C){this.transferOptions(C);
var A=new f(this.diagram);
this.graph=A.convert();
var B=this.layoutComponents();
return new e.LayoutState(this.diagram,B);
},layoutComponents:function(){if(this.graph.isEmpty()){return;
}var B=this.graph.getConnectedComponents();
if(z.isEmpty(B)){return;
}var D=new x(this.options);
var H=[];
for(var C=0;
C<B.length;
C++){var A=B[C];
var G=this.getTree(A);
if(!G){throw"Failed to find a spanning tree for the component.";
}var E=G.root;
var F=G.tree;
D.layout(F,E);
H.push(F);
}return this.gridLayoutComponents(H);
},getTree:function(B){var G=null;
if(this.options.roots&&this.options.roots.length>0){for(var C=0,E=B.nodes.length;
C<E;
C++){var F=B.nodes[C];
for(var D=0;
D<this.options.roots.length;
D++){var A=this.options.roots[D];
if(A===F.associatedShape){G=F;
break;
}}}}if(!G){G=B.root();
if(!G){throw"Unable to find a root for the tree.";
}}return this.getTreeForRoot(B,G);
},getTreeForRoot:function(A,B){var C=A.getSpanningTree(B);
if(z.isUndefined(C)||C.isEmpty()){return null;
}return{tree:C,root:C.root};
}});
var m=n.extend({init:function(A){var B=this;
n.fn.init.call(B);
if(z.isUndefined(A)){throw"Diagram is not specified.";
}this.diagram=A;
},layout:function(G){this.transferOptions(G);
var A=new f(this.diagram);
var E=A.convert(G);
if(E.isEmpty()){return;
}var C=E.getConnectedComponents();
if(z.isEmpty(C)){return;
}for(var F=0;
F<C.length;
F++){var B=C[F];
this.layoutGraph(B,G);
}var D=this.gridLayoutComponents(C);
return new e.LayoutState(this.diagram,D);
},_initRuntimeProperties:function(){for(var A=0;
A<this.graph.nodes.length;
A++){var B=this.graph.nodes[A];
B.layer=-1;
B.downstreamLinkCount=0;
B.upstreamLinkCount=0;
B.isVirtual=false;
B.uBaryCenter=0;
B.dBaryCenter=0;
B.upstreamPriority=0;
B.downstreamPriority=0;
B.gridPosition=0;
}},_prepare:function(B){var A=[],C,D,H;
var G=new g();
var F=0;
var O,K,N;
z.forEach(B.nodes,function(P){if(P.incoming.length===0){G.set(P,0);
A.push(P);
}});
while(A.length>0){K=A.shift();
for(C=0;
C<K.outgoing.length;
C++){H=K.outgoing[C];
N=H.target;
if(G.containsKey(N)){O=Math.max(G.get(K)+1,G.get(N));
}else{O=G.get(K)+1;
}G.set(N,O);
if(O>F){F=O;
}if(!b(A,N)){A.push(N);
}}}var M=G.keys();
M.sort(function(P,R){var Q=G.get(P);
var S=G.get(R);
return z.sign(S-Q);
});
for(var J=0;
J<M.length;
++J){var L=M[J];
var I=Number.MAX_VALUE;
if(L.outgoing.length===0){continue;
}for(D=0;
D<L.outgoing.length;
++D){H=L.outgoing[D];
I=Math.min(I,G.get(H.target));
}if(I>1){G.set(L,I-1);
}}this.layers=[];
var E;
for(C=0;
C<F+1;
C++){E=[];
E.linksTo={};
this.layers.push(E);
}G.forEach(function(Q,P){Q.layer=P;
this.layers[P].push(Q);
},this);
for(D=0;
D<this.layers.length;
D++){E=this.layers[D];
for(C=0;
C<E.length;
C++){E[C].gridPosition=C;
}}},layoutGraph:function(A,B){if(z.isUndefined(A)){throw"No graph given or graph analysis of the diagram failed.";
}if(z.isDefined(B)){this.transferOptions(B);
}this.graph=A;
A.setItemIndices();
var C=A.makeAcyclic();
this._initRuntimeProperties();
this._prepare(A,B);
this._dummify();
this._optimizeCrossings();
this._swapPairs();
this.arrangeNodes();
this._moveThingsAround();
this._dedummify();
z.forEach(C,function(D){if(D.points){D.points.reverse();
}});
},setMinDist:function(C,E,D){var B=C.layer;
var A=C.layerIndex;
this.minDistances[B][A]=D;
},getMinDist:function(F,I){var A=0,B=F.layerIndex,C=I.layerIndex,E=F.layer,H=Math.min(B,C),G=Math.max(B,C);
for(var D=H;
D<G;
++D){A+=this.minDistances[E][D];
}return A;
},placeLeftToRight:function(G){var H=new g(),I,L;
for(var A=0;
A<this.layers.length;
++A){var B=G[A];
if(!B){continue;
}for(I=0;
I<B.length;
I++){L=B[I];
if(!H.containsKey(L)){this.placeLeft(L,H,A);
}}var C=Number.POSITIVE_INFINITY;
for(I=0;
I<B.length;
I++){L=B[I];
var M=this.rightSibling(L);
if(M&&this.nodeLeftClass.get(M)!==A){C=Math.min(C,H.get(M)-H.get(L)-this.getMinDist(L,M));
}}if(C===Number.POSITIVE_INFINITY){var E=[];
for(I=0;
I<B.length;
I++){L=B[I];
var K=[];
z.addRange(K,this.upNodes.get(L));
z.addRange(K,this.downNodes.get(L));
for(var F=0;
F<K.length;
F++){var J=K[F];
if(this.nodeLeftClass.get(J)<A){E.push(H.get(J)-H.get(L));
}}}E.sort();
if(E.length===0){C=0;
}else{if(E.length%2===1){C=E[this.intDiv(E.length,2)];
}else{C=(E[this.intDiv(E.length,2)-1]+E[this.intDiv(E.length,2)])/2;
}}}for(I=0;
I<B.length;
I++){L=B[I];
H.set(L,H.get(L)+C);
}}return H;
},placeRightToLeft:function(L){var M=new g(),H,K;
for(var A=0;
A<this.layers.length;
++A){var B=L[A];
if(!B){continue;
}for(H=0;
H<B.length;
H++){K=B[H];
if(!M.containsKey(K)){this.placeRight(K,M,A);
}}var C=Number.NEGATIVE_INFINITY;
for(H=0;
H<B.length;
H++){K=B[H];
var G=this.leftSibling(K);
if(G&&this.nodeRightClass.get(G)!==A){C=Math.max(C,M.get(G)-M.get(K)+this.getMinDist(G,K));
}}if(C===Number.NEGATIVE_INFINITY){var E=[];
for(H=0;
H<B.length;
H++){K=B[H];
var J=[];
z.addRange(J,this.upNodes.get(K));
z.addRange(J,this.downNodes.get(K));
for(var F=0;
F<J.length;
F++){var I=J[F];
if(this.nodeRightClass.get(I)<A){E.push(M.get(K)-M.get(I));
}}}E.sort();
if(E.length===0){C=0;
}else{if(E.length%2===1){C=E[this.intDiv(E.length,2)];
}else{C=(E[this.intDiv(E.length,2)-1]+E[this.intDiv(E.length,2)])/2;
}}}for(H=0;
H<B.length;
H++){K=B[H];
M.set(K,M.get(K)+C);
}}return M;
},_getLeftWing:function(){var A={value:null};
var B=this.computeClasses(A,1);
this.nodeLeftClass=A.value;
return B;
},_getRightWing:function(){var B={value:null};
var A=this.computeClasses(B,-1);
this.nodeRightClass=B.value;
return A;
},computeClasses:function(L,B){var A=0,K=L.value=new g();
for(var E=0;
E<this.layers.length;
++E){A=E;
var F=this.layers[E];
for(var G=B===1?0:F.length-1;
0<=G&&G<F.length;
G+=B){var I=F[G];
if(!K.containsKey(I)){K.set(I,A);
if(I.isVirtual){var H=this._nodesInLink(I);
for(var D=0;
D<H.length;
D++){var J=H[D];
K.set(J,A);
}}}else{A=K.get(I);
}}}var M=[];
for(var C=0;
C<this.layers.length;
C++){M.push(null);
}K.forEach(function(O,N){if(M[N]===null){M[N]=[];
}M[N].push(O);
});
return M;
},_isVerticalLayout:function(){return this.options.subtype.toLowerCase()==="up"||this.options.subtype.toLowerCase()==="down"||this.options.subtype.toLowerCase()==="vertical";
},_isHorizontalLayout:function(){return this.options.subtype.toLowerCase()==="right"||this.options.subtype.toLowerCase()==="left"||this.options.subtype.toLowerCase()==="horizontal";
},_isIncreasingLayout:function(){return this.options.subtype.toLowerCase()==="right"||this.options.subtype.toLowerCase()==="down";
},_moveThingsAround:function(){var G,J,Q,K,P,aa;
for(J=0;
J<this.layers.length;
++J){K=this.layers[J];
K.sort(this._gridPositionComparer);
}this.minDistances=[];
for(J=0;
J<this.layers.length;
++J){K=this.layers[J];
this.minDistances[J]=[];
for(P=0;
P<K.length;
++P){Q=K[P];
Q.layerIndex=P;
this.minDistances[J][P]=this.options.nodeDistance;
if(P<K.length-1){if(this._isVerticalLayout()){this.minDistances[J][P]+=(Q.width+K[P+1].width)/2;
}else{this.minDistances[J][P]+=(Q.height+K[P+1].height)/2;
}}}}this.downNodes=new g();
this.upNodes=new g();
z.forEach(this.graph.nodes,function(ac){this.downNodes.set(ac,[]);
this.upNodes.set(ac,[]);
},this);
z.forEach(this.graph.links,function(ae){var af=ae.source;
var ac=ae.target;
var ad=null,ag=null;
if(af.layer>ac.layer){ad=ae.source;
ag=ae.target;
}else{ag=ae.source;
ad=ae.target;
}this.downNodes.get(ag).push(ad);
this.upNodes.get(ad).push(ag);
},this);
this.downNodes.forEachValue(function(ac){ac.sort(this._gridPositionComparer);
},this);
this.upNodes.forEachValue(function(ac){ac.sort(this._gridPositionComparer);
},this);
for(J=0;
J<this.layers.length-1;
++J){K=this.layers[J];
for(aa=0;
aa<K.length-1;
aa++){var B=K[aa];
if(!B.isVirtual){continue;
}var A=this.downNodes.get(B)[0];
if(!A.isVirtual){continue;
}for(P=aa+1;
P<K.length;
++P){Q=K[P];
if(!Q.isVirtual){continue;
}var D=this.downNodes.get(Q)[0];
if(!D.isVirtual){continue;
}if(A.gridPosition>D.gridPosition){var U=A.gridPosition;
A.gridPosition=D.gridPosition;
D.gridPosition=U;
var H=A.layerIndex;
var I=D.layerIndex;
this.layers[J+1][H]=D;
this.layers[J+1][I]=A;
A.layerIndex=I;
D.layerIndex=H;
}}}}var M=this._getLeftWing();
var W=this._getRightWing();
var N=this.placeLeftToRight(M);
var X=this.placeRightToLeft(W);
var ab=new g();
z.forEach(this.graph.nodes,function(ac){ab.set(ac,(N.get(ac)+X.get(ac))/2);
});
var S=new g();
var T=new g();
for(J=0;
J<this.layers.length;
++J){K=this.layers[J];
var Z=-1,Y=-1;
for(P=0;
P<K.length;
++P){Q=K[P];
S.set(Q,0);
T.set(Q,false);
if(Q.isVirtual){if(Z===-1){Z=P;
}else{if(Z===P-1){Z=P;
}else{Y=P;
S.set(K[Z],0);
if(ab.get(Q)-ab.get(K[Z])===this.getMinDist(K[Z],Q)){T.set(K[Z],true);
}else{T.set(K[Z],false);
}Z=P;
}}}}}var C=[1,-1];
z.forEach(C,function(ac){var ag=ac===1?0:this.layers.length-1;
for(var ad=ag;
0<=ad&&ad<this.layers.length;
ad+=ac){var ae=this.layers[ad];
var ak=this._firstVirtualNode(ae);
var aj=null;
var af=null;
if(ak!==-1){aj=ae[ak];
af=[];
for(G=0;
G<ak;
G++){af.push(ae[G]);
}}else{aj=null;
af=ae;
}if(af.length>0){this._sequencer(ab,null,aj,ac,af);
for(G=0;
G<af.length-1;
++G){this.setMinDist(af[G],af[G+1],ab.get(af[G+1])-ab.get(af[G]));
}if(aj){this.setMinDist(af[af.length-1],aj,ab.get(aj)-ab.get(af[af.length-1]));
}}while(aj){var ah=this.nextVirtualNode(ae,aj);
if(!ah){ak=aj.layerIndex;
af=[];
for(G=ak+1;
G<ae.length;
G++){af.push(ae[G]);
}if(af.length>0){this._sequencer(ab,aj,null,ac,af);
for(G=0;
G<af.length-1;
++G){this.setMinDist(af[G],af[G+1],ab.get(af[G+1])-ab.get(af[G]));
}this.setMinDist(aj,af[0],ab.get(af[0])-ab.get(aj));
}}else{if(S.get(aj)===ac){ak=aj.layerIndex;
var ai=ah.layerIndex;
af=[];
for(G=ak+1;
G<ai;
G++){af.push(ae[G]);
}if(af.length>0){this._sequencer(ab,aj,ah,ac,af);
}T.set(aj,true);
}}aj=ah;
}this.adjustDirections(ad,ac,S,T);
}},this);
var E=this._isIncreasingLayout()?0:this.layers.length-1;
var V=function(ad,ac){if(ac._isIncreasingLayout()){return ad<ac.layers.length;
}else{return ad>=0;
}};
var L=this._isIncreasingLayout()?+1:-1,R=0;
function O(ae,ac){var ad=Number.MIN_VALUE;
for(var af=0;
af<ae.length;
++af){var ag=ae[af];
if(ac._isVerticalLayout()){ad=Math.max(ad,ag.height);
}else{ad=Math.max(ad,ag.width);
}}return ad;
}for(G=E;
V(G,this);
G+=L){K=this.layers[G];
var F=O(K,this);
for(P=0;
P<K.length;
++P){Q=K[P];
if(this._isVerticalLayout()){Q.x=ab.get(Q);
Q.y=R+F/2;
}else{Q.x=R+F/2;
Q.y=ab.get(Q);
}}R+=this.options.layerSeparation+F;
}},adjustDirections:function(I,B,N,P){if(I+B<0||I+B>=this.layers.length){return;
}var Q=null,R=null;
var J=this.layers[I+B];
for(var K=0;
K<J.length;
++K){var L=J[K];
if(L.isVirtual){var M=this.getNeighborOnLayer(L,I);
if(M.isVirtual){if(Q){var O=P.get(R);
var A=this.layers[I];
var D=R.layerIndex;
var E=M.layerIndex;
for(var C=D+1;
C<E;
++C){if(A[C].isVirtual){O=O&&P.get(A[C]);
}}if(O){N.set(Q,B);
var G=Q.layerIndex;
var H=L.layerIndex;
for(var F=G+1;
F<H;
++F){if(J[F].isVirtual){N.set(J[F],B);
}}}}Q=L;
R=M;
}}}},getNeighborOnLayer:function(C,A){var B=this.upNodes.get(C)[0];
if(B.layer===A){return B;
}B=this.downNodes.get(C)[0];
if(B.layer===A){return B;
}return null;
},_sequencer:function(G,F,E,A,C){if(C.length===1){this._sequenceSingle(G,F,E,A,C[0]);
}if(C.length>1){var B=C.length,D=this.intDiv(B,2);
this._sequencer(G,F,E,A,C.slice(0,D));
this._sequencer(G,F,E,A,C.slice(D));
this.combineSequences(G,F,E,A,C);
}},_sequenceSingle:function(G,F,E,A,D){var C=A===-1?this.downNodes.get(D):this.upNodes.get(D);
var B=C.length;
if(B!==0){if(B%2===1){G.set(D,G.get(C[this.intDiv(B,2)]));
}else{G.set(D,(G.get(C[this.intDiv(B,2)-1])+G.get(C[this.intDiv(B,2)]))/2);
}if(F){G.set(D,Math.max(G.get(D),G.get(F)+this.getMinDist(F,D)));
}if(E){G.set(D,Math.min(G.get(D),G.get(E)-this.getMinDist(D,E)));
}}},combineSequences:function(R,Q,P,B,N){var K=N.length,O=this.intDiv(K,2);
var D=[],C,A,G,I,H,J;
for(C=0;
C<O;
++C){A=0;
I=B===-1?this.downNodes.get(N[C]):this.upNodes.get(N[C]);
for(G=0;
G<I.length;
++G){H=I[G];
if(R.get(H)>=R.get(N[C])){A++;
}else{A--;
D.push({k:R.get(H)+this.getMinDist(N[C],N[O-1]),v:2});
}}D.push({k:R.get(N[C])+this.getMinDist(N[C],N[O-1]),v:A});
}if(Q){D.push({k:R.get(Q)+this.getMinDist(Q,N[O-1]),v:Number.MAX_VALUE});
}D.sort(this._positionDescendingComparer);
var L=[];
for(C=O;
C<K;
++C){A=0;
I=B===-1?this.downNodes.get(N[C]):this.upNodes.get(N[C]);
for(G=0;
G<I.length;
++G){H=I[G];
if(R.get(H)<=R.get(N[C])){A++;
}else{A--;
L.push({k:R.get(H)-this.getMinDist(N[C],N[O]),v:2});
}}L.push({k:R.get(N[C])-this.getMinDist(N[C],N[O]),v:A});
}if(P){L.push({k:R.get(P)-this.getMinDist(P,N[O]),v:Number.MAX_VALUE});
}L.sort(this._positionAscendingComparer);
var E=0,M=0;
var F=this.getMinDist(N[O-1],N[O]);
while(R.get(N[O])-R.get(N[O-1])<F){if(E<M){if(D.length===0){R.set(N[O-1],R.get(N[O])-F);
break;
}else{J=D.shift();
E=E+J.v;
R.set(N[O-1],J.k);
R.set(N[O-1],Math.max(R.get(N[O-1]),R.get(N[O])-F));
}}else{if(L.length===0){R.set(N[O],R.get(N[O-1])+F);
break;
}else{J=L.shift();
M=M+J.v;
R.set(N[O],J.k);
R.set(N[O],Math.min(R.get(N[O]),R.get(N[O-1])+F));
}}}for(C=O-2;
C>=0;
C--){R.set(N[C],Math.min(R.get(N[C]),R.get(N[O-1])-this.getMinDist(N[C],N[O-1])));
}for(C=O+1;
C<K;
C++){R.set(N[C],Math.max(R.get(N[C]),R.get(N[O])+this.getMinDist(N[C],N[O])));
}},placeLeft:function(C,B,A){var D=Number.NEGATIVE_INFINITY;
z.forEach(this._getComposite(C),function(F){var E=this.leftSibling(F);
if(E&&this.nodeLeftClass.get(E)===this.nodeLeftClass.get(F)){if(!B.containsKey(E)){this.placeLeft(E,B,A);
}D=Math.max(D,B.get(E)+this.getMinDist(E,F));
}},this);
if(D===Number.NEGATIVE_INFINITY){D=0;
}z.forEach(this._getComposite(C),function(E){B.set(E,D);
});
},placeRight:function(A,D,C){var B=Number.POSITIVE_INFINITY;
z.forEach(this._getComposite(A),function(F){var E=this.rightSibling(F);
if(E&&this.nodeRightClass.get(E)===this.nodeRightClass.get(F)){if(!D.containsKey(E)){this.placeRight(E,D,C);
}B=Math.min(B,D.get(E)-this.getMinDist(F,E));
}},this);
if(B===Number.POSITIVE_INFINITY){B=0;
}z.forEach(this._getComposite(A),function(E){D.set(E,B);
});
},leftSibling:function(C){var A=this.layers[C.layer],B=C.layerIndex;
return B===0?null:A[B-1];
},rightSibling:function(C){var A=this.layers[C.layer];
var B=C.layerIndex;
return B===A.length-1?null:A[B+1];
},_getComposite:function(A){return A.isVirtual?this._nodesInLink(A):[A];
},arrangeNodes:function(){var B,D,G,E,H;
for(D=0;
D<this.layers.length;
D++){E=this.layers[D];
for(G=0;
G<E.length;
G++){H=E[G];
H.upstreamPriority=H.upstreamLinkCount;
H.downstreamPriority=H.downstreamLinkCount;
}}var F=2;
for(var C=0;
C<F;
C++){for(B=this.layers.length-1;
B>=1;
B--){this.layoutLayer(false,B);
}for(B=0;
B<this.layers.length-1;
B++){this.layoutLayer(true,B);
}}var A=Number.MAX_VALUE;
for(D=0;
D<this.layers.length;
D++){E=this.layers[D];
for(G=0;
G<E.length;
G++){H=E[G];
A=Math.min(A,H.gridPosition);
}}if(A<0){for(D=0;
D<this.layers.length;
D++){E=this.layers[D];
for(G=0;
G<E.length;
G++){H=E[G];
H.gridPosition=H.gridPosition-A;
}}}},layoutLayer:function(B,D){var C;
var A;
if(B){A=this.layers[C=D+1];
}else{A=this.layers[C=D-1];
}var F=[];
for(var E=0;
E<A.length;
E++){F.push(A[E]);
}F.sort(function(G,I){var H=(G.upstreamPriority+G.downstreamPriority)/2;
var J=(I.upstreamPriority+I.downstreamPriority)/2;
if(Math.abs(H-J)<0.0001){return 0;
}if(H<J){return 1;
}return -1;
});
z.forEach(F,function(G){var I=G.gridPosition;
var H=this.calcBaryCenter(G);
var J=(G.upstreamPriority+G.downstreamPriority)/2;
if(Math.abs(I-H)<0.0001){return;
}if(Math.abs(I-H)<0.25+0.0001){return;
}if(I<H){while(I<H){if(!this.moveRight(G,A,J)){break;
}I=G.gridPosition;
}}else{while(I>H){if(!this.moveLeft(G,A,J)){break;
}I=G.gridPosition;
}}},this);
if(C>0){this.calcDownData(C-1);
}if(C<this.layers.length-1){this.calcUpData(C+1);
}},moveRight:function(C,B,D){var A=z.indexOf(B,C);
if(A===B.length-1){C.gridPosition=C.gridPosition+0.5;
return true;
}var E=B[A+1];
var F=(E.upstreamPriority+E.downstreamPriority)/2;
if(E.gridPosition>C.gridPosition+1){C.gridPosition=C.gridPosition+0.5;
return true;
}if(F>D||Math.abs(F-D)<0.0001){return false;
}if(this.moveRight(E,B,D)){C.gridPosition=C.gridPosition+0.5;
return true;
}return false;
},moveLeft:function(E,B,F){var A=z.indexOf(B,E);
if(A===0){E.gridPosition=E.gridPosition-0.5;
return true;
}var C=B[A-1];
var D=(C.upstreamPriority+C.downstreamPriority)/2;
if(C.gridPosition<E.gridPosition-1){E.gridPosition=E.gridPosition-0.5;
return true;
}if(D>F||Math.abs(D-F)<0.0001){return false;
}if(this.moveLeft(C,B,F)){E.gridPosition=E.gridPosition-0.5;
return true;
}return false;
},mapVirtualNode:function(B,A){this.nodeToLinkMap.set(B,A);
if(!this.linkToNodeMap.containsKey(A)){this.linkToNodeMap.set(A,[]);
}this.linkToNodeMap.get(A).push(B);
},_nodesInLink:function(A){return this.linkToNodeMap.get(this.nodeToLinkMap.get(A));
},_dummify:function(){this.linkToNodeMap=new g();
this.nodeToLinkMap=new g();
var G,R,L,M,S,K,E,F,J=this.graph.links.slice(0);
var H=this.layers;
var A=function(W,U,V){H[W].linksTo[U]=H[W].linksTo[U]||[];
H[W].linksTo[U].push(V);
};
for(F=0;
F<J.length;
F++){var I=J[F];
var N=I.source;
var B=I.target;
var O=N.layer;
var C=B.layer;
var P=N.gridPosition;
var D=B.gridPosition;
var T=(D-P)/Math.abs(C-O);
var Q=N;
if(O-C>1){for(E=O-1;
E>C;
E--){L=new q();
L.x=N.x;
L.y=N.y;
L.width=N.width/100;
L.height=N.height/100;
G=H[E];
R=(E-C)*T+P;
if(R>G.length){R=G.length;
}if(P>=H[O].length-1&&D>=H[C].length-1){R=G.length;
}else{if(P===0&&D===0){R=0;
}}L.layer=E;
L.uBaryCenter=0;
L.dBaryCenter=0;
L.upstreamLinkCount=0;
L.downstreamLinkCount=0;
L.gridPosition=R;
L.isVirtual=true;
z.insert(G,L,R);
for(S=R+1;
S<G.length;
S++){M=G[S];
M.gridPosition=M.gridPosition+1;
}K=new p(Q,L);
K.depthOfDumminess=0;
A(E-1,E,K);
Q=L;
this.graph._addNode(L);
this.graph.addLink(K);
L.index=this.graph.nodes.length-1;
this.mapVirtualNode(L,I);
}A(C-1,C,K);
I.changeSource(Q);
I.depthOfDumminess=O-C-1;
}else{if(O-C<-1){for(E=O+1;
E<C;
E++){L=new q();
L.x=N.x;
L.y=N.y;
L.width=N.width/100;
L.height=N.height/100;
G=H[E];
R=(E-O)*T+P;
if(R>G.length){R=G.length;
}if(P>=H[O].length-1&&D>=H[C].length-1){R=G.length;
}else{if(P===0&&D===0){R=0;
}}L.layer=E;
L.uBaryCenter=0;
L.dBaryCenter=0;
L.upstreamLinkCount=0;
L.downstreamLinkCount=0;
L.gridPosition=R;
L.isVirtual=true;
R&=R;
z.insert(G,L,R);
for(S=R+1;
S<G.length;
S++){M=G[S];
M.gridPosition=M.gridPosition+1;
}K=new p(Q,L);
K.depthOfDumminess=0;
A(E-1,E,K);
Q=L;
this.graph._addNode(L);
this.graph.addLink(K);
L.index=this.graph.nodes.length-1;
this.mapVirtualNode(L,I);
}A(C-1,C,I);
I.changeSource(Q);
I.depthOfDumminess=C-O-1;
}else{A(O,C,I);
}}}},_dedummify:function(){var B=true;
while(B){B=false;
for(var D=0;
D<this.graph.links.length;
D++){var E=this.graph.links[D];
if(!E.depthOfDumminess){continue;
}var G=[];
G.unshift({x:E.target.x,y:E.target.y});
G.unshift({x:E.source.x,y:E.source.y});
var I=E;
var C=E.depthOfDumminess;
for(var A=0;
A<C;
A++){var F=I.source;
var H=F.incoming[0];
G.unshift({x:H.source.x,y:H.source.y});
I=H;
}E.changeSource(I.source);
E.depthOfDumminess=0;
if(G.length>2){G.splice(0,1);
G.splice(G.length-1);
E.points=G;
}else{E.points=[];
}B=true;
break;
}}},_optimizeCrossings:function(){var D=-1,A;
var C=3;
var B=0;
while(D!==0){if(B++>C){break;
}D=0;
for(A=this.layers.length-1;
A>=1;
A--){D+=this.optimizeLayerCrossings(false,A);
}for(A=0;
A<this.layers.length-1;
A++){D+=this.optimizeLayerCrossings(true,A);
}}},calcUpData:function(D){if(D===0){return;
}var A=this.layers[D],B,C,E;
var J=new t();
var H=this.layers[D-1];
for(B=0;
B<H.length;
B++){J.add(H[B]);
}for(B=0;
B<A.length;
B++){var F=A[B];
var G=0;
var I=0;
for(C=0;
C<F.incoming.length;
C++){E=F.incoming[C];
if(J.contains(E.source)){I++;
G+=E.source.gridPosition;
}}for(C=0;
C<F.outgoing.length;
C++){E=F.outgoing[C];
if(J.contains(E.target)){I++;
G+=E.target.gridPosition;
}}if(I>0){F.uBaryCenter=G/I;
F.upstreamLinkCount=I;
}else{F.uBaryCenter=B;
F.upstreamLinkCount=0;
}}},calcDownData:function(E){if(E===this.layers.length-1){return;
}var A=this.layers[E],C,D,F;
var B=new t();
var I=this.layers[E+1];
for(C=0;
C<I.length;
C++){B.add(I[C]);
}for(C=0;
C<A.length;
C++){var G=A[C];
var H=0;
var J=0;
for(D=0;
D<G.incoming.length;
D++){F=G.incoming[D];
if(B.contains(F.source)){J++;
H+=F.source.gridPosition;
}}for(D=0;
D<G.outgoing.length;
D++){F=G.outgoing[D];
if(B.contains(F.target)){J++;
H+=F.target.gridPosition;
}}if(J>0){G.dBaryCenter=H/J;
G.downstreamLinkCount=J;
}else{G.dBaryCenter=C;
G.downstreamLinkCount=0;
}}},optimizeLayerCrossings:function(B,F){var D;
var A;
if(B){A=this.layers[D=F+1];
}else{A=this.layers[D=F-1];
}var I=A.slice(0);
if(B){this.calcUpData(D);
}else{this.calcDownData(D);
}var J=this;
A.sort(function(L,N){var M=J.calcBaryCenter(L),O=J.calcBaryCenter(N);
if(Math.abs(M-O)<0.0001){if(L.degree()===N.degree()){return J.compareByIndex(L,N);
}else{if(L.degree()<N.degree()){return 1;
}}return -1;
}var K=(O-M)*1000;
if(K>0){return -1;
}else{if(K<0){return 1;
}}return J.compareByIndex(L,N);
});
var C,G=0;
for(C=0;
C<A.length;
C++){if(A[C]!==I[C]){G++;
}}if(G>0){var E=0;
for(C=0;
C<A.length;
C++){var H=A[C];
H.gridPosition=E++;
}}return G;
},_swapPairs:function(){var J=this.options.layeredIterations;
var G=0;
while(true){if(G++>J){break;
}var E=G%4<=1;
var R=G%4===1;
for(var H=E?0:this.layers.length-1;
E?H<=this.layers.length-1:H>=0;
H+=E?1:-1){var I=this.layers[H];
var F=false;
var A=true;
var K=0;
for(var L=0;
L<I.length-1;
L++){var S=0;
var D=0;
var C=0;
if(A){if(H!==0){S=this.countLinksCrossingBetweenTwoLayers(H-1,H);
}if(H!==this.layers.length-1){D=this.countLinksCrossingBetweenTwoLayers(H,H+1);
}if(E){S*=2;
}else{D*=2;
}C=S+D;
}else{C=K;
}if(C===0){continue;
}var M=I[L];
var O=I[L+1];
var N=M.gridPosition;
var P=O.gridPosition;
I[L]=O;
I[L+1]=M;
M.gridPosition=P;
O.gridPosition=N;
S=0;
if(H!==0){S=this.countLinksCrossingBetweenTwoLayers(H-1,H);
}D=0;
if(H!==this.layers.length-1){D=this.countLinksCrossingBetweenTwoLayers(H,H+1);
}if(E){S*=2;
}else{D*=2;
}var B=S+D;
var Q=false;
if(R){Q=B>=C;
}else{Q=B>C;
}if(Q){M=I[L];
O=I[L+1];
N=M.gridPosition;
P=O.gridPosition;
I[L]=O;
I[L+1]=M;
M.gridPosition=P;
O.gridPosition=N;
K=C;
A=false;
}else{F=true;
A=true;
}}if(F){if(H!==this.layers.length-1){this.calcUpData(H+1);
}if(H!==0){this.calcDownData(H-1);
}}}}},countLinksCrossingBetweenTwoLayers:function(Q,B){var H=this.layers[Q].linksTo[B];
var F,G,I,K,M,O,C,D;
var A=0;
var E=H.length;
for(C=0;
C<E;
C++){F=H[C];
for(D=C+1;
D<E;
D++){G=H[D];
if(F.target.layer===B){I=F.source;
K=F.target;
}else{I=F.target;
K=F.source;
}if(G.target.layer===B){M=G.source;
O=G.target;
}else{M=G.target;
O=G.source;
}var J=I.gridPosition;
var L=K.gridPosition;
var N=M.gridPosition;
var P=O.gridPosition;
if((J-N)*(L-P)<0){A++;
}}}return A;
},calcBaryCenter:function(C){var E=C.upstreamLinkCount;
var B=C.downstreamLinkCount;
var D=C.uBaryCenter;
var A=C.dBaryCenter;
if(E>0&&B>0){return(D+A)/2;
}if(E>0){return D;
}if(B>0){return A;
}return 0;
},_gridPositionComparer:function(A,B){if(A.gridPosition<B.gridPosition){return -1;
}if(A.gridPosition>B.gridPosition){return 1;
}return 0;
},_positionAscendingComparer:function(A,B){return A.k<B.k?-1:A.k>B.k?1:0;
},_positionDescendingComparer:function(A,B){return A.k<B.k?1:A.k>B.k?-1:0;
},_firstVirtualNode:function(B){for(var A=0;
A<B.length;
A++){if(B[A].isVirtual){return A;
}}return -1;
},compareByIndex:function(C,D){var A=C.index;
var B=D.index;
if(A<B){return 1;
}if(A>B){return -1;
}return 0;
},intDiv:function(B,A){return(B-B%A)/A;
},nextVirtualNode:function(B,C){var D=C.layerIndex;
for(var A=D+1;
A<B.length;
++A){if(B[A].isVirtual){return B[A];
}}return null;
}});
var o=l.Class.extend({init:function(A,B){if(z.isUndefined(A)){throw"No diagram given";
}this.diagram=A;
this.nodeMap=new g();
this.linkMap=new g();
this.capture(B?B:A);
},capture:function(C){var G,H,I,D,A,E,F;
if(C instanceof e.Graph){for(D=0;
D<C.nodes.length;
D++){G=C.nodes[D];
I=G.associatedShape;
this.nodeMap.set(I.visual.id,new s(G.x,G.y,G.width,G.height));
}for(D=0;
D<C.links.length;
D++){E=C.links[D];
A=E.associatedConnection;
this.linkMap.set(A.visual.id,E.points());
}}else{if(C instanceof Array){H=C;
for(D=0;
D<H.length;
D++){G=H[D];
I=G.associatedShape;
if(I){this.nodeMap.set(I.visual.id,new s(G.x,G.y,G.width,G.height));
}}}else{if(C.hasOwnProperty("links")&&C.hasOwnProperty("nodes")){H=C.nodes;
F=C.links;
for(D=0;
D<H.length;
D++){G=H[D];
I=G.associatedShape;
if(I){this.nodeMap.set(I.visual.id,new s(G.x,G.y,G.width,G.height));
}}for(D=0;
D<F.length;
D++){E=F[D];
A=E.associatedConnection;
if(A){this.linkMap.set(A.visual.id,E.points);
}}}else{var J=this.diagram.shapes;
var B=this.diagram.connections;
for(D=0;
D<J.length;
D++){I=J[D];
this.nodeMap.set(I.visual.id,I.bounds());
}for(D=0;
D<B.length;
D++){A=B[D];
this.linkMap.set(A.visual.id,A.points());
}}}}}});
c(e,{init:function(A){l.init(A,e.ui);
},SpringLayout:v,TreeLayout:w,GraphAdapter:f,LayeredLayout:m,LayoutBase:n,LayoutState:o});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
(function(b,a){a("dataviz/diagram/dom",["kendo.data","kendo.draganddrop","kendo.toolbar","kendo.editable","kendo.window","kendo.dropdownlist","kendo.dataviz.core","kendo.dataviz.themes","dataviz/diagram/svg","dataviz/diagram/services","dataviz/diagram/layout"],b);
}(function(){(function(a,bd){var z=kendo.dataviz,V=kendo.drawing,ad=kendo.geometry,O=z.diagram,bg=kendo.ui.Widget,k=kendo.Class,aS=a.proxy,A=kendo.deepExtend,aL=kendo._outerWidth,aK=kendo._outerHeight,aa=a.extend,ag=kendo.data.HierarchicalDataSource,f=O.Canvas,ae=O.Group,aW=O.Rectangle,j=O.Circle,p=O.CompositeTransform,aV=O.Rect,aN=O.Path,N=O.DeleteShapeUnit,M=O.DeleteConnectionUnit,a5=O.TextBlock,ah=O.Image,aO=O.Point,al=O.Intersect,s=O.ConnectionEditAdorner,be=O.UndoRedoService,a8=O.ToolService,a1=O.Selector,aX=O.ResizingAdorner,v=O.ConnectorsAdorner,y=O.Cursors,bf=O.Utils,aJ=kendo.Observable,a6=O.ToBackUnit,a7=O.ToFrontUnit,aP=O.PolylineRouter,h=O.CascadingRouter,at=bf.isUndefined,ao=bf.isDefined,L=V.util.defined,am=a.isArray,ap=kendo.isFunction,ar=bf.isString,aq=a.isPlainObject,ax=Math;
var aI=".kendoDiagram",g="cascading",au="itemBoundsChange",i="change",m="click",S="drag",T="dragEnd",U="dragStart",aD="mouseEnter",aE="mouseLeave",Z="error",c="Auto",a9="Top",aY="Right",aw="Left",d="Bottom",az=9007199254740992,a0="select",av="itemRotate",aM="pan",bl="zoomStart",bk="zoomEnd",aH="none",C=600,B=600,I="rectangle",J=100,E=100,G=20,F=20,H=0,D="Yellow",ay=Number.MAX_VALUE,aA=-Number.MAX_VALUE,b="absolute",ba="transformed",aZ="rotated",bc="transparent",bh="width",af="height",bi="x",bj="y",aF="DOMMouseScroll"+aI+" mousewheel"+aI,aC=0.05,aB=5,e='<a class="k-button k-button-icontext #=className#" href="\\#"><span class="#=iconClass# #=imageClass#"></span>#=text#</a>',r=5;
O.DefaultConnectors=[{name:a9},{name:d},{name:aw},{name:aY},{name:c,position:function(X){return X.getPosition("center");
}}];
var K={cancel:{text:"Cancel",imageClass:"k-i-cancel",className:"k-diagram-cancel",iconClass:"k-icon"},update:{text:"Update",imageClass:"k-i-checkmark",className:"k-diagram-update",iconClass:"k-icon"}};
O.shapeDefaults=function(Y){var X={type:I,path:"",autoSize:true,visual:null,x:H,y:H,minWidth:G,minHeight:F,width:J,height:E,hover:{},editable:{connect:true,tools:[]},connectors:O.DefaultConnectors,rotation:{angle:0}};
bf.simpleExtend(X,Y);
return X;
};
function aG(Y){var bm=Y.originalEvent,X=0;
if(bm.wheelDelta){X=-bm.wheelDelta/40;
X=X>0?ax.ceil(X):ax.floor(X);
}else{if(bm.detail){X=bm.detail;
}}return X;
}function an(X){return X.options.name.toLowerCase()===c.toLowerCase();
}function o(bp,Y){var bo=az,bq,X;
for(var bn=0;
bn<Y.length;
bn++){X=Y[bn];
if(!an(X)){var bm=bp.distanceTo(X.position());
if(bm<bo){bo=bm;
bq=X;
}}}return bq;
}function ak(Y,br){var bm,bn=[],bq;
var X=Y.drawingContainer().children;
var bp=X.length;
for(bm=0;
bm<br.length;
bm++){bq=br[bm];
for(var bo=0;
bo<bp;
bo++){if(X[bo]==bq.drawingContainer()){bn.push(bo);
break;
}}}return bn;
}var Q=aJ.extend({init:function(X){var Y=this;
Y.dataItem=(X||{}).dataItem;
aJ.fn.init.call(Y);
Y.options=A({id:O.randomId()},Y.options,X);
Y.isSelected=false;
Y.visual=new ae({id:Y.options.id,autoSize:Y.options.autoSize});
Y.id=Y.options.id;
Y._template();
},options:{hover:{},cursor:y.grip,content:{align:"center middle"},selectable:true,serializable:true,enable:true},_getCursor:function(X){if(this.adorner){return this.adorner._getCursor(X);
}return this.options.cursor;
},visible:function(X){if(at(X)){return this.visual.visible();
}else{this.visual.visible(X);
}},bounds:function(){},refresh:function(){this.visual.redraw();
},position:function(X){this.options.x=X.x;
this.options.y=X.y;
this.visual.position(X);
},toString:function(){return this.options.id;
},serialize:function(){var X=A({},{options:this.options});
if(this.dataItem){X.dataItem=this.dataItem.toString();
}return X;
},_content:function(X){if(X!==bd){var bn=this.options;
if(O.Utils.isString(X)){bn.content.text=X;
}else{A(bn.content,X);
}var Y=bn.content;
var bm=this._contentVisual;
if(!bm){this._createContentVisual(Y);
}else{this._updateContentVisual(Y);
}}return this.options.content.text;
},_createContentVisual:function(X){if(X.text){this._contentVisual=new a5(X);
this._contentVisual._includeInBBox=false;
this.visual.append(this._contentVisual);
}},_updateContentVisual:function(X){this._contentVisual.redraw(X);
},_hitTest:function(Y){var X=this.bounds();
return this.visible()&&X.contains(Y)&&this.options.enable;
},_template:function(){var bm=this;
if(bm.options.content.template){var X=bm.dataItem||{},Y=kendo.template(bm.options.content.template,{paramName:"dataItem"});
bm.options.content.text=Y(X);
}},_canSelect:function(){return this.options.selectable!==false;
},toJSON:function(){return{id:this.options.id};
}});
var u=k.extend({init:function(Y,X){this.options=A({},this.options,X);
this.connections=[];
this.shape=Y;
},options:{width:7,height:7,fill:{color:D},hover:{}},position:function(){if(this.options.position){return this.options.position(this.shape);
}else{return this.shape.getPosition(this.options.name);
}},toJSON:function(){return{shapeId:this.shape.toString(),connector:this.options.name};
}});
u.parse=function(X,bp){var bq=bp.split(":"),bm=bq[0],bn=bq[1]||c;
for(var Y=0;
Y<X.shapes.length;
Y++){var bo=X.shapes[Y];
if(bo.options.id==bm){return bo.getConnector(bn.trim());
}}};
var a2=Q.extend({init:function(Y,X){var bm=this;
Q.fn.init.call(bm,Y);
this.diagram=X;
this.updateOptionsFromModel();
Y=bm.options;
bm.connectors=[];
bm.type=Y.type;
bm.createShapeVisual();
bm.updateBounds();
bm.content(bm.content());
bm._createConnectors();
},options:O.shapeDefaults(),_setOptionsFromModel:function(X){var Y=ac(X||this.dataItem);
this.options=A({},this.options,Y);
this.redrawVisual();
},updateOptionsFromModel:function(bm,Y){if(this.diagram&&this.diagram._isEditable){var bn=ac(bm||this.dataItem);
if(bm&&Y){if(!z.inArray(Y,["x","y","width","height"])){if(this.options.visual){this._redrawVisual();
}else{if(bn.type){this.options=A({},this.options,bn);
this._redrawVisual();
}}if(this.options.content){this._template();
this.content(this.options.content);
}}else{var X=this.bounds();
X[Y]=bm[Y];
this.bounds(X);
}}else{this.options=A({},this.options,bn);
}}},_redrawVisual:function(){this.visual.clear();
this._contentVisual=null;
this.options.dataItem=this.dataItem;
this.createShapeVisual();
this.updateBounds();
},redrawVisual:function(){this._redrawVisual();
if(this.options.content){this._template();
this.content(this.options.content);
}},updateModel:function(bn){var Y=this.diagram;
if(Y&&Y._isEditable){var X=this._bounds;
var bm=this.dataItem;
if(bm){Y._suspendModelRefresh();
if(L(bm.x)&&X.x!==bm.x){bm.set("x",X.x);
}if(L(bm.y)&&X.y!==bm.y){bm.set("y",X.y);
}if(L(bm.width)&&X.width!==bm.width){bm.set("width",X.width);
}if(L(bm.height)&&X.height!==bm.height){bm.set("height",X.height);
}this.dataItem=bm;
Y._resumeModelRefresh();
if(bn){Y._syncShapeChanges();
}}}},updateBounds:function(){var X=this.visual._measure(true);
var Y=this.options;
this.bounds(new aV(Y.x,Y.y,X.width,X.height));
this._rotate();
this._alignContent();
},content:function(X){var Y=this._content(X);
this._alignContent();
return Y;
},_alignContent:function(){var bo=this.options.content||{};
var bq=this._contentVisual;
if(bq&&bo.align){var bm=this.visual._measure();
var Y=new O.RectAlign(bm);
var bn=bq.drawingElement.bbox(null);
var bp=new aV(0,0,bn.width(),bn.height());
var X=Y.align(bp,bo.align);
bq.position(X.topLeft());
}},_createConnectors:function(){var bo=this.options,bn=bo.connectors.length,Y=bo.connectorDefaults,X,bm;
for(bm=0;
bm<bn;
bm++){X=new u(this,A({},Y,bo.connectors[bm]));
this.connectors.push(X);
}},bounds:function(bm){var X;
if(bm){if(ar(bm)){switch(bm){case ba:X=this._transformedBounds();
break;
case b:X=this._transformedBounds();
var Y=this.diagram._pan;
X.x+=Y.x;
X.y+=Y.y;
break;
case aZ:X=this._rotatedBounds();
break;
default:X=this._bounds;
}}else{this._setBounds(bm);
this._triggerBoundsChange();
if(!(this.diagram&&this.diagram._layouting)){this.refreshConnections();
}}}else{X=this._bounds;
}return X;
},_setBounds:function(bm){var Y=this.options;
var bn=bm.topLeft();
var bp=Y.x=bn.x;
var bq=Y.y=bn.y;
var bo=Y.width=ax.max(bm.width,Y.minWidth);
var X=Y.height=ax.max(bm.height,Y.minHeight);
this._bounds=new aV(bp,bq,bo,X);
this.visual.redraw({x:bp,y:bq,width:bo,height:X});
},position:function(X){if(X){this.bounds(new aV(X.x,X.y,this._bounds.width,this._bounds.height));
}else{return this._bounds.topLeft();
}},clone:function(){var X=this.serialize();
X.options.id=O.randomId();
if(this.diagram&&this.diagram._isEditable&&L(this.dataItem)){X.options.dataItem=n(this.dataItem);
}return new a2(X.options);
},select:function(bn){var Y=this.diagram,bm,X;
if(at(bn)){bn=true;
}if(this._canSelect()){if(this.isSelected!=bn){bm=[];
X=[];
this.isSelected=bn;
if(this.isSelected){Y._selectedItems.push(this);
bm.push(this);
}else{bf.remove(Y._selectedItems,this);
X.push(this);
}if(!Y._internalSelection){Y._selectionChanged(bm,X);
}return true;
}}},rotate:function(X,bm,br){var bp=this.visual.rotate();
if(X!==bd){if(br!==false&&this.diagram&&this.diagram.undoRedoService&&X!==bp.angle){this.diagram.undoRedoService.add(new O.RotateUnit(this.diagram._resizingAdorner,[this],[bp.angle]),false);
}var Y=this.bounds(),bq=new aO(Y.width/2,Y.height/2),bn,bo;
if(bm){bn=X-bp.angle;
bo=Y.center().rotate(bm,360-bn).minus(bq);
this._rotationOffset=this._rotationOffset.plus(bo.minus(Y.topLeft()));
this.position(bo);
}this.visual.rotate(X,bq);
this.options.rotation.angle=X;
if(this.diagram&&this.diagram._connectorsAdorner){this.diagram._connectorsAdorner.refresh();
}this.refreshConnections();
if(this.diagram){this.diagram.trigger(av,{item:this});
}}return bp;
},connections:function(bs){var bp=[],bn,bo,X,Y,bm;
for(bn=0;
bn<this.connectors.length;
bn++){bm=this.connectors[bn];
Y=bm.connections;
for(bo=0,Y;
bo<Y.length;
bo++){X=Y[bo];
if(bs=="out"){var bq=X.source();
if(bq.shape&&bq.shape==this){bp.push(X);
}}else{if(bs=="in"){var br=X.target();
if(br.shape&&br.shape==this){bp.push(X);
}}else{bp.push(X);
}}}}return bp;
},refreshConnections:function(){a.each(this.connections(),function(){this.refresh();
});
},getConnector:function(bm){var Y,X;
if(ar(bm)){bm=bm.toLocaleLowerCase();
for(Y=0;
Y<this.connectors.length;
Y++){X=this.connectors[Y];
if(X.options.name.toLocaleLowerCase()==bm){return X;
}}}else{if(bm instanceof aO){return o(bm,this.connectors);
}else{return this.connectors.length?this.connectors[0]:null;
}}},getPosition:function(bm){var X=this.bounds(),Y=bm.charAt(0).toLowerCase()+bm.slice(1);
if(ap(X[Y])){return this._transformPoint(X[Y]());
}return X.center();
},redraw:function(Y){if(Y){var bm=this.options;
var X;
this.shapeVisual.redraw(this._visualOptions(Y));
if(this._diffNumericOptions(Y,[bh,af,bi,bj])){this.bounds(new aV(bm.x,bm.y,bm.width,bm.height));
X=true;
}if(Y.connectors){bm.connectors=Y.connectors;
this._updateConnectors();
}bm=A(bm,Y);
if(Y.rotation||X){this._rotate();
}if(bm.content){this.content(bm.content);
}}},_updateConnectors:function(){var Y=this.connections();
this.connectors=[];
this._createConnectors();
var X;
var bn;
var bo;
for(var bm=0;
bm<Y.length;
bm++){X=Y[bm];
bn=X.source();
bo=X.target();
if(bn.shape&&bn.shape===this){X.source(this.getConnector(bn.options.name)||null);
}else{if(bo.shape&&bo.shape===this){X.target(this.getConnector(bo.options.name)||null);
}}X.updateModel();
}},_diffNumericOptions:O.diffNumericOptions,_visualOptions:function(X){return{data:X.path,source:X.source,hover:X.hover,fill:X.fill,stroke:X.stroke};
},_triggerBoundsChange:function(){if(this.diagram){this.diagram.trigger(au,{item:this,bounds:this._bounds.clone()});
}},_transformPoint:function(Y){var bm=this.rotate(),X=this.bounds(),bn=X.topLeft();
if(bm.angle){Y.rotate(bm.center().plus(bn),360-bm.angle);
}return Y;
},_transformedBounds:function(){var X=this.bounds(),bm=X.topLeft(),Y=X.bottomRight();
return aV.fromPoints(this.diagram.modelToView(bm),this.diagram.modelToView(Y));
},_rotatedBounds:function(){var X=this.bounds().rotatedBounds(this.rotate().angle),bm=X.topLeft(),Y=X.bottomRight();
return aV.fromPoints(bm,Y);
},_rotate:function(){var X=this.options.rotation;
if(X&&X.angle){this.rotate(X.angle);
}this._rotationOffset=new aO();
},_hover:function(bo){var bm=this.options,Y=bm.hover,bn=bm.stroke,X=bm.fill;
if(bo&&ao(Y.stroke)){bn=A({},bn,Y.stroke);
}if(bo&&ao(Y.fill)){X=Y.fill;
}this.shapeVisual.redraw({stroke:bn,fill:X});
if(bm.editable&&bm.editable.connect){this.diagram._showConnectors(this,bo);
}},_hitTest:function(bn){if(this.visible()){var Y=this.bounds(),bm,X=this.rotate().angle;
if(bn.isEmpty&&!bn.isEmpty()){return al.rects(bn,Y,X?X:0);
}else{bm=bn.clone().rotate(Y.center(),X);
if(Y.contains(bm)){return this;
}}}},toJSON:function(){return{shapeId:this.options.id};
},createShapeVisual:function(){var X=this.options;
var bn=this._visualOptions(X);
var bo=X.visual;
var bm=(X.type+"").toLocaleLowerCase();
var Y;
bn.width=X.width;
bn.height=X.height;
if(ap(bo)){Y=bo.call(this,X);
}else{if(bn.data){Y=new aN(bn);
bb(Y);
}else{if(bm=="rectangle"){Y=new aW(bn);
}else{if(bm=="circle"){Y=new j(bn);
}else{if(bm=="text"){Y=new a5(bn);
}else{if(bm=="image"){Y=new ah(bn);
}else{Y=new aN(bn);
}}}}}}this.shapeVisual=Y;
this.visual.append(this.shapeVisual);
}});
var q=Q.extend({init:function(X,bn,Y){var bm=this;
Q.fn.init.call(bm,Y);
this.updateOptionsFromModel();
this._initRouter();
bm.path=new O.Polyline(bm.options);
bm.path.fill(bc);
bm.visual.append(bm.path);
bm._sourcePoint=bm._targetPoint=new aO();
bm._setSource(X);
bm._setTarget(bn);
bm.content(bm.options.content);
bm.definers=[];
if(L(Y)&&Y.points){bm.points(Y.points);
}},options:{hover:{stroke:{}},startCap:aH,endCap:aH,points:[],selectable:true,fromConnector:c,toConnector:c},_setOptionsFromModel:function(X){this.updateOptionsFromModel(X||this.dataItem);
},updateOptionsFromModel:function(bm){if(this.diagram&&this.diagram._isEditable){var X=this.diagram._dataMap;
var bn=ab(bm||this.dataItem);
if(bm){if(L(bn.from)){var Y=X[bn.from];
if(Y&&L(bn.fromConnector)){Y=Y.getConnector(bn.fromConnector);
}this.source(Y);
}else{if(L(bn.fromX)&&L(bn.fromY)){this.source(new aO(bn.fromX,bn.fromY));
}}if(L(bn.to)){var bo=X[bn.to];
if(bo&&L(bn.toConnector)){bo=bo.getConnector(bn.toConnector);
}this.target(bo);
}else{if(L(bn.toX)&&L(bn.toY)){this.target(new aO(bn.toX,bn.toY));
}}if(L(bn.type)&&this.type()!==bn.type){this.points([]);
this.type(bn.type);
}this.dataItem=bm;
this._template();
this.redraw(this.options);
}else{this.options=A({},bn,this.options);
}}},updateModel:function(Y){if(this.diagram&&this.diagram._isEditable){if(this.diagram.connectionsDataSource){var X=this.diagram.connectionsDataSource.getByUid(this.dataItem.uid);
if(X){this.diagram._suspendModelRefresh();
if(L(this.options.fromX)&&this.options.fromX!==null){l("from",X);
l("fromConnector",X);
X.set("fromX",this.options.fromX);
X.set("fromY",this.options.fromY);
}else{X.set("from",this.options.from);
if(L(X.fromConnector)){X.set("fromConnector",this.sourceConnector?this.sourceConnector.options.name:null);
}l("fromX",X);
l("fromY",X);
}if(L(this.options.toX)&&this.options.toX!==null){l("to",X);
l("toConnector",X);
X.set("toX",this.options.toX);
X.set("toY",this.options.toY);
}else{X.set("to",this.options.to);
if(L(X.toConnector)){X.set("toConnector",this.targetConnector?this.targetConnector.options.name:null);
}l("toX",X);
l("toY",X);
}if(L(this.options.type)&&L(X.type)){X.set("type",this.options.type);
}this.dataItem=X;
this.diagram._resumeModelRefresh();
if(Y){this.diagram._syncConnectionChanges();
}}}}},sourcePoint:function(){return this._resolvedSourceConnector?this._resolvedSourceConnector.position():this._sourcePoint;
},_setSource:function(bn){var bm=bn instanceof a2;
var Y=this.options.fromConnector||c;
var X;
if(bm&&!bn.getConnector(Y)){return;
}if(bn!==bd){this.from=bn;
}this._removeFromSourceConnector();
if(bn===null){if(this.sourceConnector){this._sourcePoint=(this._resolvedSourceConnector||this.sourceConnector).position();
this._clearSourceConnector();
this._setFromOptions(null,this._sourcePoint);
}}else{if(bn instanceof u){X=bn.shape.dataItem;
if(X){this._setFromOptions(X.id);
}this.sourceConnector=bn;
this.sourceConnector.connections.push(this);
}else{if(bn instanceof aO){this._setFromOptions(null,bn);
this._sourcePoint=bn;
if(this.sourceConnector){this._clearSourceConnector();
}}else{if(bm){X=bn.dataItem;
if(X){this._setFromOptions(X.id);
}this.sourceConnector=bn.getConnector(Y);
this.sourceConnector.connections.push(this);
}}}}},source:function(X,Y){if(ao(X)){if(Y&&this.diagram){this.diagram.undoRedoService.addCompositeItem(new O.ConnectionEditUnit(this,X));
}this._setSource(X);
this.refresh();
}return this.sourceConnector?this.sourceConnector:this._sourcePoint;
},_setFromOptions:function(X,Y){this.options.from=X;
if(Y){this.options.fromX=Y.x;
this.options.fromY=Y.y;
}else{this.options.fromX=null;
this.options.fromY=null;
}},sourceDefiner:function(X){if(X){if(X instanceof O.PathDefiner){X.left=null;
this._sourceDefiner=X;
this.source(X.point);
}else{throw"The sourceDefiner needs to be a PathDefiner.";
}}else{if(!this._sourceDefiner){this._sourceDefiner=new O.PathDefiner(this.sourcePoint(),null,null);
}return this._sourceDefiner;
}},targetPoint:function(){return this._resolvedTargetConnector?this._resolvedTargetConnector.position():this._targetPoint;
},_setTarget:function(bn){var bm=bn instanceof a2;
var Y=this.options.toConnector||c;
var X;
if(bm&&!bn.getConnector(Y)){return;
}if(bn!==bd){this.to=bn;
}this._removeFromTargetConnector();
if(bn===null){if(this.targetConnector){this._targetPoint=(this._resolvedTargetConnector||this.targetConnector).position();
this._clearTargetConnector();
this._setToOptions(null,this._targetPoint);
}}else{if(bn instanceof u){X=bn.shape.dataItem;
if(X){this._setToOptions(X.id);
}this.targetConnector=bn;
this.targetConnector.connections.push(this);
}else{if(bn instanceof aO){this._setToOptions(null,bn);
this._targetPoint=bn;
if(this.targetConnector){this._clearTargetConnector();
}}else{if(bm){X=bn.dataItem;
if(X){this._setToOptions(X.id);
}this.targetConnector=bn.getConnector(Y);
this.targetConnector.connections.push(this);
}}}}},target:function(X,Y){if(ao(X)){if(Y&&this.diagram){this.diagram.undoRedoService.addCompositeItem(new O.ConnectionEditUnit(this,bd,X));
}this._setTarget(X);
this.refresh();
}return this.targetConnector?this.targetConnector:this._targetPoint;
},_setToOptions:function(X,Y){this.options.to=X;
if(Y){this.options.toX=Y.x;
this.options.toY=Y.y;
}else{this.options.toX=null;
this.options.toY=null;
}},targetDefiner:function(X){if(X){if(X instanceof O.PathDefiner){X.right=null;
this._targetDefiner=X;
this.target(X.point);
}else{throw"The sourceDefiner needs to be a PathDefiner.";
}}else{if(!this._targetDefiner){this._targetDefiner=new O.PathDefiner(this.targetPoint(),null,null);
}return this._targetDefiner;
}},_updateConnectors:function(){this._updateConnector(this.source(),"source");
this._updateConnector(this.target(),"target");
},_updateConnector:function(bo,bp){var br=this;
var bm=br.diagram;
if(bo instanceof u&&!bm.getShapeById(bo.shape.id)){var Y=bo.shape.dataItem;
var X=bo.options.name;
var bq=function(){var bs=bm._dataMap[Y.id];
bo=bs.getConnector(X);
br[bp](bo,false);
br.updateModel();
};
if(bm._dataMap[Y.id]){bq();
}else{var bn=bm._inactiveShapeItems.getByUid(Y.uid);
if(bn){bm._deferredConnectionUpdates.push(bn.onActivate(bq));
}}}else{br[bp](bo,false);
}},content:function(X){var Y=this._content(X);
if(L(X)){this._alignContent();
}return Y;
},_createContentVisual:function(X){var Y;
if(ap(X.visual)){Y=X.visual.call(this,X);
}else{if(X.text){Y=new a5(X);
}}if(Y){this._contentVisual=Y;
Y._includeInBBox=false;
this.visual.append(Y);
}return Y;
},_updateContentVisual:function(X){if(ap(X.visual)){this.visual.remove(this._contentVisual);
this._createContentVisual(X);
}else{this._contentVisual.redraw(X);
}},_alignContent:function(){if(this._contentVisual){var bs=r;
var bw=this.allPoints();
var bo=ax.floor(bw.length/2);
var bx=bo-1;
while(bx>0&&bw[bx].equals(bw[bo])){bx--;
bo++;
}var bp=bw[bo];
var by=bw[bx];
var bm=this._contentVisual._measure();
var bz=bm.width;
var bq=bm.height;
var X=bw.length%2===0;
var bn=by.distanceTo(bp);
if(X&&bw.length>2&&bn>0&&(by.y===bp.y&&bn<bz||by.x===bp.x&&bn<bq)){X=false;
bs=0;
}var bv;
if(X){var Y=V.util.deg(ax.atan2(bp.y-by.y,bp.x-by.x));
bv=new aO((bp.x-by.x)/2+by.x,(bp.y-by.y)/2+by.y);
if(ax.abs(Y)===90){bv.x+=bs;
bv.y-=bq/2;
}else{if(Y%180===0){bv.x-=bz/2;
bv.y-=bq+bs;
}else{if(Y<-90||0<Y&&Y<90){bv.y-=bq;
}else{if(Y<0||Y>90){bv.x-=bz;
bv.y-=bq;
}}}}}else{var br=ax.floor(bw.length/2);
bv=bw[br].clone();
by=bw[br-1];
bp=bw[br+1];
var bt=by.x<=bv.x&&bp.x<=bv.x?bs:-bm.width-bs;
var bu=by.y<=bv.y&&bp.y<=bv.y?bs:-bm.height-bs;
bv.x+=bt;
bv.y+=bu;
}this._contentVisual.position(bv);
}},select:function(bn){var Y=this.diagram,bm,X;
if(this._canSelect()){if(this.isSelected!==bn){this.isSelected=bn;
bm=[];
X=[];
if(this.isSelected){this.adorner=new s(this,this.options.selection);
Y._adorn(this.adorner,true);
Y._selectedItems.push(this);
bm.push(this);
}else{if(this.adorner){Y._adorn(this.adorner,false);
bf.remove(Y._selectedItems,this);
this.adorner=bd;
X.push(this);
}}if(this.adorner){this.adorner.refresh();
}if(!Y._internalSelection){Y._selectionChanged(bm,X);
}return true;
}}},bounds:function(X){if(X&&!ar(X)){this._bounds=X;
}else{return this._bounds;
}},type:function(Y){var X=this.options;
if(Y){if(Y!==X.type){X.type=Y;
this._initRouter();
this.refresh();
}}else{return X.type;
}},_initRouter:function(){var X=(this.options.type||"").toLowerCase();
if(X==g){this._router=new h(this);
}else{this._router=new aP(this);
}},points:function(bo){if(bo){this.definers=[];
for(var Y=0;
Y<bo.length;
Y++){var X=bo[Y];
if(X instanceof O.Point){this.definers.push(new O.PathDefiner(X));
}else{if(X.hasOwnProperty("x")&&X.hasOwnProperty("y")){this.definers.push(new O.PathDefiner(new aO(X.x,X.y)));
}else{throw"A Connection point needs to be a Point or an object with x and y properties.";
}}}}else{var bn=[];
if(ao(this.definers)){for(var bm=0;
bm<this.definers.length;
bm++){bn.push(this.definers[bm].point);
}}return bn;
}},allPoints:function(){var Y=[this.sourcePoint()];
if(this.definers){for(var X=0;
X<this.definers.length;
X++){Y.push(this.definers[X].point);
}}Y.push(this.targetPoint());
return Y;
},refresh:function(){this._resolveConnectors();
this._refreshPath();
this._alignContent();
if(this.adorner){this.adorner.refresh();
}},_resolveConnectors:function(){var X=this,bn,bq,bm,bp,Y=X.source(),bo=X.target();
if(Y instanceof aO){bn=Y;
}else{if(Y instanceof u){if(an(Y)){bm=Y.shape.connectors;
}else{bm=[Y];
}}}if(bo instanceof aO){bq=bo;
}else{if(bo instanceof u){if(an(bo)){bp=bo.shape.connectors;
}else{bp=[bo];
}}}if(bn){if(bp){X._resolvedTargetConnector=o(bn,bp);
}}else{if(bm){if(bq){X._resolvedSourceConnector=o(bq,bm);
}else{if(bp){this._resolveAutoConnectors(bm,bp);
}}}}},_resolveAutoConnectors:function(bs,bw){var bm=az;
var Y=az;
var bn,bo;
var bu,by;
var bp,bq;
var br,bv;
var bt,bx;
var X;
for(bt=0;
bt<bs.length;
bt++){br=bs[bt];
if(!an(br)){bu=br.position();
for(bx=0;
bx<bw.length;
bx++){bv=bw[bx];
if(!an(bv)){by=bv.position();
X=ax.round(bu.distanceTo(by));
if(X<bm&&this.diagram&&this._testRoutePoints(bu,by,br,bv)){bm=X;
bn=br;
bo=bv;
}if(X<Y){bp=br;
bq=bv;
Y=X;
}}}}}if(bn){bp=bn;
bq=bo;
}this._resolvedSourceConnector=bp;
this._resolvedTargetConnector=bq;
},_testRoutePoints:function(bs,bv,br,bu){var bq=this._router;
var bn=true;
if(bq instanceof h){var bo=bq.routePoints(bs,bv,br,bu),bt,X,bp,Y;
Y=this._getRouteExclude(bs,bv,br.shape,bu.shape);
bo.unshift(bs);
bo.push(bv);
for(var bm=1;
bm<bo.length;
bm++){bt=bo[bm-1];
X=bo[bm];
bp=new aV(ax.min(bt.x,X.x),ax.min(bt.y,X.y),ax.abs(bt.x-X.x),ax.abs(bt.y-X.y));
if(bp.width>0){bp.x++;
bp.width-=2;
}if(bp.height>0){bp.y++;
bp.height-=2;
}if(!bp.isEmpty()&&this.diagram._shapesQuadTree.hitTestRect(bp,Y)){bn=false;
break;
}}}return bn;
},_getRouteExclude:function(Y,bn,bm,bo){var X=[];
if(this._isPointInsideShape(Y,bm)){X.push(bm);
}if(this._isPointInsideShape(bn,bo)){X.push(bo);
}return X;
},_isPointInsideShape:function(bo,bs){var Y=bs.bounds(),br,X=bs.rotate().angle,bp,bq,bm=Y.x,bn=Y.y;
br=bo.clone().rotate(Y.center(),X);
bp=br.x;
bq=br.y;
return bp>bm&&bp<bm+Y.width&&bq>bn&&bq<bn+Y.height;
},redraw:function(X){if(X){this.options=A({},this.options,X);
var Y=this.options.points;
if(L(Y)&&Y.length>0){this.points(Y);
this._refreshPath();
}if(X&&X.content||X.text){this.content(X.content);
}this.path.redraw({fill:X.fill,stroke:X.stroke,startCap:X.startCap,endCap:X.endCap});
}},clone:function(){var X=this.serialize();
if(this.diagram&&this.diagram._isEditable&&L(this.dataItem)){X.options.dataItem=n(this.dataItem);
}return new q(this.from,this.to,X.options);
},serialize:function(){var X=this.from.toJSON?this.from.toJSON:this.from.toString(),bm=this.to.toJSON?this.to.toJSON:this.to.toString();
var Y=A({},{options:this.options,from:X,to:bm});
if(L(this.dataItem)){Y.dataItem=this.dataItem.toString();
}Y.options.points=this.points();
return Y;
},_hitTest:function(bn){if(this.visible()){var Y=new aO(bn.x,bn.y),X=this.sourcePoint(),bm=this.targetPoint();
if(bn.isEmpty&&!bn.isEmpty()&&bn.contains(X)&&bn.contains(bm)){return this;
}if(this._router.hitTest(Y)){return this;
}}},_hover:function(Y){var X=(this.options.stroke||{}).color;
if(Y&&ao(this.options.hover.stroke.color)){X=this.options.hover.stroke.color;
}this.path.redraw({stroke:{color:X}});
},_refreshPath:function(){if(!L(this.path)){return;
}this._drawPath();
this.bounds(this._router.getBounds());
},_drawPath:function(){if(this._router){this._router.route();
}var Y=this.sourcePoint();
var bm=this.targetPoint();
var X=this.points();
this.path.redraw({points:[Y].concat(X,[bm])});
},_clearSourceConnector:function(){this.sourceConnector=bd;
this._resolvedSourceConnector=bd;
},_clearTargetConnector:function(){this.targetConnector=bd;
this._resolvedTargetConnector=bd;
},_removeFromSourceConnector:function(){if(this.sourceConnector){bf.remove(this.sourceConnector.connections,this);
}},_removeFromTargetConnector:function(){if(this.targetConnector){bf.remove(this.targetConnector.connections,this);
}},toJSON:function(){var X=this;
var Y,bn,bm;
if(X.from&&X.from.toJSON){Y=X.from.toJSON();
}else{bm=X._sourcePoint;
Y={x:bm.x,y:bm.y};
}if(X.to&&X.to.toJSON){bn=X.to.toJSON();
}else{bm=X._targetPoint;
bn={x:bm.x,y:bm.y};
}return{from:Y,to:bn};
}});
var P=bg.extend({init:function(X,bm){var Y=this;
kendo.destroy(X);
bg.fn.init.call(Y,X,bm);
Y._initTheme();
Y._initElements();
Y._extendLayoutOptions(Y.options);
Y._initDefaults(bm);
Y._interactionDefaults();
Y._initCanvas();
Y.mainLayer=new ae({id:"main-layer"});
Y.canvas.append(Y.mainLayer);
Y._shapesQuadTree=new a3(Y);
Y._pan=new aO();
Y._adorners=[];
Y.adornerLayer=new ae({id:"adorner-layer"});
Y.canvas.append(Y.adornerLayer);
Y._createHandlers();
Y._initialize();
Y._resizingAdorner=new aX(Y,{editable:Y.options.editable});
Y._connectorsAdorner=new v(Y);
Y._adorn(Y._resizingAdorner,true);
Y._adorn(Y._connectorsAdorner,true);
Y.selector=new a1(Y);
Y._clipboard=[];
Y.pauseMouseHandlers=false;
Y._fetchFreshData();
Y._createGlobalToolBar();
Y._createOptionElements();
Y.zoom(Y.options.zoom);
Y.canvas.draw();
},options:{name:"Diagram",theme:"default",layout:"",zoomRate:0.1,zoom:1,zoomMin:0,zoomMax:2,dataSource:{},draggable:true,template:"",autoBind:true,editable:{rotate:{},resize:{},text:true,tools:[],drag:{snap:{size:10,angle:10}},remove:true},pannable:{},selectable:{key:"none"},tooltip:{enabled:true,format:"{0}"},copy:{enabled:true,offsetX:20,offsetY:20},shapeDefaults:O.shapeDefaults({undoable:true}),connectionDefaults:{editable:{tools:[]},type:g},shapes:[],connections:[]},events:[bk,bl,aM,a0,av,au,i,m,aD,aE,"toolBarClick","save","cancel","edit","remove","add","dataBound",U,S,T],items:function(){return a();
},_createGlobalToolBar:function(){var X=this.options.editable;
if(X){var Y=X.tools;
if(this._isEditable&&Y!==false&&(!Y||Y.length===0)){Y=["createShape","undo","redo","rotateClockwise","rotateAnticlockwise"];
}if(Y&&Y.length){this.toolBar=new R(this,{tools:Y||{},click:aS(this._toolBarClick,this),modal:false});
this.toolBar.element.css({textAlign:"left"});
this.element.prepend(this.toolBar.element);
this._resize();
}}},createShape:function(){if(this.editor&&this.editor.end()||!this.editor){var X=this.dataSource;
var bp=X.view()||[];
var bm=bp.length;
var bn=x(X,{});
var bo=this._createShape(bn,{});
if(!this.trigger("add",{shape:bo})){X.insert(bm,bn);
var Y=this._inactiveShapeItems.getByUid(bn.uid);
Y.element=bo;
this.edit(bo);
}}},_createShape:function(X,Y){Y=A({},this.options.shapeDefaults,Y);
Y.dataItem=X;
var bm=new a2(Y,this);
return bm;
},createConnection:function(){if(this.editor&&this.editor.end()||!this.editor){var Y=this.connectionsDataSource;
var bo=Y.view()||[];
var bm=bo.length;
var bn=x(Y,{});
var X=this._createConnection(bn);
if(!this.trigger("add",{connection:X})){this._connectionsDataMap[bn.uid]=X;
Y.insert(bm,bn);
this.addConnection(X,false);
this.edit(X);
}}},_createConnection:function(Y,bn,bo){var bm=A({},this.options.connectionDefaults);
bm.dataItem=Y;
var X=new q(bn||new aO(),bo||new aO(),bm);
return X;
},editModel:function(Y,bo){this.cancelEdit();
var bn,bp;
var bm=this.options.editable;
if(bo=="shape"){bn=bm.shapeEditors;
bp=bm.shapeTemplate;
}else{if(bo=="connection"){var X=aS(t,this);
bn=A({},{from:X,to:X},bm.connectionEditors);
bp=bm.connectionTemplate;
}else{return;
}}this.editor=new aQ(this.element,{update:aS(this._update,this),cancel:aS(this._cancel,this),model:Y,type:bo,target:this,editors:bn,template:bp});
this.trigger("edit",this._editArgs());
},edit:function(Y){if(Y.dataItem){var X=Y instanceof a2?"shape":"connection";
this.editModel(Y.dataItem,X);
}},cancelEdit:function(){if(this.editor){this._getEditDataSource().cancelChanges(this.editor.model);
this._destroyEditor();
}},saveEdit:function(){if(this.editor&&this.editor.end()&&!this.trigger("save",this._editArgs())){this._getEditDataSource().sync();
}},_update:function(){if(this.editor&&this.editor.end()&&!this.trigger("save",this._editArgs())){this._getEditDataSource().sync();
this._destroyEditor();
}},_cancel:function(){if(this.editor&&!this.trigger("cancel",this._editArgs())){var Y=this.editor.model;
this._getEditDataSource().cancelChanges(Y);
var X=this._connectionsDataMap[Y.uid]||this._dataMap[Y.id];
if(X){X._setOptionsFromModel(Y);
}this._destroyEditor();
}},_getEditDataSource:function(){return this.editor.options.type==="shape"?this.dataSource:this.connectionsDataSource;
},_editArgs:function(){var X={container:this.editor.wrapper};
X[this.editor.options.type]=this.editor.model;
return X;
},_destroyEditor:function(){if(this.editor){this.editor.close();
this.editor=null;
}},_initElements:function(){this.wrapper=this.element.empty().css("position","relative").attr("tabindex",0).addClass("k-widget k-diagram");
this.scrollable=a("<div />").appendTo(this.element);
},_initDefaults:function(bo){var bm=this.options;
var Y=bm.editable;
var bn=bm.shapeDefaults;
var X=bm.connectionDefaults;
var bp=(bo||{}).shapeDefaults;
if(Y===false){bn.editable=false;
X.editable=false;
}else{w(Y,bn.editable,["drag","remove","connect"]);
w(Y,X.editable,["drag","remove"]);
}if(bp&&bp.connectors){bm.shapeDefaults.connectors=bp.connectors;
}},_interactionDefaults:function(){var Y=this.options;
var bn=Y.selectable;
var bm=Y.pannable;
var X=kendo.support.mobileOS;
if(bn&&!L(bn.multiple)){Y.selectable=A({multiple:X?false:true},Y.selectable);
}if(bm&&!L(bm.key)){Y.pannable=A({key:X?"none":"ctrl"},Y.pannable);
}},_initCanvas:function(){var X=a("<div class='k-layer'></div>").appendTo(this.scrollable)[0];
var Y=this.viewport();
this.canvas=new f(X,{width:Y.width||C,height:Y.height||B});
},_createHandlers:function(){var Y=this;
var X=Y.element;
X.on(aF,aS(Y._wheel,Y)).on("keydown"+aI,aS(Y._keydown,Y));
Y._userEvents=new kendo.UserEvents(this.scrollable,{multiTouch:true,fastTap:true,tap:aS(Y._tap,Y),start:aS(Y._dragStart,Y),move:aS(Y._drag,Y),end:aS(Y._dragEnd,Y),gesturestart:aS(Y._gestureStart,Y),gesturechange:aS(Y._gestureChange,Y),gestureend:aS(Y._gestureEnd,Y)});
Y.toolService=new a8(Y);
this.scrollable.on("mouseover"+aI,aS(Y._mouseover,Y)).on("mouseout"+aI,aS(Y._mouseout,Y)).on("mousemove"+aI,aS(Y._mouseMove,Y)).on("mousedown"+aI,aS(Y._mouseDown,Y)).on("mouseup"+aI,aS(Y._mouseUp,Y));
this._syncHandler=aS(Y._syncChanges,Y);
Y._resizeHandler=aS(Y.resize,Y,false);
kendo.onResize(Y._resizeHandler);
this.bind(bl,aS(Y._destroyToolBar,Y));
this.bind(aM,aS(Y._destroyToolBar,Y));
},_dragStart:function(X){this._pauseMouseHandlers=true;
var bm=this._eventPositions(X,true);
var Y=X.event;
if(this.toolService.start(bm,this._meta(Y))){this._destroyToolBar();
Y.preventDefault();
}},_drag:function(X){var bm=this._eventPositions(X);
var Y=X.event;
if(this.toolService.move(bm,this._meta(Y))){Y.preventDefault();
}},_dragEnd:function(X){this._pauseMouseHandlers=false;
var bm=this._eventPositions(X);
var Y=X.event;
if(this.toolService.end(bm,this._meta(Y))){this._createToolBar();
Y.preventDefault();
}},_mouseMove:function(X){if(!this._pauseMouseHandlers){var Y=this._eventPositions(X);
this.toolService._updateHoveredItem(Y);
this.toolService._updateCursor(Y);
}},_mouseDown:function(){this._pauseMouseHandlers=true;
},_mouseUp:function(){this._pauseMouseHandlers=false;
},_tap:function(Y){var br=this.toolService;
var bq=this.options.selectable;
var bp=this._eventPositions(Y);
var bm=this.focus();
br._updateHoveredItem(bp);
if(br.hoveredItem){var bn=br.hoveredItem;
this.trigger("click",{item:bn,point:bp});
if(bq&&bn.options.selectable!==false){var bo=bq.multiple!==false;
var X=kendo.support.mobileOS||this._meta(Y.event).ctrlKey;
if(bn.isSelected){if(X){this._destroyToolBar();
bn.select(false);
}else{this._createToolBar(bm);
}}else{this._destroyToolBar();
this.select(bn,{addToSelection:bo&&X});
this._createToolBar(bm);
}}}else{if(bq){this._destroyToolBar();
this.deselect();
}}},_keydown:function(X){if(this.toolService.keyDown(X.keyCode,this._meta(X))){X.preventDefault();
}},_wheel:function(Y){var X=aG(Y),bn=this._eventPositions(Y),bm=A(this._meta(Y),{delta:X});
if(this.toolService.wheel(bn,bm)){Y.preventDefault();
}},_meta:function(X){return{ctrlKey:X.ctrlKey,metaKey:X.metaKey,altKey:X.altKey,shiftKey:X.shiftKey,type:X.type};
},_eventPositions:function(X,bo){var bn;
if(X.touch){var bm=bo?"startLocation":"location";
bn=new aO(X.x[bm],X.y[bm]);
}else{var Y=X.originalEvent;
bn=new aO(Y.pageX,Y.pageY);
}return this.documentToModel(bn);
},_gestureStart:function(X){this._destroyToolBar();
this.scroller.disable();
var bm=this.documentToModel(new aO(X.center.x,X.center.y));
var Y={point:bm,zoom:this.zoom()};
if(this.trigger(bl,Y)){return;
}this._gesture=X;
this._initialCenter=bm;
},_gestureChange:function(Y){var bo=this._gesture;
var bm=this._initialCenter;
var X=this.documentToView(new aO(Y.center.x,Y.center.y));
var bp=Y.distance/bo.distance;
var br=this._zoom;
var bq=false;
if(ax.abs(bp-1)>=aC){this._zoom=br=this._getValidZoom(br*bp);
this.options.zoom=br;
this._gesture=Y;
bq=true;
}var bs=bm.times(br);
var bn=X.minus(bs);
if(bq||this._pan.distanceTo(bn)>=aB){this._panTransform(bn);
this._updateAdorners();
}Y.preventDefault();
},_gestureEnd:function(){if(this.options.pannable!==false){this.scroller.enable();
}this.trigger(bk,{point:this._initialCenter,zoom:this.zoom()});
},_resize:function(){var X=this.viewport();
if(this.canvas){this.canvas.size(X);
}if(this.scrollable&&this.toolBar){this.scrollable.height(X.height);
}},_mouseover:function(X){var Y=X.target._kendoNode;
if(Y&&Y.srcElement._hover){Y.srcElement._hover(true,Y.srcElement);
}},_mouseout:function(X){var Y=X.target._kendoNode;
if(Y&&Y.srcElement._hover){Y.srcElement._hover(false,Y.srcElement);
}},_initTheme:function(){var X=this,bn=z.ui.themes||{},Y=((X.options||{}).theme||"").toLowerCase(),bm=(bn[Y]||{}).diagram;
X.options=A({},bm,X.options);
if(X.options.editable===true){A(X.options,{editable:(bm||{}).editable});
}},_createOptionElements:function(){var X=this.options;
var Y=X.shapes.length;
if(Y){this._createShapes();
}if(X.connections.length){this._createConnections();
}if(Y&&X.layout){this.layout(X.layout);
}},_createShapes:function(){var bo=this,Y=bo.options,bn=Y.shapes,bm,X;
for(X=0;
X<bn.length;
X++){bm=bn[X];
bo.addShape(bm);
}},_createConnections:function(){var bn=this,bp=bn.options,bm=bp.connectionDefaults,Y=bp.connections,X,bq,br,bo;
for(bo=0;
bo<Y.length;
bo++){X=Y[bo];
bq=bn._findConnectionTarget(X.from);
br=bn._findConnectionTarget(X.to);
bn.connect(bq,br,A({},bm,X));
}},_findConnectionTarget:function(Y){Y=Y||{};
var X=this;
var bm=ar(Y)?Y:Y.shapeId||Y.id;
var bn;
if(bm){bn=X.getShapeById(bm);
if(Y.connector){bn=bn.getConnector(Y.connector);
}}else{bn=new aO(Y.x||0,Y.y||0);
}return bn;
},destroy:function(){var X=this;
bg.fn.destroy.call(X);
if(this._userEvents){this._userEvents.destroy();
}kendo.unbindResize(X._resizeHandler);
X.clear();
X.element.off(aI);
X.scroller.wrapper.off(aI);
X.canvas.destroy(true);
X.canvas=bd;
X._destroyEditor();
X.destroyScroller();
X._destroyGlobalToolBar();
X._destroyToolBar();
},destroyScroller:function(){var X=this.scroller;
if(!X){return;
}X.destroy();
X.element.remove();
this.scroller=null;
},save:function(){var bm={shapes:[],connections:[]};
var Y,X,bn;
for(Y=0;
Y<this.shapes.length;
Y++){bn=this.shapes[Y];
if(bn.options.serializable){bm.shapes.push(bn.options);
}}for(Y=0;
Y<this.connections.length;
Y++){X=this.connections[Y];
bm.connections.push(A({},X.options,X.toJSON()));
}return bm;
},focus:function(){if(!this.element.is(kendo._activeElement())){var bm=this.element,bp=bm[0],X=[],bo=[],Y=document.documentElement,bn;
do{bp=bp.parentNode;
if(bp.scrollHeight>bp.clientHeight){X.push(bp);
bo.push(bp.scrollTop);
}}while(bp!=Y);
bm.focus();
for(bn=0;
bn<X.length;
bn++){X[bn].scrollTop=bo[bn];
}return true;
}},load:function(X){this.clear();
this.setOptions(X);
this._createShapes();
this._createConnections();
},setOptions:function(X){A(this.options,X);
},clear:function(){var X=this;
X.select(false);
X.mainLayer.clear();
X._shapesQuadTree.clear();
X._initialize();
},connect:function(bn,bo,bm){var X;
if(this.connectionsDataSource&&this._isEditable){var Y=this.connectionsDataSource.add({});
X=this._connectionsDataMap[Y.uid];
X.source(bn);
X.target(bo);
X.redraw(bm);
X.updateModel();
}else{X=new q(bn,bo,A({},this.options.connectionDefaults,bm));
this.addConnection(X);
}return X;
},connected:function(bm,bn){for(var Y=0;
Y<this.connections.length;
Y++){var X=this.connections[Y];
if(X.from==bm&&X.to==bn){return true;
}}return false;
},addConnection:function(X,Y){if(Y!==false){this.undoRedoService.add(new O.AddConnectionUnit(X,this),false);
}X.diagram=this;
X._setOptionsFromModel();
X.refresh();
this.mainLayer.append(X.visual);
this.connections.push(X);
this.trigger(i,{added:[X],removed:[]});
return X;
},_addConnection:function(X,bn){var Y=this.connectionsDataSource;
var bm;
if(Y&&this._isEditable){bm=x(Y,n(X.dataItem));
X.dataItem=bm;
X.updateModel();
if(!this.trigger("add",{connection:X})){this._connectionsDataMap[bm.uid]=X;
Y.add(bm);
this.addConnection(X,bn);
X._updateConnectors();
return X;
}}else{if(!this.trigger("add",{connection:X})){this.addConnection(X,bn);
X._updateConnectors();
return X;
}}},addShape:function(X,bn){var Y,bm=this.options.shapeDefaults;
if(X instanceof a2){Y=X;
}else{if(!(X instanceof kendo.Class)){bm=A({},bm,X||{});
Y=new a2(bm,this);
}else{return;
}}if(bn!==false){this.undoRedoService.add(new O.AddShapeUnit(Y,this),false);
}this.shapes.push(Y);
if(Y.diagram!==this){this._shapesQuadTree.insert(Y);
Y.diagram=this;
}this.mainLayer.append(Y.visual);
this.trigger(i,{added:[Y],removed:[]});
return Y;
},_addShape:function(bn,bp){var bo=this;
var Y=bo.dataSource;
var X;
if(Y&&this._isEditable){X=x(Y,n(bn.dataItem));
bn.dataItem=X;
bn.updateModel();
if(!this.trigger("add",{shape:bn})){this.dataSource.add(X);
var bm=this._inactiveShapeItems.getByUid(X.uid);
bm.element=bn;
bm.undoable=bp;
return bn;
}}else{if(!this.trigger("add",{shape:bn})){return this.addShape(bn,bp);
}}},remove:function(bn,bp){bn=am(bn)?bn.slice(0):[bn];
var Y=a4(bn);
var bo=Y.shapes;
var X=Y.connections;
var bm;
if(!L(bp)){bp=true;
}if(bp){this.undoRedoService.begin();
}this._suspendModelRefresh();
for(bm=bo.length-1;
bm>=0;
bm--){this._removeItem(bo[bm],bp,X);
}for(bm=X.length-1;
bm>=0;
bm--){this._removeItem(X[bm],bp);
}this._resumeModelRefresh();
if(bp){this.undoRedoService.commit(false);
}this.trigger(i,{added:[],removed:bn});
},_removeShapeDataItem:function(X){if(this._isEditable){this.dataSource.remove(X.dataItem);
delete this._dataMap[X.dataItem.id];
}},_removeConnectionDataItem:function(X){if(this._isEditable){this.connectionsDataSource.remove(X.dataItem);
delete this._connectionsDataMap[X.dataItem.uid];
}},_triggerRemove:function(bo){var bp=[];
var bn,X,Y;
for(var bm=0;
bm<bo.length;
bm++){bn=bo[bm];
Y=bn.options.editable;
if(bn instanceof a2){X={shape:bn};
}else{X={connection:bn};
}if(Y&&Y.remove!==false&&!this.trigger("remove",X)){bp.push(bn);
}}return bp;
},undo:function(){this.undoRedoService.undo();
},redo:function(){this.undoRedoService.redo();
},select:function(bn,bp){if(ao(bn)){bp=A({addToSelection:false},bp);
var X=bp.addToSelection,bo=[],bq=[],bm,Y;
if(!X){this.deselect();
}this._internalSelection=true;
if(bn instanceof Array){bo=bn;
}else{if(bn instanceof Q){bo=[bn];
}}for(bm=0;
bm<bo.length;
bm++){Y=bo[bm];
if(Y.select(true)){bq.push(Y);
}}this._selectionChanged(bq,[]);
this._internalSelection=false;
}else{return this._selectedItems;
}},selectAll:function(){this.select(this.shapes.concat(this.connections));
},selectArea:function(bn){var X,bm,Y;
this._internalSelection=true;
var bo=[];
if(bn instanceof aV){bm=this.shapes.concat(this.connections);
for(X=0;
X<bm.length;
X++){Y=bm[X];
if((!bn||Y._hitTest(bn))&&Y.options.enable){if(Y.select(true)){bo.push(Y);
}}}}this._selectionChanged(bo,[]);
this._internalSelection=false;
},deselect:function(bn){this._internalSelection=true;
var X=[],bo=[],Y,bm;
if(bn instanceof Array){bo=bn;
}else{if(bn instanceof Q){bo.push(bn);
}else{if(!ao(bn)){bo=this._selectedItems.slice(0);
}}}for(bm=0;
bm<bo.length;
bm++){Y=bo[bm];
if(Y.select(false)){X.push(Y);
}}this._selectionChanged([],X);
this._internalSelection=false;
},toFront:function(Y,bn){if(!Y){Y=this._selectedItems.slice();
}var bm=this._getDiagramItems(Y),X;
if(!L(bn)||bn){X=ak(this.mainLayer,bm.visuals);
var bo=new a7(this,Y,X);
this.undoRedoService.add(bo);
}else{this.mainLayer.toFront(bm.visuals);
this._fixOrdering(bm,true);
}},toBack:function(Y,bn){if(!Y){Y=this._selectedItems.slice();
}var bm=this._getDiagramItems(Y),X;
if(!L(bn)||bn){X=ak(this.mainLayer,bm.visuals);
var bo=new a6(this,Y,X);
this.undoRedoService.add(bo);
}else{this.mainLayer.toBack(bm.visuals);
this._fixOrdering(bm,false);
}},bringIntoView:function(bm,bo){var br=this.viewport();
var X=new O.RectAlign(br);
var Y,bq,bp,bn;
if(br.width===0||br.height===0){return;
}bo=A({animate:false,align:"center middle"},bo);
if(bo.align=="none"){bo.align="center middle";
}if(bm instanceof Q){bq=bm.bounds(ba);
}else{if(am(bm)){bq=this.boundingBox(bm);
}else{if(bm instanceof aV){bq=bm.clone();
}}}bp=bq.clone();
bq.zoom(this._zoom);
if(bq.width>br.width||bq.height>br.height){this._zoom=this._getValidZoom(ax.min(br.width/bp.width,br.height/bp.height));
bq=bp.clone().zoom(this._zoom);
}this._zoomMainLayer();
Y=bq.clone();
X.align(bq,bo.align);
bn=bq.topLeft().minus(Y.topLeft());
this.pan(bn.times(-1),bo.animate);
},alignShapes:function(X){if(at(X)){X="Left";
}var bn=this.select(),br,bm,Y;
if(bn.length===0){return;
}switch(X.toLowerCase()){case"left":case"top":br=ay;
break;
case"right":case"bottom":br=aA;
break;
}for(Y=0;
Y<bn.length;
Y++){bm=bn[Y];
if(bm instanceof a2){switch(X.toLowerCase()){case"left":br=ax.min(br,bm.options.x);
break;
case"top":br=ax.min(br,bm.options.y);
break;
case"right":br=ax.max(br,bm.options.x);
break;
case"bottom":br=ax.max(br,bm.options.y);
break;
}}}var bp=[];
var bo=[];
for(Y=0;
Y<bn.length;
Y++){bm=bn[Y];
if(bm instanceof a2){bo.push(bm);
bp.push(bm.bounds());
switch(X.toLowerCase()){case"left":case"right":bm.position(new aO(br,bm.options.y));
break;
case"top":case"bottom":bm.position(new aO(bm.options.x,br));
break;
}}}var bq=new O.TransformUnit(bo,bp);
this.undoRedoService.add(bq,false);
},zoom:function(bo,X){if(bo){var bm=X?X.point:new O.Point(0,0);
bo=this._zoom=this._getValidZoom(bo);
if(!at(bm)){bm=new O.Point(ax.round(bm.x),ax.round(bm.y));
var bp=bm.times(bo);
var bn=this.modelToView(bm);
var Y=bn.minus(bp);
this._storePan(new O.Point(ax.round(Y.x),ax.round(Y.y)));
}if(X){X.zoom=bo;
}this._panTransform();
this.canvas.surface.hideTooltip();
this._updateAdorners();
}return this._zoom;
},_getPan:function(Y){var X=this.canvas;
if(!X.translate){Y=Y.plus(this._pan);
}return Y;
},pan:function(Y,X){if(Y instanceof aO){var bn=this;
var bm=bn.scroller;
Y=bn._getPan(Y);
Y=Y.times(-1);
if(X){bm.animatedScrollTo(Y.x,Y.y,function(){bn._updateAdorners();
});
}else{bm.scrollTo(Y.x,Y.y);
bn._updateAdorners();
}}else{return this._pan.times(-1);
}},viewport:function(){var X=this.element;
var bm=X.width();
var Y=X.height();
if(this.toolBar){Y-=aK(this.toolBar.element);
}return new aV(0,0,bm,Y);
},copy:function(){if(this.options.copy.enabled){this._clipboard=[];
this._copyOffset=1;
for(var X=0;
X<this._selectedItems.length;
X++){var Y=this._selectedItems[X];
this._clipboard.push(Y);
}}},cut:function(){if(this.options.copy.enabled){this._clipboard=[];
this._copyOffset=0;
for(var X=0;
X<this._selectedItems.length;
X++){var Y=this._selectedItems[X];
this._clipboard.push(Y);
}this.remove(this._clipboard,true);
}},paste:function(){if(this._clipboard.length>0){var bo,Y,bn;
var bp={};
var bm=a4(this._clipboard);
var X=bm.connections;
var br=bm.shapes;
var bq={x:this._copyOffset*this.options.copy.offsetX,y:this._copyOffset*this.options.copy.offsetY};
this.deselect();
for(bn=0;
bn<br.length;
bn++){bo=br[bn];
Y=bo.clone();
bp[bo.id]=Y;
Y.position(new aO(bo.options.x+bq.x,bo.options.y+bq.y));
Y.diagram=this;
Y=this._addShape(Y);
if(Y){Y.select();
}}for(bn=0;
bn<X.length;
bn++){bo=X[bn];
Y=this._addConnection(bo.clone());
if(Y){this._updateCopiedConnection(Y,bo,"source",bp,bq);
this._updateCopiedConnection(Y,bo,"target",bp,bq);
Y.select(true);
Y.updateModel();
}}this._syncChanges();
this._copyOffset+=1;
}},_updateCopiedConnection:function(X,br,Y,bo,bp){var bq,bn,bt;
var bs=br[Y]();
var bm=this;
if(bs instanceof u&&bo[bs.shape.id]){bt=bo[bs.shape.id];
if(bm.getShapeById(bt.id)){X[Y](bt.getConnector(bs.options.name));
}else{bn=bm._inactiveShapeItems.getByUid(bt.dataItem.uid);
if(bn){bq=function(bu){bt=bm._dataMap[bu.id];
X[Y](bt.getConnector(bs.options.name));
X.updateModel();
};
bm._deferredConnectionUpdates.push(bn.onActivate(bq));
}}}else{X[Y](new aO(br[Y+"Point"]().x+bp.x,br[Y+"Point"]().y+bp.y));
}},boundingBox:function(bn,bo){var bp=aV.empty(),bq,X=ao(bn)?this._getDiagramItems(bn):{shapes:this.shapes};
if(X.shapes.length>0){var bm=X.shapes[0];
bp=bm.bounds(aZ);
for(var Y=1;
Y<X.shapes.length;
Y++){bm=X.shapes[Y];
bq=bm.bounds(aZ);
if(bo===true){bq.x-=bm._rotationOffset.x;
bq.y-=bm._rotationOffset.y;
}bp=bp.union(bq);
}}return bp;
},_containerOffset:function(){var X=this.element.offset();
if(this.toolBar){X.top+=aK(this.toolBar.element);
}return X;
},documentToView:function(Y){var X=this._containerOffset();
return new aO(Y.x-X.left,Y.y-X.top);
},viewToDocument:function(Y){var X=this._containerOffset();
return new aO(Y.x+X.left,Y.y+X.top);
},viewToModel:function(X){return this._transformWithMatrix(X,this._matrixInvert);
},modelToView:function(X){return this._transformWithMatrix(X,this._matrix);
},modelToLayer:function(X){return this._transformWithMatrix(X,this._layerMatrix);
},layerToModel:function(X){return this._transformWithMatrix(X,this._layerMatrixInvert);
},documentToModel:function(X){var Y=this.documentToView(X);
if(!this.canvas.translate){Y.x=Y.x+this.scroller.scrollLeft;
Y.y=Y.y+this.scroller.scrollTop;
}return this.viewToModel(Y);
},modelToDocument:function(X){return this.viewToDocument(this.modelToView(X));
},_transformWithMatrix:function(bm,Y){var bn=bm;
if(bm instanceof aO){if(Y){bn=Y.apply(bm);
}}else{var bo=this._transformWithMatrix(bm.topLeft(),Y),X=this._transformWithMatrix(bm.bottomRight(),Y);
bn=aV.fromPoints(bo,X);
}return bn;
},setDataSource:function(X){this.options.dataSource=X;
this._dataSource();
if(this.options.autoBind){this.dataSource.fetch();
}},setConnectionsDataSource:function(X){this.options.connectionsDataSource=X;
this._connectionDataSource();
if(this.options.autoBind){this.connectionsDataSource.fetch();
}},layout:function(bn){this._layouting=true;
var bo;
if(at(bn)){bn=this.options.layout;
}if(at(bn)||at(bn.type)){bo="Tree";
}else{bo=bn.type;
}var bm;
switch(bo.toLowerCase()){case"tree":bm=new O.TreeLayout(this);
break;
case"layered":bm=new O.LayeredLayout(this);
break;
case"forcedirected":case"force":case"spring":case"springembedder":bm=new O.SpringLayout(this);
break;
default:throw"Layout algorithm '"+bo+"' is not supported.";
}var Y=new O.LayoutState(this);
var X=bm.layout(bn);
if(X){var bp=new O.LayoutUndoUnit(Y,X,bn?bn.animate:null);
this.undoRedoService.add(bp);
}this._layouting=false;
this._redrawConnections();
},getShapeById:function(Y){var X;
X=bf.first(this.shapes,function(bm){return bm.visual.id===Y;
});
if(X){return X;
}X=bf.first(this.connections,function(bm){return bm.visual.id===Y;
});
return X;
},getShapeByModelId:function(X){var Y;
if(this._isEditable){Y=this._dataMap[X];
}else{Y=bf.first(this.shapes,function(bm){return(bm.dataItem||{}).id===X;
});
}return Y;
},getShapeByModelUid:function(Y){var X;
if(this._isEditable){X=bf.first(this.shapes,function(bm){return(bm.dataItem||{}).uid===Y;
});
}else{X=this._dataMap[Y];
}return X;
},getConnectionByModelId:function(Y){var X;
if(this.connectionsDataSource){X=bf.first(this.connections,function(bm){return(bm.dataItem||{}).id===Y;
});
}return X;
},getConnectionByModelUid:function(Y){var X;
if(this.connectionsDataSource){X=this._connectionsDataMap[Y];
}return X;
},_extendLayoutOptions:function(X){if(X.layout){X.layout=A({},O.LayoutBase.fn.defaultOptions||{},X.layout);
}},_selectionChanged:function(Y,X){if(Y.length||X.length){this.trigger(a0,{selected:Y,deselected:X});
}},_getValidZoom:function(X){return ax.min(ax.max(X,this.options.zoomMin),this.options.zoomMax);
},_panTransform:function(bm){var X=this,Y=bm||X._pan;
if(X.canvas.translate){X.scroller.scrollTo(Y.x,Y.y);
X._zoomMainLayer();
}else{X._storePan(Y);
X._transformMainLayer();
}},_finishPan:function(){this.trigger(aM,{total:this._pan,delta:Number.NaN});
},_storePan:function(X){this._pan=X;
this._storeViewMatrix();
},_zoomMainLayer:function(){var Y=this._zoom;
var X=new p(0,0,Y,Y);
X.render(this.mainLayer);
this._storeLayerMatrix(X);
this._storeViewMatrix();
},_transformMainLayer:function(){var X=this._pan,bm=this._zoom;
var Y=new p(X.x,X.y,bm,bm);
Y.render(this.mainLayer);
this._storeLayerMatrix(Y);
this._storeViewMatrix();
},_storeLayerMatrix:function(X){this._layerMatrix=X.toMatrix();
this._layerMatrixInvert=X.invert().toMatrix();
},_storeViewMatrix:function(){var X=this._pan,bm=this._zoom;
var Y=new p(X.x,X.y,bm,bm);
this._matrix=Y.toMatrix();
this._matrixInvert=Y.invert().toMatrix();
},_toIndex:function(Y,X){var bm=this._getDiagramItems(Y);
this.mainLayer.toIndex(bm.visuals,X);
this._fixOrdering(bm,false);
},_fixOrdering:function(bn,bp){var bo=bp?this.shapes.length-1:0,X=bp?this.connections.length-1:0,Y,bm;
for(Y=0;
Y<bn.shapes.length;
Y++){bm=bn.shapes[Y];
bf.remove(this.shapes,bm);
bf.insert(this.shapes,bm,bo);
}for(Y=0;
Y<bn.cons.length;
Y++){bm=bn.cons[Y];
bf.remove(this.connections,bm);
bf.insert(this.connections,bm,X);
}},_getDiagramItems:function(bn){var Y,bo={},X=bn;
bo.visuals=[];
bo.shapes=[];
bo.cons=[];
if(!bn){X=this._selectedItems.slice();
}else{if(!am(bn)){X=[bn];
}}for(Y=0;
Y<X.length;
Y++){var bm=X[Y];
if(bm instanceof a2){bo.shapes.push(bm);
bo.visuals.push(bm.visual);
}else{if(bm instanceof q){bo.cons.push(bm);
bo.visuals.push(bm.visual);
}}}return bo;
},_removeItem:function(X,bm,Y){X.select(false);
if(X instanceof a2){this._removeShapeDataItem(X);
this._removeShape(X,bm,Y);
}else{if(X instanceof q){this._removeConnectionDataItem(X);
this._removeConnection(X,bm);
}}this.mainLayer.remove(X.visual);
},_removeShape:function(bp,bs,bo){var bm,X,Y,bq=[],br=[];
this.toolService._removeHover();
if(bs){this.undoRedoService.addCompositeItem(new N(bp));
}bf.remove(this.shapes,bp);
this._shapesQuadTree.remove(bp);
for(bm=0;
bm<bp.connectors.length;
bm++){Y=bp.connectors[bm];
for(var bn=0;
bn<Y.connections.length;
bn++){X=Y.connections[bn];
if(!bo||!z.inArray(X,bo)){if(X.sourceConnector==Y){bq.push(X);
}else{if(X.targetConnector==Y){br.push(X);
}}}}}for(bm=0;
bm<bq.length;
bm++){bq[bm].source(null,bs);
bq[bm].updateModel();
}for(bm=0;
bm<br.length;
bm++){br[bm].target(null,bs);
br[bm].updateModel();
}},_removeConnection:function(X,Y){if(X.sourceConnector){bf.remove(X.sourceConnector.connections,X);
}if(X.targetConnector){bf.remove(X.targetConnector.connections,X);
}if(Y){this.undoRedoService.addCompositeItem(new M(X));
}bf.remove(this.connections,X);
},_removeDataItems:function(bn,bo){var bm,X,bp,Y;
bn=am(bn)?bn:[bn];
while(bn.length){bm=bn.shift();
bp=this._dataMap[bm.uid];
if(bp){this._removeShapeConnections(bp);
this._removeItem(bp,false);
delete this._dataMap[bm.uid];
if(bo&&bm.hasChildren&&bm.loaded()){X=bm.children.data();
for(Y=0;
Y<X.length;
Y++){bn.push(X[Y]);
}}}}},_removeShapeConnections:function(bm){var X=bm.connections();
var Y;
if(X){for(Y=0;
Y<X.length;
Y++){this._removeItem(X[Y],false);
}}},_addDataItem:function(X,bn){if(!L(X)){return;
}var bm=this._dataMap[X.id];
if(bm){return bm;
}var Y=A({},this.options.shapeDefaults);
Y.dataItem=X;
bm=new a2(Y,this);
this.addShape(bm,bn!==false);
this._dataMap[X.id]=bm;
return bm;
},_addDataItemByUid:function(X){if(!L(X)){return;
}var bm=this._dataMap[X.uid];
if(bm){return bm;
}var Y=A({},this.options.shapeDefaults);
Y.dataItem=X;
bm=new a2(Y,this);
this.addShape(bm);
this._dataMap[X.uid]=bm;
return bm;
},_addDataItems:function(bn,bo){var bm,Y,bq,bp,X;
for(Y=0;
Y<bn.length;
Y++){bm=bn[Y];
bq=this._addDataItemByUid(bm);
bp=this._addDataItemByUid(bo);
if(bp&&!this.connected(bp,bq)){X=this.connect(bp,bq);
}}},_refreshSource:function(bm){var br=this,bp=bm.node,X=bm.action,bo=bm.items,bq=br.options,bn,Y;
if(bm.field){for(bn=0;
bn<bo.length;
bn++){if(this._dataMap[bo[bn].uid]){this._dataMap[bo[bn].uid].redrawVisual();
}}return;
}if(X=="remove"){this._removeDataItems(bm.items,true);
}else{if((!X||X==="itemloaded")&&!this._bindingRoots){this._bindingRoots=true;
Y=true;
}if(!X&&!bp){br.clear();
}this._addDataItems(bo,bp);
for(bn=0;
bn<bo.length;
bn++){bo[bn].load();
}}if(bq.layout&&(Y||X=="remove"||X=="add")){br.layout(bq.layout);
}if(Y){this.trigger("dataBound");
this._bindingRoots=false;
}},_addItem:function(X){if(X instanceof a2){this.addShape(X);
}else{if(X instanceof q){this.addConnection(X);
}}},_createToolBar:function(bs){var Y=this.toolService.diagram;
if(!this.singleToolBar&&Y.select().length===1){var bn=Y.select()[0];
if(bn&&bn.options.editable!==false){var bm=bn.options.editable;
var bu=bm.tools;
if(this._isEditable&&bu.length===0){if(bn instanceof a2){bu=["edit","rotateClockwise","rotateAnticlockwise"];
}else{if(bn instanceof q){bu=["edit"];
}}if(bm&&bm.remove!==false){bu.push("delete");
}}if(bu&&bu.length){var bo=20;
var bp;
this.singleToolBar=new R(Y,{tools:bu,click:aS(this._toolBarClick,this),modal:true});
var br=aL(this.singleToolBar._popup.element);
var bq=aK(this.singleToolBar._popup.element);
if(bn instanceof a2){var bt=this.modelToView(bn.bounds(aZ));
bp=new aO(bt.x,bt.y).minus(new aO((br-bt.width)/2,bq+bo));
}else{if(bn instanceof q){var X=this.modelToView(bn.bounds());
bp=new aO(X.x,X.y).minus(new aO((br-X.width-20)/2,bq+bo));
}}if(bp){if(!this.canvas.translate){bp=bp.minus(new aO(this.scroller.scrollLeft,this.scroller.scrollTop));
}bp=this.viewToDocument(bp);
bp=new aO(ax.max(bp.x,0),ax.max(bp.y,0));
this.singleToolBar.showAt(bp);
if(bs){this.singleToolBar._popup.one("close",aR);
}}else{this._destroyToolBar();
}}}}},_toolBarClick:function(X){this.trigger("toolBarClick",X);
this._destroyToolBar();
},_normalizePointZoom:function(X){return X.times(1/this.zoom());
},_initialize:function(){this.shapes=[];
this._selectedItems=[];
this.connections=[];
this._dataMap={};
this._connectionsDataMap={};
this._inactiveShapeItems=new aj();
this._deferredConnectionUpdates=[];
this.undoRedoService=new be({undone:this._syncHandler,redone:this._syncHandler});
this.id=O.randomId();
},_fetchFreshData:function(){var X=this;
X._dataSource();
if(X._isEditable){X._connectionDataSource();
}if(X.options.autoBind){if(X._isEditable){this._loadingShapes=true;
this._loadingConnections=true;
X.dataSource.fetch();
X.connectionsDataSource.fetch();
}else{X.dataSource.fetch();
}}},_dataSource:function(){if(L(this.options.connectionsDataSource)){this._isEditable=true;
var Y=this.options.dataSource||{};
var X=am(Y)?{data:Y}:Y;
if(this.dataSource&&this._shapesRefreshHandler){this.dataSource.unbind("change",this._shapesRefreshHandler).unbind("requestStart",this._shapesRequestStartHandler).unbind("error",this._shapesErrorHandler);
}else{this._shapesRefreshHandler=aS(this._refreshShapes,this);
this._shapesRequestStartHandler=aS(this._shapesRequestStart,this);
this._shapesErrorHandler=aS(this._error,this);
}this.dataSource=kendo.data.DataSource.create(X).bind("change",this._shapesRefreshHandler).bind("requestStart",this._shapesRequestStartHandler).bind("error",this._shapesErrorHandler);
}else{this._treeDataSource();
this._isEditable=false;
}},_connectionDataSource:function(){var Y=this.options.connectionsDataSource;
if(Y){var X=am(Y)?{data:Y}:Y;
if(this.connectionsDataSource&&this._connectionsRefreshHandler){this.connectionsDataSource.unbind("change",this._connectionsRefreshHandler).unbind("requestStart",this._connectionsRequestStartHandler).unbind("error",this._connectionsErrorHandler);
}else{this._connectionsRefreshHandler=aS(this._refreshConnections,this);
this._connectionsRequestStartHandler=aS(this._connectionsRequestStart,this);
this._connectionsErrorHandler=aS(this._connectionsError,this);
}this.connectionsDataSource=kendo.data.DataSource.create(X).bind("change",this._connectionsRefreshHandler).bind("requestStart",this._connectionsRequestStartHandler).bind("error",this._connectionsErrorHandler);
}},_shapesRequestStart:function(X){if(X.type=="read"){this._loadingShapes=true;
}},_connectionsRequestStart:function(X){if(X.type=="read"){this._loadingConnections=true;
}},_error:function(){this._loadingShapes=false;
},_connectionsError:function(){this._loadingConnections=false;
},_refreshShapes:function(X){if(X.action==="remove"){if(this._shouldRefresh()){this._removeShapes(X.items);
}}else{if(X.action==="itemchange"){if(this._shouldRefresh()){this._updateShapes(X.items,X.field);
}}else{if(X.action==="add"){this._inactiveShapeItems.add(X.items);
}else{if(X.action==="sync"){this._syncShapes(X.items);
}else{this.refresh();
}}}}},_shouldRefresh:function(){return !this._suspended;
},_suspendModelRefresh:function(){this._suspended=(this._suspended||0)+1;
},_resumeModelRefresh:function(){this._suspended=ax.max((this._suspended||0)-1,0);
},refresh:function(){this._loadingShapes=false;
if(!this._loadingConnections){this._rebindShapesAndConnections();
}},_rebindShapesAndConnections:function(){this.clear();
this._addShapes(this.dataSource.view());
if(this.connectionsDataSource){this._addConnections(this.connectionsDataSource.view(),false);
}if(this.options.layout){this.layout(this.options.layout);
}else{this._redrawConnections();
}this.trigger("dataBound");
},refreshConnections:function(){this._loadingConnections=false;
if(!this._loadingShapes){this._rebindShapesAndConnections();
}},_redrawConnections:function(){var X=this.connections;
for(var Y=0;
Y<X.length;
Y++){X[Y].refresh();
}},_removeShapes:function(bn){var X=this._dataMap;
var bm,Y;
for(Y=0;
Y<bn.length;
Y++){bm=bn[Y];
if(X[bm.id]){this.remove(X[bm.id],false);
X[bm.id]=null;
}}},_syncShapes:function(){var X=this;
var Y=X._inactiveShapeItems;
Y.forEach(function(bn){var bm=bn.dataItem;
var bo=bn.element;
if(!bm.isNew()){if(bo){bo._setOptionsFromModel();
X.addShape(bo,bn.undoable);
X._dataMap[bm.id]=bo;
}else{X._addDataItem(bm);
}bn.activate();
Y.remove(bm);
}});
},_updateShapes:function(bn,Y){for(var bm=0;
bm<bn.length;
bm++){var X=bn[bm];
var bo=this._dataMap[X.id];
if(bo){bo.updateOptionsFromModel(X,Y);
}}},_addShapes:function(X){for(var Y=0;
Y<X.length;
Y++){this._addDataItem(X[Y],false);
}},_refreshConnections:function(X){if(X.action==="remove"){if(this._shouldRefresh()){this._removeConnections(X.items);
}}else{if(X.action==="add"){this._addConnections(X.items);
}else{if(X.action==="sync"){}else{if(X.action==="itemchange"){if(this._shouldRefresh()){this._updateConnections(X.items);
}}else{this.refreshConnections();
}}}}},_removeConnections:function(Y){for(var X=0;
X<Y.length;
X++){this.remove(this._connectionsDataMap[Y[X].uid],false);
this._connectionsDataMap[Y[X].uid]=null;
}},_updateConnections:function(bn){for(var bm=0;
bm<bn.length;
bm++){var Y=bn[bm];
var X=this._connectionsDataMap[Y.uid];
X.updateOptionsFromModel(Y);
}},_addConnections:function(X,bo){var bn=X.length;
for(var bm=0;
bm<bn;
bm++){var Y=X[bm];
this._addConnectionDataItem(Y,bo);
}},_addConnectionDataItem:function(Y,bp){if(!this._connectionsDataMap[Y.uid]){var bm=this._validateConnector(Y.from);
if(!L(bm)||bm===null){bm=new aO(Y.fromX,Y.fromY);
}var bo=this._validateConnector(Y.to);
if(!L(bo)||bo===null){bo=new aO(Y.toX,Y.toY);
}if(L(bm)&&L(bo)){var bn=A({},this.options.connectionDefaults);
bn.dataItem=Y;
var X=new q(bm,bo,bn);
this._connectionsDataMap[Y.uid]=X;
this.addConnection(X,bp);
}}},_validateConnector:function(Y){var X;
if(L(Y)&&Y!==null){X=this._dataMap[Y];
}return X;
},_treeDataSource:function(){var bm=this,Y=bm.options,X=Y.dataSource;
X=am(X)?{data:X}:X;
if(X instanceof kendo.data.DataSource&&!(X instanceof kendo.data.HierarchicalDataSource)){throw new Error("Incorrect DataSource type. If a single dataSource instance is set to the diagram then it should be a HierarchicalDataSource. You should set only the options instead of an instance or a HierarchicalDataSource instance or supply connectionsDataSource as well.");
}if(!X.fields){X.fields=[{field:"text"},{field:"url"},{field:"spriteCssClass"},{field:"imageUrl"}];
}if(bm.dataSource&&bm._refreshHandler){bm._unbindDataSource();
}bm._refreshHandler=aS(bm._refreshSource,bm);
bm._errorHandler=aS(bm._error,bm);
bm.dataSource=ag.create(X).bind(i,bm._refreshHandler).bind(Z,bm._errorHandler);
},_unbindDataSource:function(){var X=this;
X.dataSource.unbind(i,X._refreshHandler).unbind(Z,X._errorHandler);
},_adorn:function(X,Y){if(Y!==bd&&X){if(Y){this._adorners.push(X);
this.adornerLayer.append(X.visual);
}else{bf.remove(this._adorners,X);
this.adornerLayer.remove(X.visual);
}}},_showConnectors:function(X,Y){if(Y){this._connectorsAdorner.show(X);
}else{this._connectorsAdorner.destroy();
}},_updateAdorners:function(){var Y=this._adorners;
for(var bm=0;
bm<Y.length;
bm++){var X=Y[bm];
if(X.refreshBounds){X.refreshBounds();
}X.refresh();
}},_refresh:function(){for(var X=0;
X<this.connections.length;
X++){this.connections[X].refresh();
}},_destroyToolBar:function(){if(this.singleToolBar){this.singleToolBar.hide();
this.singleToolBar.destroy();
this.singleToolBar=null;
}},_destroyGlobalToolBar:function(){if(this.toolBar){this.toolBar.hide();
this.toolBar.destroy();
this.toolBar=null;
}},exportDOMVisual:function(){var bo=this.canvas._viewBox;
var bn=ad.transform().translate(-bo.x,-bo.y);
var bp=new ad.Rect([0,0],[bo.width,bo.height]);
var X=V.Path.fromRect(bp);
var bq=new V.Group({transform:bn});
var Y=new V.Group({clip:X});
var bm=this.canvas.drawingElement.children[0];
Y.append(bq);
bq.children.push(bm);
return Y;
},exportVisual:function(){var Y=ad.transform().scale(1/this._zoom);
var bm=new V.Group({transform:Y});
var X=this.mainLayer.drawingElement;
bm.children.push(X);
return bm;
},_syncChanges:function(){this._syncShapeChanges();
this._syncConnectionChanges();
},_syncShapeChanges:function(){if(this.dataSource&&this._isEditable){this.dataSource.sync();
}},_syncConnectionChanges:function(){var X=this;
if(X.connectionsDataSource&&X._isEditable){a.when.apply(a,X._deferredConnectionUpdates).then(function(){X.connectionsDataSource.sync();
});
X.deferredConnectionUpdates=[];
}}});
z.ExportMixin.extend(P.fn,true);
if(kendo.PDFMixin){kendo.PDFMixin.extend(P.fn);
}function ac(X){var Y={};
X=X||{};
if(L(X.text)&&X.text!==null){Y.text=X.text;
}if(L(X.x)&&X.x!==null){Y.x=X.x;
}if(L(X.y)&&X.y!==null){Y.y=X.y;
}if(L(X.width)&&X.width!==null){Y.width=X.width;
}if(L(X.height)&&X.height!==null){Y.height=X.height;
}if(L(X.type)&&X.type!==null){Y.type=X.type;
}return Y;
}function ab(X){var Y={};
X=X||{};
if(L(X.text)&&X.text!==null){Y.content=X.text;
}if(L(X.type)&&X.type!==null){Y.type=X.type;
}if(L(X.from)&&X.from!==null){Y.from=X.from;
}if(L(X.fromConnector)&&X.fromConnector!==null){Y.fromConnector=X.fromConnector;
}if(L(X.fromX)&&X.fromX!==null){Y.fromX=X.fromX;
}if(L(X.fromY)&&X.fromY!==null){Y.fromY=X.fromY;
}if(L(X.to)&&X.to!==null){Y.to=X.to;
}if(L(X.toConnector)&&X.toConnector!==null){Y.toConnector=X.toConnector;
}if(L(X.toX)&&X.toX!==null){Y.toX=X.toX;
}if(L(X.toY)&&X.toY!==null){Y.toY=X.toY;
}return Y;
}var R=kendo.Observable.extend({init:function(X,Y){kendo.Observable.fn.init.call(this);
this.diagram=X;
this.options=A({},this.options,Y);
this._tools=[];
this.createToolBar();
this.createTools();
this.appendTools();
if(this.options.modal){this.createPopup();
}this.bind(this.events,Y);
},events:["click"],createPopup:function(){this.container=a("<div/>").append(this.element);
this._popup=this.container.kendoPopup({}).getKendoPopup();
},appendTools:function(){for(var X=0;
X<this._tools.length;
X++){var Y=this._tools[X];
if(Y.buttons&&Y.buttons.length||!L(Y.buttons)){this._toolBar.add(Y);
}}},createToolBar:function(){this.element=a("<div/>");
this._toolBar=this.element.kendoToolBar({click:aS(this.click,this),resizable:false}).getKendoToolBar();
this.element.css("border","none");
},createTools:function(){for(var X=0;
X<this.options.tools.length;
X++){this.createTool(this.options.tools[X]);
}},createTool:function(X){if(!aq(X)){X={name:X};
}var Y=X.name+"Tool";
if(this[Y]){this[Y](X);
}else{this._tools.push(A({},X,{attributes:this._setAttributes({action:X.name})}));
}},showAt:function(X){if(this._popup){this._popup.open(X.x,X.y);
}},hide:function(){if(this._popup){this._popup.close();
}},newGroup:function(){return{type:"buttonGroup",buttons:[]};
},editTool:function(){this._tools.push({icon:"edit",showText:"overflow",type:"button",text:"Edit",attributes:this._setAttributes({action:"edit"})});
},deleteTool:function(){this._tools.push({icon:"close",showText:"overflow",type:"button",text:"Delete",attributes:this._setAttributes({action:"delete"})});
},rotateAnticlockwiseTool:function(X){this._appendGroup("rotate");
this._rotateGroup.buttons.push({icon:"rotate-left",showText:"overflow",text:"RotateAnticlockwise",group:"rotate",attributes:this._setAttributes({action:"rotateAnticlockwise",step:X.step})});
},rotateClockwiseTool:function(X){this._appendGroup("rotate");
this._rotateGroup.buttons.push({icon:"rotate-right",attributes:this._setAttributes({action:"rotateClockwise",step:X.step}),showText:"overflow",text:"RotateClockwise",group:"rotate"});
},createShapeTool:function(){this._appendGroup("create");
this._createGroup.buttons.push({icon:"shape",showText:"overflow",text:"CreateShape",group:"create",attributes:this._setAttributes({action:"createShape"})});
},createConnectionTool:function(){this._appendGroup("create");
this._createGroup.buttons.push({icon:"connector",showText:"overflow",text:"CreateConnection",group:"create",attributes:this._setAttributes({action:"createConnection"})});
},undoTool:function(){this._appendGroup("history");
this._historyGroup.buttons.push({icon:"undo",showText:"overflow",text:"Undo",group:"history",attributes:this._setAttributes({action:"undo"})});
},redoTool:function(){this._appendGroup("history");
this._historyGroup.buttons.push({icon:"redo",showText:"overflow",text:"Redo",group:"history",attributes:this._setAttributes({action:"redo"})});
},_appendGroup:function(X){var Y="_"+X+"Group";
if(!this[Y]){this[Y]=this.newGroup();
this._tools.push(this[Y]);
}},_setAttributes:function(Y){var X={};
if(Y.action){X[kendo.attr("action")]=Y.action;
}if(Y.step){X[kendo.attr("step")]=Y.step;
}return X;
},_getAttributes:function(bm){var Y={};
var X=bm.attr(kendo.attr("action"));
if(X){Y.action=X;
}var bn=bm.attr(kendo.attr("step"));
if(bn){Y.step=bn;
}return Y;
},click:function(bm){var Y=this._getAttributes(a(bm.target));
var X=Y.action;
if(X&&this[X]){this[X](Y);
}this.trigger("click",this.eventData(X,bm.target));
},eventData:function(X,br){var bn=this.selectedElements(),bp=bn.length,bq=[],Y=[],bm;
for(var bo=0;
bo<bp;
bo++){bm=bn[bo];
if(bm instanceof a2){bq.push(bm);
}else{Y.push(bm);
}}return{shapes:bq,connections:Y,action:X,target:br};
},"delete":function(){var X=this.diagram;
var Y=X._triggerRemove(this.selectedElements());
if(Y.length){this.diagram.remove(Y,true);
this.diagram._syncChanges();
}},edit:function(){var X=this.selectedElements();
if(X.length===1){this.diagram.edit(X[0]);
}},rotateClockwise:function(Y){var X=parseFloat(Y.step||90);
this._rotate(X);
},rotateAnticlockwise:function(Y){var X=parseFloat(Y.step||90);
this._rotate(-X);
},_rotate:function(Y){var X=this.diagram._resizingAdorner;
X.angle(X.angle()+Y);
X.rotate();
},selectedElements:function(){return this.diagram.select();
},createShape:function(){this.diagram.createShape();
},createConnection:function(){this.diagram.createConnection();
},undo:function(){this.diagram.undo();
},redo:function(){this.diagram.redo();
},destroy:function(){this.diagram=null;
this.element=null;
this.options=null;
if(this._toolBar){this._toolBar.destroy();
}if(this._popup){this._popup.destroy();
}}});
var W=kendo.Observable.extend({init:function(X,Y){kendo.Observable.fn.init.call(this);
this.options=aa(true,{},this.options,Y);
this.element=X;
this.model=this.options.model;
this.fields=this._getFields();
this._initContainer();
this.createEditable();
},options:{editors:{}},_initContainer:function(){this.wrapper=this.element;
},createEditable:function(){var X=this.options;
this.editable=new kendo.ui.Editable(this.wrapper,{fields:this.fields,target:X.target,clearContainer:false,model:this.model});
},_isEditable:function(X){return this.model.editable&&this.model.editable(X);
},_getFields:function(){var bm=[];
var bn=this.model.fields;
for(var Y in bn){var bo={};
if(this._isEditable(Y)){var X=this.options.editors[Y];
if(X){bo.editor=X;
}bo.field=Y;
bm.push(bo);
}}return bm;
},end:function(){return this.editable.end();
},destroy:function(){this.editable.destroy();
this.editable.element.find("["+kendo.attr("container-for")+"]").empty();
this.model=this.wrapper=this.element=this.columns=this.editable=null;
}});
var aQ=W.extend({init:function(X,Y){W.fn.init.call(this,X,Y);
this.bind(this.events,this.options);
this.open();
},events:["update","cancel"],options:{window:{modal:true,resizable:false,draggable:true,title:"Edit",visible:false}},_initContainer:function(){var Y=this;
this.wrapper=a('<div class="k-popup-edit-form"/>').attr(kendo.attr("uid"),this.model.uid);
var X="";
if(this.options.template){X+=this._renderTemplate();
this.fields=[];
}else{X+=this._renderFields();
}X+=this._renderButtons();
this.wrapper.append(a('<div class="k-edit-form-container"/>').append(X));
this.window=new kendo.ui.Window(this.wrapper.appendTo(this.element),this.options.window);
this.window.bind("close",function(bm){if(bm.userTriggered){bm.sender.element.focus();
Y._cancelClick(bm);
}});
this._attachButtonEvents();
},_renderTemplate:function(){var X=this.options.template;
if(typeof X==="string"){X=window.unescape(X);
}X=kendo.template(X)(this.model);
return X;
},_renderFields:function(){var Y="";
for(var bm=0;
bm<this.fields.length;
bm++){var X=this.fields[bm];
Y+='<div class="k-edit-label"><label for="'+X.field+'">'+(X.field||"")+"</label></div>";
if(this._isEditable(X.field)){Y+="<div "+kendo.attr("container-for")+'="'+X.field+'" class="k-edit-field"></div>';
}}return Y;
},_renderButtons:function(){var X='<div class="k-edit-buttons k-state-default">';
X+=this._createButton("update");
X+=this._createButton("cancel");
X+="</div>";
return X;
},_createButton:function(X){return kendo.template(e)(K[X]);
},_attachButtonEvents:function(){this._cancelClickHandler=aS(this._cancelClick,this);
this.window.element.on(m+aI,"a.k-diagram-cancel",this._cancelClickHandler);
this._updateClickHandler=aS(this._updateClick,this);
this.window.element.on(m+aI,"a.k-diagram-update",this._updateClickHandler);
},_updateClick:function(X){X.preventDefault();
this.trigger("update");
},_cancelClick:function(X){X.preventDefault();
this.trigger("cancel");
},open:function(){this.window.center().open();
},close:function(){this.window.bind("deactivate",aS(this.destroy,this)).close();
},destroy:function(){this.window.close().destroy();
this.window.element.off(m+aI,"a.k-diagram-cancel",this._cancelClickHandler);
this.window.element.off(m+aI,"a.k-diagram-update",this._updateClickHandler);
this._cancelClickHandler=null;
this._editUpdateClickHandler=null;
this.window=null;
W.fn.destroy.call(this);
}});
function t(X,bm){var Y=this.dataSource.reader.model;
if(Y){var bn=Y.fn.fields.text?"text":Y.idField;
a("<input name='"+bm.field+"' />").appendTo(X).kendoDropDownList({dataValueField:Y.idField,dataTextField:bn,dataSource:this.dataSource.data().toJSON(),optionLabel:" ",valuePrimitive:true});
}}function ai(X){this.dataItem=X;
this.callbacks=[];
}ai.fn=ai.prototype={onActivate:function(X){var Y=a.Deferred();
this.callbacks.push({callback:X,deferred:Y});
return Y;
},activate:function(){var X=this.callbacks;
var bm;
for(var Y=0;
Y<X.length;
Y++){bm=this.callbacks[Y];
bm.callback(this.dataItem);
bm.deferred.resolve();
}this.callbacks=[];
}};
function aj(){this.items={};
}aj.fn=aj.prototype={add:function(Y){for(var X=0;
X<Y.length;
X++){this.items[Y[X].uid]=new ai(Y[X]);
}},forEach:function(X){for(var Y in this.items){X(this.items[Y]);
}},getByUid:function(X){return this.items[X];
},remove:function(X){delete this.items[X.uid];
}};
var aU=k.extend({init:function(){this.shapes=[];
},_add:function(Y,X){this.shapes.push({bounds:X,shape:Y});
Y._quadNode=this;
},insert:function(Y,X){this._add(Y,X);
},remove:function(bm){var bn=this.shapes;
var Y=bn.length;
for(var X=0;
X<Y;
X++){if(bn[X].shape===bm){bn.splice(X,1);
break;
}}},hitTestRect:function(bn,X){var bo=this.shapes;
var bm=bo.length;
for(var Y=0;
Y<bm;
Y++){if(this._testRect(bo[Y].shape,bn)&&!z.inArray(bo[Y].shape,X)){return true;
}}},_testRect:function(bo,bn){var X=bo.rotate().angle;
var Y=bo.bounds();
var bm;
if(!X){bm=Y.overlaps(bn);
}else{bm=al.rects(bn,Y,-X);
}return bm;
}});
var aT=aU.extend({init:function(X){aU.fn.init.call(this);
this.children=[];
this.rect=X;
},inBounds:function(bo){var bn=this.rect;
var bm=bn.bottomRight();
var X=bo.bottomRight();
var Y=bn.x<=bo.x&&bn.y<=bo.y&&X.x<=bm.x&&X.y<=bm.y;
return Y;
},overlapsBounds:function(X){return this.rect.overlaps(X);
},insert:function(bp,X){var bn=false;
var Y=this.children;
var bo=Y.length;
if(this.inBounds(X)){if(!bo&&this.shapes.length<4){this._add(bp,X);
}else{if(!bo){this._initChildren();
}for(var bm=0;
bm<Y.length;
bm++){if(Y[bm].insert(bp,X)){bn=true;
break;
}}if(!bn){this._add(bp,X);
}}bn=true;
}return bn;
},_initChildren:function(){var bp=this.rect,bm=this.children,br=this.shapes,X=bp.center(),bo=bp.width/2,bn=bp.height/2,Y,bq;
bm.push(new aT(new aV(bp.x,bp.y,bo,bn)),new aT(new aV(X.x,bp.y,bo,bn)),new aT(new aV(bp.x,X.y,bo,bn)),new aT(new aV(X.x,X.y,bo,bn)));
for(bq=br.length-1;
bq>=0;
bq--){for(Y=0;
Y<bm.length;
Y++){if(bm[Y].insert(br[bq].shape,br[bq].bounds)){br.splice(bq,1);
break;
}}}},hitTestRect:function(bp,Y){var bn;
var X=this.children;
var bo=X.length;
var bm=false;
if(this.overlapsBounds(bp)){if(aU.fn.hitTestRect.call(this,bp,Y)){bm=true;
}else{for(bn=0;
bn<bo;
bn++){if(X[bn].hitTestRect(bp,Y)){bm=true;
break;
}}}}return bm;
}});
var a3=k.extend({ROOT_SIZE:1000,init:function(Y){var X=aS(this._boundsChange,this);
Y.bind(au,X);
Y.bind(av,X);
this.initRoots();
},initRoots:function(){this.rootMap={};
this.root=new aU();
},clear:function(){this.initRoots();
},_boundsChange:function(X){if(X.item._quadNode){X.item._quadNode.remove(X.item);
}this.insert(X.item);
},insert:function(bn){var X=bn.bounds(aZ);
var Y=this.ROOT_SIZE;
var bm=this.getSectors(X);
var bo=bm[0][0];
var bp=bm[1][0];
if(this.inRoot(bm)){this.root.insert(bn,X);
}else{if(!this.rootMap[bo]){this.rootMap[bo]={};
}if(!this.rootMap[bo][bp]){this.rootMap[bo][bp]=new aT(new aV(bo*Y,bp*Y,Y,Y));
}this.rootMap[bo][bp].insert(bn,X);
}},remove:function(X){if(X._quadNode){X._quadNode.remove(X);
}},inRoot:function(X){return X[0].length>1||X[1].length>1;
},getSectors:function(bn){var bo=this.ROOT_SIZE;
var X=bn.bottomRight();
var Y=ax.floor(X.x/bo);
var bm=ax.floor(X.y/bo);
var bp=[[],[]];
for(var bq=ax.floor(bn.x/bo);
bq<=Y;
bq++){bp[0].push(bq);
}for(var br=ax.floor(bn.y/bo);
br<=bm;
br++){bp[1].push(br);
}return bp;
},hitTestRect:function(Y,X){var bn=this.getSectors(Y);
var bp,br,bo,bq;
var bm;
if(this.root.hitTestRect(Y,X)){return true;
}for(bp=0;
bp<bn[0].length;
bp++){bo=bn[0][bp];
for(br=0;
br<bn[1].length;
br++){bq=bn[1][br];
bm=(this.rootMap[bo]||{})[bq];
if(bm&&bm.hitTestRect(Y,X)){return true;
}}}return false;
}});
function n(X){var Y=X;
if(X instanceof kendo.data.Model){Y=X.toJSON();
Y[X.idField]=X._defaultId;
}return Y;
}function a4(bm){var X=[];
var bo=[];
var Y,bn;
for(bn=0;
bn<bm.length;
bn++){Y=bm[bn];
if(Y instanceof a2){bo.push(Y);
}else{X.push(Y);
}}return{shapes:bo,connections:X};
}function x(X,Y){if(X.reader.model){return new X.reader.model(Y);
}return new kendo.data.ObservableObject(Y);
}function l(X,Y){if(L(Y[X])){Y.set(X,null);
}}function w(bo,X,bm){var Y;
for(var bn=0;
bn<bm.length;
bn++){Y=bm[bn];
if(X&&!L(X[Y])){X[Y]=bo[Y];
}}}function bb(Y){var X=Y.drawingContainer().clippedBBox(null);
if(X.origin.x!==0||X.origin.y!==0){Y.position(-X.origin.x,-X.origin.y);
}}function aR(X){X.preventDefault();
}z.ui.plugin(P);
A(O,{Shape:a2,Connection:q,Connector:u,DiagramToolBar:R,QuadNode:aT,QuadRoot:aU,ShapesQuadTree:a3,PopupEditor:aQ});
}(window.kendo.jQuery));
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
(function(b,a){a("kendo.dataviz.diagram",["kendo.data","kendo.draganddrop","kendo.userevents","kendo.mobile.scroller","kendo.drawing","dataviz/diagram/utils","dataviz/diagram/math","dataviz/diagram/svg","dataviz/diagram/services","dataviz/diagram/layout","dataviz/diagram/dom"],b);
}(function(){var a={id:"dataviz.diagram",name:"Diagram",category:"dataviz",description:"The Kendo DataViz Diagram ",depends:["data","userevents","mobile.scroller","draganddrop","drawing","dataviz.core","dataviz.themes","toolbar"],features:[{id:"dataviz.diagram-pdf-export",name:"PDF export",description:"Export Diagram as PDF",depends:["pdf"]},{id:"dataviz.diagram-editing",name:"Editing",description:"Support for model editing",depends:["editable","window","dropdownlist"]}]};
return window.kendo;
},typeof define=="function"&&define.amd?define:function(a,b,c){(c||b)();
}));
